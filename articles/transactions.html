<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>actxps - Transaction studies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">actxps</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../articles/actxps.html" rel="" target="">
 <span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-articles" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Articles</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-articles">    
        <li>
    <a class="dropdown-item" href="../articles/exposures.html" rel="" target="">
 <span class="dropdown-text">Exposure calculations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/exp_summary.html" rel="" target="">
 <span class="dropdown-text">Experience summaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/transactions.html" rel="" target="">
 <span class="dropdown-text">Transaction studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/visualizations.html" rel="" target="">
 <span class="dropdown-text">Data visualizations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/misc.html" rel="" target="">
 <span class="dropdown-text">Other functions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../changelog.html" rel="" target="">
 <span class="menu-text">Changelog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mattheaphy/actxpspy" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-r-circle-fill" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-r-circle-fill" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-r-circle-fill">    
        <li class="dropdown-header">R version of actxps</li>
        <li>
    <a class="dropdown-item" href="https://github.com/mattheaphy/actxps" rel="" target="">
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mattheaphy.github.io/actxps" rel="" target="">
 <span class="dropdown-text">Package documentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#simulated-transaction-and-account-value-data" id="toc-simulated-transaction-and-account-value-data" class="nav-link active" data-scroll-target="#simulated-transaction-and-account-value-data">Simulated transaction and account value data</a></li>
  <li><a href="#the-add_transactions-method" id="toc-the-add_transactions-method" class="nav-link" data-scroll-target="#the-add_transactions-method">The <code>add_transactions()</code> method</a></li>
  <li><a href="#the-trx_stats-method" id="toc-the-trx_stats-method" class="nav-link" data-scroll-target="#the-trx_stats-method">The <code>trx_stats()</code> method</a>
  <ul class="collapse">
  <li><a href="#grouped-data" id="toc-grouped-data" class="nav-link" data-scroll-target="#grouped-data">Grouped data</a></li>
  </ul></li>
  <li><a href="#expressing-transactions-as-a-percentage-of-another-value" id="toc-expressing-transactions-as-a-percentage-of-another-value" class="nav-link" data-scroll-target="#expressing-transactions-as-a-percentage-of-another-value">Expressing transactions as a percentage of another value</a></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals">Confidence intervals</a></li>
  <li><a href="#plot-and-table" id="toc-plot-and-table" class="nav-link" data-scroll-target="#plot-and-table"><code>plot()</code> and <code>table()</code></a></li>
  <li><a href="#miscellaneous" id="toc-miscellaneous" class="nav-link" data-scroll-target="#miscellaneous">Miscellaneous</a>
  <ul class="collapse">
  <li><a href="#selecting-and-combining-transaction-types" id="toc-selecting-and-combining-transaction-types" class="nav-link" data-scroll-target="#selecting-and-combining-transaction-types">Selecting and combining transaction types</a></li>
  <li><a href="#partial-exposures-are-removed-as-a-default" id="toc-partial-exposures-are-removed-as-a-default" class="nav-link" data-scroll-target="#partial-exposures-are-removed-as-a-default">Partial exposures are removed as a default</a></li>
  <li><a href="#summary-method" id="toc-summary-method" class="nav-link" data-scroll-target="#summary-method">Summary method</a></li>
  <li><a href="#column-names" id="toc-column-names" class="nav-link" data-scroll-target="#column-names">Column names</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Transaction studies</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This article walks through an example of creating a <strong>transaction study</strong> using the actxps package. Unlike a termination study, transaction studies track events that can occur multiple times over the life of a policy. Often, transactions are expected to reoccur; for example, the utilization of a guaranteed income stream.</p>
<p>Key questions to answer in a transaction study are:</p>
<ul>
<li>What types of transactions occurred?</li>
<li>What is the count, amount, and average size of observed transactions?</li>
<li>What percentage of policies have transactions each exposure period?</li>
<li>How do transactions compare to expectations?</li>
<li>What is the rate of transaction amounts as a percentage of another value?</li>
</ul>
<p>The example below walks through preparing data by adding transaction information to an <code>ExposedDF</code> object using the <code>add_transactions()</code> method. Next, study results are summarized using the <code>trx_stats()</code> method.</p>
<section id="simulated-transaction-and-account-value-data" class="level2">
<h2 class="anchored" data-anchor-id="simulated-transaction-and-account-value-data">Simulated transaction and account value data</h2>
<p>In this example, we’ll be using the <code>census_dat</code>, <code>withdrawals</code>, and <code>account_vals</code> data sets. Each data set is based on a theoretical block of deferred annuity business with a guaranteed lifetime income benefit.</p>
<ul>
<li><code>census_dat</code> contains census-level information with one row per policy</li>
<li><code>withdrawals</code> contains withdrawal transactions. There are 2 types of transactions in the data: “Base” (ordinary withdrawals) and “Rider” (guaranteed income payments).</li>
<li><code>account_vals</code> contains historical account values on policy anniversaries. This data will be used to calculate withdrawal rates as a percentage of account values.</li>
</ul>
</section>
<section id="the-add_transactions-method" class="level2">
<h2 class="anchored" data-anchor-id="the-add_transactions-method">The <code>add_transactions()</code> method</h2>
<p>The <code>add_transactions()</code> method attaches transactions to an <code>ExposedDF</code> object, which contains a data frame with exposure-level records. For our example, we first need to convert <code>census_dat</code> into exposure records using <code>ExposedDF()</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> This example will use policy year exposures.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> actxps <span class="im">as</span> xp</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>census_dat <span class="op">=</span> xp.load_census_dat()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>exposed_data <span class="op">=</span> xp.ExposedDF(census_dat, <span class="st">"2019-12-31"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                            target_status<span class="op">=</span><span class="st">"Surrender"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>exposed_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="packages" class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Exposure data

Exposure type: policy_year
Target status: Surrender
Study range: 1900-01-01 to 2019-12-31

shape: (141_252, 15)
┌─────────┬────────┬────────────┬──────────┬───┬────────┬─────────────┬─────────────────┬──────────┐
│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_end ┆ exposure │
│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---    ┆ ---         ┆ ---             ┆ ---      │
│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ u32    ┆ date        ┆ date            ┆ f64      │
╞═════════╪════════╪════════════╪══════════╪═══╪════════╪═════════════╪═════════════════╪══════════╡
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 1      ┆ 2014-12-17  ┆ 2015-12-16      ┆ 1.0      │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 2      ┆ 2015-12-17  ┆ 2016-12-16      ┆ 1.0      │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 3      ┆ 2016-12-17  ┆ 2017-12-16      ┆ 1.0      │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 4      ┆ 2017-12-17  ┆ 2018-12-16      ┆ 1.0      │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 5      ┆ 2018-12-17  ┆ 2019-12-16      ┆ 1.0      │
│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …      ┆ …           ┆ …               ┆ …        │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 7      ┆ 2015-04-29  ┆ 2016-04-28      ┆ 1.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 8      ┆ 2016-04-29  ┆ 2017-04-28      ┆ 1.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 9      ┆ 2017-04-29  ┆ 2018-04-28      ┆ 1.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 10     ┆ 2018-04-29  ┆ 2019-04-28      ┆ 1.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 11     ┆ 2019-04-29  ┆ 2020-04-28      ┆ 0.674863 │
└─────────┴────────┴────────────┴──────────┴───┴────────┴─────────────┴─────────────────┴──────────┘</code></pre>
</div>
</div>
<p>The <code>withdrawals</code> data has 4 columns that are required for attaching transactions:</p>
<ul>
<li><code>pol_num</code>: policy number</li>
<li><code>trx_date</code>: transaction date</li>
<li><code>trx_type</code>: transaction type</li>
<li><code>trx_amt</code>: transaction amount</li>
</ul>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>withdrawals <span class="op">=</span> xp.load_withdrawals()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>withdrawals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="wd-head" class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (160_130, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">pol_num</th>
<th data-quarto-table-cell-role="th">trx_date</th>
<th data-quarto-table-cell-role="th">trx_type</th>
<th data-quarto-table-cell-role="th">trx_amt</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>date</th>
<th>cat</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2007-10-05</td>
<td>"Base"</td>
<td>25.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2009-07-30</td>
<td>"Base"</td>
<td>12.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2010-02-22</td>
<td>"Base"</td>
<td>7.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2010-12-30</td>
<td>"Base"</td>
<td>52.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2012-05-07</td>
<td>"Base"</td>
<td>41.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>20000</td>
<td>2015-08-08</td>
<td>"Rider"</td>
<td>547.0</td>
</tr>
<tr class="even">
<td>20000</td>
<td>2016-07-26</td>
<td>"Rider"</td>
<td>106.0</td>
</tr>
<tr class="odd">
<td>20000</td>
<td>2017-12-29</td>
<td>"Rider"</td>
<td>31.0</td>
</tr>
<tr class="even">
<td>20000</td>
<td>2018-06-14</td>
<td>"Rider"</td>
<td>75.0</td>
</tr>
<tr class="odd">
<td>20000</td>
<td>2019-12-09</td>
<td>"Rider"</td>
<td>466.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The grain of this data is one row per policy per transaction. The expectation is that the number of records in the transaction data will not match the number of rows in the exposure data. That is because policies could have zero or several transactions in a given exposure period.</p>
<p>The <code>add_transactions()</code> method uses a non-equivalent join to associate each transaction with a policy number and a date interval found in the exposure data. Then, transaction counts and amounts are summarized such that there is one row per exposure period. In the event there are multiple transaction types found in the data, separate columns are created for each transaction type.</p>
<p>Using our example, we pass both the exposure and withdrawals data to <code>add_transactions()</code>. The resulting data has the same number of rows as original exposure data and 4 new columns:</p>
<ul>
<li><code>trx_amt_Base</code>: the sum of “Base” withdrawal transactions</li>
<li><code>trx_amt_Rider</code>: the sum of “Rider” withdrawal transactions</li>
<li><code>trx_n_Base</code>: the number of “Base” withdrawal transactions</li>
<li><code>trx_n_Rider</code>: the number of “Rider” withdrawal transactions</li>
</ul>
<div id="add-trx" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>exposed_data.add_transactions(withdrawals)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>exposed_data.data.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 141252
Columns: 19
$ pol_num          &lt;i64&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 2
$ status          &lt;enum&gt; Active, Active, Active, Active, Active, Active, Active, Active, Active, Active
$ issue_date      &lt;date&gt; 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2007-09-24, 2007-09-24, 2007-09-24, 2007-09-24
$ inc_guar        &lt;bool&gt; True, True, True, True, True, True, False, False, False, False
$ qual            &lt;bool&gt; False, False, False, False, False, False, False, False, False, False
$ age              &lt;i64&gt; 56, 56, 56, 56, 56, 56, 71, 71, 71, 71
$ product          &lt;cat&gt; b, b, b, b, b, b, a, a, a, a
$ gender           &lt;cat&gt; F, F, F, F, F, F, F, F, F, F
$ wd_age           &lt;i64&gt; 77, 77, 77, 77, 77, 77, 71, 71, 71, 71
$ premium          &lt;f64&gt; 370.0, 370.0, 370.0, 370.0, 370.0, 370.0, 708.0, 708.0, 708.0, 708.0
$ term_date       &lt;date&gt; None, None, None, None, None, None, None, None, None, None
$ pol_yr           &lt;u32&gt; 1, 2, 3, 4, 5, 6, 1, 2, 3, 4
$ pol_date_yr     &lt;date&gt; 2014-12-17, 2015-12-17, 2016-12-17, 2017-12-17, 2018-12-17, 2019-12-17, 2007-09-24, 2008-09-24, 2009-09-24, 2010-09-24
$ pol_date_yr_end &lt;date&gt; 2015-12-16, 2016-12-16, 2017-12-16, 2018-12-16, 2019-12-16, 2020-12-16, 2008-09-23, 2009-09-23, 2010-09-23, 2011-09-23
$ exposure         &lt;f64&gt; 1.0, 1.0, 1.0, 1.0, 1.0, 0.04098360655737743, 1.0, 1.0, 1.0, 1.0
$ trx_n_Base       &lt;i32&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
$ trx_n_Rider      &lt;i32&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ trx_amt_Base     &lt;f64&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 25.0, 12.0, 7.0, 52.0
$ trx_amt_Rider    &lt;f64&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
</code></pre>
</div>
</div>
<p>If we print <code>exposed_data</code>, we can see that it has an additional attribute for transaction types that have been attached.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>exposed_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="print-trx-types" class="cell-output cell-output-display" data-execution_count="5">
<pre><code>Exposure data

Exposure type: policy_year
Target status: Surrender
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (141_252, 19)
┌─────────┬────────┬────────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐
│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ trx_n_Base ┆ trx_n_Ride ┆ trx_amt_Ba ┆ trx_amt_Ri │
│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---        ┆ r          ┆ se         ┆ der        │
│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ i32        ┆ ---        ┆ ---        ┆ ---        │
│         ┆        ┆            ┆          ┆   ┆            ┆ i32        ┆ f64        ┆ f64        │
╞═════════╪════════╪════════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │
│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │
│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 547.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 106.0      │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 31.0       │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 75.0       │
│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 466.0      │
└─────────┴────────┴────────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘</code></pre>
</div>
</div>
</section>
<section id="the-trx_stats-method" class="level2">
<h2 class="anchored" data-anchor-id="the-trx_stats-method">The <code>trx_stats()</code> method</h2>
<p>The actxps package’s workhorse function for summarizing transaction experience is the <code>trx_stats()</code> method of the <code>ExposedDF</code> class. This function returns a <code>TrxStats</code> object, which is a type of data frame containing additional attributes about the transaction study.</p>
<p>At a minimum, a <code>TrxStats</code> includes the following for each transaction type (<code>trx_type</code>):</p>
<ul>
<li>The number of transactions (<code>trx_n</code>)</li>
<li>The number of exposure periods with a transaction (<code>trx_flag</code>)</li>
<li>The sum of transactions (<code>trx_amt</code>)</li>
<li>The total exposure (<code>exposure</code>)</li>
<li>The average transaction amount when a transaction occurs (<code>avg_trx</code>)</li>
<li>The average transaction amount across all records (<code>avg_all</code>)</li>
<li>The transaction frequency when a transaction occurs (<code>trx_freq = trx_n / trx_flag</code>)</li>
<li>The transaction utilization (<code>trx_util = trx_flag / exposure</code>)</li>
</ul>
<p>Optionally, a <code>TrxStats</code> can also include:</p>
<ul>
<li>Any grouping variables attached to the input data</li>
<li>Transaction amounts as a percentage of another value when a transaction occurs (<code>pct_of_*_w_trx</code>)</li>
<li>Transaction amounts as a percentage of another value across all records (<code>pct_of_*_all</code>)</li>
</ul>
<p>To use <code>trx_stats()</code>, we simply need to call the method from an <code>ExposedDF</code> object with transactions attached.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>exposed_data.trx_stats()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="trx-basic" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Transaction study results

Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (2, 9)
┌──────────┬─────────┬──────────┬────────────┬───┬───────────┬───────────┬──────────┬──────────┐
│ trx_type ┆ trx_n   ┆ trx_flag ┆ trx_amt    ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │
│ ---      ┆ ---     ┆ ---      ┆ ---        ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │
│ str      ┆ f64     ┆ u32      ┆ f64        ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │
╞══════════╪═════════╪══════════╪════════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡
│ Base     ┆ 60500.0 ┆ 28224    ┆ 1.093899e6 ┆ … ┆ 38.757759 ┆ 8.809475  ┆ 2.143566 ┆ 0.227296 │
│ Rider    ┆ 77321.0 ┆ 35941    ┆ 2.842729e6 ┆ … ┆ 79.094321 ┆ 22.893294 ┆ 2.151331 ┆ 0.289443 │
└──────────┴─────────┴──────────┴────────────┴───┴───────────┴───────────┴──────────┴──────────┘</code></pre>
</div>
</div>
<p>The results show us that we specified no groups, which is why the output data contains a single row for each transaction type.</p>
<section id="grouped-data" class="level3">
<h3 class="anchored" data-anchor-id="grouped-data">Grouped data</h3>
<p>If the data is grouped using the <code>group_by()</code> method, future calls to <code>exp_stats()</code> will contain one record for each unique group.</p>
<p>If the data is grouped using the <code>group_by()</code> method, future calls to <code>trx_stats()</code> will contain one record for each unique group.</p>
<p>In the following, <code>exposed_data</code> is grouped by the presence of an income guarantee (<code>inc_guar</code>) before being passed to <code>trx_stats()</code>. This results in four rows because we have two types of transactions and two distinct values of <code>inc_guar</code>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(exposed_data.</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    group_by(<span class="st">'inc_guar'</span>).</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    trx_stats())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="grouped-1" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Transaction study results

Groups: inc_guar
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (4, 10)
┌──────────┬──────────┬─────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐
│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │
│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │
│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │
╞══════════╪══════════╪═════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡
│ false    ┆ Base     ┆ 52939.0 ┆ 24703    ┆ … ┆ 38.563292 ┆ 19.466039 ┆ 2.143019 ┆ 0.504782 │
│ false    ┆ Rider    ┆ 0.0     ┆ 0        ┆ … ┆ NaN       ┆ 0.0       ┆ NaN      ┆ 0.0      │
│ true     ┆ Base     ┆ 7561.0  ┆ 3521     ┆ … ┆ 40.122124 ┆ 1.877716  ┆ 2.147401 ┆ 0.0468   │
│ true     ┆ Rider    ┆ 77321.0 ┆ 35941    ┆ … ┆ 79.094321 ┆ 37.784661 ┆ 2.151331 ┆ 0.477716 │
└──────────┴──────────┴─────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘</code></pre>
</div>
</div>
<p>Multiple grouping variables are allowed. Below, policy year (<code>pol_yr</code>) is added as a second grouping variable.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(exposed_data.</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    group_by(<span class="st">'inc_guar'</span>, <span class="st">'pol_yr'</span>).</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    trx_stats())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="grouped-2" class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Transaction study results

Groups: inc_guar, pol_yr
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (60, 11)
┌──────────┬────────┬──────────┬────────┬───┬────────────┬───────────┬──────────┬──────────┐
│ inc_guar ┆ pol_yr ┆ trx_type ┆ trx_n  ┆ … ┆ avg_trx    ┆ avg_all   ┆ trx_freq ┆ trx_util │
│ ---      ┆ ---    ┆ ---      ┆ ---    ┆   ┆ ---        ┆ ---       ┆ ---      ┆ ---      │
│ bool     ┆ u32    ┆ str      ┆ f64    ┆   ┆ f64        ┆ f64       ┆ f64      ┆ f64      │
╞══════════╪════════╪══════════╪════════╪═══╪════════════╪═══════════╪══════════╪══════════╡
│ false    ┆ 1      ┆ Base     ┆ 6077.0 ┆ … ┆ 34.115585  ┆ 13.219502 ┆ 2.109337 ┆ 0.387492 │
│ false    ┆ 1      ┆ Rider    ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │
│ false    ┆ 2      ┆ Base     ┆ 6091.0 ┆ … ┆ 34.374083  ┆ 14.444885 ┆ 2.127489 ┆ 0.420226 │
│ false    ┆ 2      ┆ Rider    ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │
│ false    ┆ 3      ┆ Base     ┆ 6016.0 ┆ … ┆ 34.584074  ┆ 15.752105 ┆ 2.138642 ┆ 0.455473 │
│ …        ┆ …      ┆ …        ┆ …      ┆ … ┆ …          ┆ …         ┆ …        ┆ …        │
│ true     ┆ 13     ┆ Rider    ┆ 1486.0 ┆ … ┆ 94.984894  ┆ 71.698974 ┆ 2.244713 ┆ 0.754846 │
│ true     ┆ 14     ┆ Base     ┆ 26.0   ┆ … ┆ 83.8       ┆ 2.100251  ┆ 2.6      ┆ 0.025063 │
│ true     ┆ 14     ┆ Rider    ┆ 736.0  ┆ … ┆ 96.987342  ┆ 76.81203  ┆ 2.329114 ┆ 0.79198  │
│ true     ┆ 15     ┆ Base     ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │
│ true     ┆ 15     ┆ Rider    ┆ 19.0   ┆ … ┆ 104.888889 ┆ 85.818182 ┆ 2.111111 ┆ 0.818182 │
└──────────┴────────┴──────────┴────────┴───┴────────────┴───────────┴──────────┴──────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="expressing-transactions-as-a-percentage-of-another-value" class="level2">
<h2 class="anchored" data-anchor-id="expressing-transactions-as-a-percentage-of-another-value">Expressing transactions as a percentage of another value</h2>
<p>In a transaction study, we often want to express transaction amounts as a percentage of another value. For example, in a withdrawal study, withdrawal amounts divided by account values provides a withdrawal rate. In a study of benefit utilization, transactions can be divided by a maximum benefit amount to derive a benefit utilization rate. In addition, actual-to-expected rates can be calculated by dividing transactions by expected values.</p>
<p>If column names are passed to the <code>percent_of</code> argument of <code>trx_stats()</code>, the output will contain 4 additional columns for each “percent of” variable:</p>
<ul>
<li>The sum of each “percent of” variable</li>
<li>The sum of each “percent of” variable when a transaction occurs. These columns include the suffix <code>_w_trx</code>.</li>
<li>Transaction amounts divided by each “percent of” variable (<code>pct_of_{*}_all</code>)</li>
<li>Transaction amounts divided by each “percent of” variable when a transaction occurs (<code>pct_of_{*}_w_trx</code>)</li>
</ul>
<p>For our example, let’s assume we’re interested in examining withdrawal transactions as a percentage of account values, which are available in the <code>account_vals</code> data frame in the column <code>av_anniv</code>.</p>
<div id="pct-of" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach account values data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>account_vals <span class="op">=</span> xp.load_account_vals()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>exposed_data.data <span class="op">=</span> <span class="op">\</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    exposed_data.data.join(account_vals,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                           on<span class="op">=</span>[<span class="st">'pol_num'</span>, <span class="st">'pol_date_yr'</span>],</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                           how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>trx_res <span class="op">=</span> (exposed_data.</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>           group_by(<span class="st">'pol_yr'</span>, <span class="st">'inc_guar'</span>).</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>           trx_stats(percent_of<span class="op">=</span><span class="st">"av_anniv"</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>trx_res.data.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 60
Columns: 15
$ pol_yr                 &lt;u32&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3
$ inc_guar              &lt;bool&gt; False, False, True, True, False, False, True, True, False, False
$ trx_type               &lt;str&gt; 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider'
$ trx_n                  &lt;f64&gt; 6077.0, 0.0, 1370.0, 8077.0, 6091.0, 0.0, 1183.0, 8232.0, 6016.0, 0.0
$ trx_flag               &lt;u32&gt; 2881, 0, 633, 3778, 2863, 0, 559, 3834, 2813, 0
$ trx_amt                &lt;f64&gt; 98287.0, 0.0, 21590.0, 265312.0, 98413.0, 0.0, 18554.0, 288114.0, 97285.0, 0.0
$ exposure               &lt;f64&gt; 7435.0, 7435.0, 11106.0, 11106.0, 6813.0, 6813.0, 10158.0, 10158.0, 6176.0, 6176.0
$ av_anniv               &lt;f64&gt; 9686914.0, 9686914.0, 14679001.0, 14679001.0, 9218561.0, 9218561.0, 13795383.0, 13795383.0, 8682868.0, 8682868.0
$ av_anniv_w_trx         &lt;f64&gt; 3875306.0, 0.0, 865046.0, 4982082.0, 3909786.0, 0.0, 797932.0, 5022297.0, 3954457.0, 0.0
$ avg_trx                &lt;f64&gt; 34.11558486636584, nan, 34.107424960505526, 70.22551614610906, 34.37408312958435, nan, 33.19141323792486, 75.1471048513302, 34.584073942410235, nan
$ avg_all                &lt;f64&gt; 13.219502353732347, 0.0, 1.9439942373491805, 23.889068971726996, 14.444884779098782, 0.0, 1.8265406576097658, 28.36326048434731, 15.752104922279793, 0.0
$ trx_freq               &lt;f64&gt; 2.109337035751475, nan, 2.1642969984202214, 2.13790365272631, 2.1274886482710444, nan, 2.116279069767442, 2.1471048513302033, 2.1386420191965874, nan
$ trx_util               &lt;f64&gt; 0.3874915938130464, 0.0, 0.056996218260399786, 0.3401764811813434, 0.4202260384558931, 0.0, 0.055030517818468204, 0.377436503248671, 0.45547279792746115, 0.0
$ pct_of_av_anniv_all    &lt;f64&gt; 0.01014636859581906, 0.0, 0.0014708085379924697, 0.018074254508191667, 0.010675527340980876, 0.0, 0.0013449427246782493, 0.020884813419098258, 0.011204247260237055, 0.0
$ pct_of_av_anniv_w_trx  &lt;f64&gt; 0.025362384286556985, nan, 0.024958210314827187, 0.05325323830478904, 0.025170942859788235, nan, 0.023252607991658437, 0.057366977699646195, 0.024601354876282636, nan
</code></pre>
</div>
</div>
</section>
<section id="confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="confidence-intervals">Confidence intervals</h2>
<p>If <code>conf_int</code> is set to <code>True</code>, <code>trx_stats()</code> will produce lower and upper confidence interval limits for the observed utilization rate. Confidence intervals are constructed assuming a binomial distribution.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(exposed_data.</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    group_by(<span class="st">'pol_yr'</span>).</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    trx_stats(conf_int<span class="op">=</span><span class="va">True</span>).</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    data.select(<span class="st">'pol_yr'</span>, pl.col(<span class="st">'^trx_util.*$'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="trx-conf1" class="cell-output cell-output-display" data-execution_count="10">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (30, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">pol_yr</th>
<th data-quarto-table-cell-role="th">trx_util</th>
<th data-quarto-table-cell-role="th">trx_util_lower</th>
<th data-quarto-table-cell-role="th">trx_util_upper</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.189526</td>
<td>0.183917</td>
<td>0.195189</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.203765</td>
<td>0.197994</td>
<td>0.20959</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.201638</td>
<td>0.195628</td>
<td>0.207707</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.225915</td>
<td>0.21961</td>
<td>0.23222</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.214912</td>
<td>0.208417</td>
<td>0.221407</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>13</td>
<td>0.516784</td>
<td>0.489461</td>
<td>0.544106</td>
</tr>
<tr class="even">
<td>14</td>
<td>0.245645</td>
<td>0.210801</td>
<td>0.280488</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.550523</td>
<td>0.510453</td>
<td>0.590592</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.380952</td>
<td>0.190476</td>
<td>0.571429</td>
</tr>
<tr class="odd">
<td>15</td>
<td>0.428571</td>
<td>0.238095</td>
<td>0.619048</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The default confidence level is 95%. This can be changed using the <code>conf_level</code> argument. Below, tighter confidence intervals are constructed by decreasing the confidence level to 90%.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(exposed_data.</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    group_by(<span class="st">'pol_yr'</span>).</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    trx_stats(conf_int<span class="op">=</span><span class="va">True</span>, conf_level<span class="op">=</span><span class="fl">0.9</span>).</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    data.select(<span class="st">'pol_yr'</span>, pl.col(<span class="st">'^trx_util.*$'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="trx-conf2" class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (30, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">pol_yr</th>
<th data-quarto-table-cell-role="th">trx_util</th>
<th data-quarto-table-cell-role="th">trx_util_lower</th>
<th data-quarto-table-cell-role="th">trx_util_upper</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.189526</td>
<td>0.18478</td>
<td>0.194272</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.203765</td>
<td>0.198911</td>
<td>0.208619</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.201638</td>
<td>0.196571</td>
<td>0.206706</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.225915</td>
<td>0.220671</td>
<td>0.231218</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.214912</td>
<td>0.209456</td>
<td>0.220368</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>13</td>
<td>0.516784</td>
<td>0.494145</td>
<td>0.539422</td>
</tr>
<tr class="even">
<td>14</td>
<td>0.245645</td>
<td>0.216028</td>
<td>0.275261</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.550523</td>
<td>0.515679</td>
<td>0.585366</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.380952</td>
<td>0.190476</td>
<td>0.571429</td>
</tr>
<tr class="odd">
<td>15</td>
<td>0.428571</td>
<td>0.238095</td>
<td>0.619048</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>If any column names are passed to <code>percent_of</code>, <code>trx_stats()</code> will produce additional confidence intervals:</p>
<ul>
<li>Intervals for transactions as a percentage of another column when transactions occur (<code>pct_of_{*}_w_trx</code>) are constructed using a normal distribution.</li>
<li>Intervals for transactions as a percentage of another column regardless of transaction utilization (<code>pct_of_{*}_all</code>) are calculated assuming that the aggregate distribution is normal with a mean equal to observed transactions and a variance equal to:</li>
</ul>
<p><span class="math display">\[
     Var(S) = E(N) \times Var(X) + E(X)^2 \times Var(N),
\]</span> Where <code>S</code> is the aggregate transactions random variable, <code>X</code> is an individual transaction amount assumed to follow a normal distribution, and <code>N</code> is a binomial random variable for transaction utilization.</p>
<div id="trx-conf3" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(exposed_data.</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    group_by(<span class="st">'pol_yr'</span>).</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    trx_stats(conf_int<span class="op">=</span><span class="va">True</span>, percent_of<span class="op">=</span><span class="st">"av_anniv"</span>).</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    data.select(<span class="st">'pol_yr'</span>, pl.col(<span class="st">'^pct_of.*$'</span>)).</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    glimpse())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 30
Columns: 7
$ pol_yr                      &lt;u32&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5
$ pct_of_av_anniv_all         &lt;f64&gt; 0.004919864491031837, 0.010888653268305336, 0.005082440454361061, 0.012519105808200455, 0.0054184028999354535, 0.01372773518470287, 0.0057982676649823905, 0.014308868197434476, 0.006049953867711983, 0.01458240440835664
$ pct_of_av_anniv_w_trx       &lt;f64&gt; 0.02528862835502511, 0.05325323830478904, 0.024845795776212595, 0.057366977699646195, 0.025090409528046198, 0.058707111268391836, 0.02573072327170688, 0.058632474394021104, 0.025600201973245067, 0.05745971742829165
$ pct_of_av_anniv_w_trx_lower &lt;f64&gt; 0.024019602566381235, 0.05078956041146959, 0.02362582577122162, 0.05443418723085425, 0.02388004600357687, 0.055946842712423055, 0.024241205873009836, 0.05572760267518904, 0.024227755075207042, 0.05431596122849967
$ pct_of_av_anniv_w_trx_upper &lt;f64&gt; 0.02655765414366899, 0.055716916198108486, 0.02606576578120357, 0.06029976816843815, 0.02630077305251553, 0.061467379824360624, 0.02722024067040392, 0.06153734611285317, 0.02697264887128309, 0.06060347362808364
$ pct_of_av_anniv_all_lower   &lt;f64&gt; 0.004632812409391607, 0.010297256498243708, 0.004790158298104324, 0.011790284670673416, 0.00511005224674474, 0.012979911178210493, 0.005417177353585797, 0.013498165909945252, 0.005671678443875981, 0.01368698584634903
$ pct_of_av_anniv_all_upper   &lt;f64&gt; 0.0052069165726720676, 0.011480050038366964, 0.005374722610617797, 0.013247926945727493, 0.0057267535531261675, 0.014475559191195248, 0.006179357976378984, 0.0151195704849237, 0.006428229291547985, 0.01547782297036425
</code></pre>
</div>
</div>
</section>
<section id="plot-and-table" class="level2">
<h2 class="anchored" data-anchor-id="plot-and-table"><code>plot()</code> and <code>table()</code></h2>
<p>The <code>plot()</code> and <code>table()</code> methods create visualizations and summary tables from <code>TrxStats</code> objects. See See <a href="../articles/visualizations.html">Visualizations</a> for full details on these functions.</p>
<div id="trx-plot" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>trx_res.plot(y<span class="op">=</span><span class="st">'pct_of_av_anniv_w_trx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="transactions_files/figure-html/trx-plot-output-1.png" id="trx-plot-1" class="img-fluid"></p>
</div>
<div id="trx-plot-2" class="cell-output cell-output-display" data-execution_count="13">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div id="trx-table" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first 10 rows showed for brevity</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>trx_res.table()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<center>
<img src="../images/trx_gt.png" width="65%" height="65%">
</center>
</section>
<section id="miscellaneous" class="level2">
<h2 class="anchored" data-anchor-id="miscellaneous">Miscellaneous</h2>
<section id="selecting-and-combining-transaction-types" class="level3">
<h3 class="anchored" data-anchor-id="selecting-and-combining-transaction-types">Selecting and combining transaction types</h3>
<p>The <code>trx_types</code> argument of <code>trx_stats()</code> selects a subset of transaction types that will appear in the output.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>exposed_data.trx_stats(trx_types<span class="op">=</span><span class="st">"Base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="select-trx-type" class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Transaction study results

Groups: pol_yr
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base

shape: (15, 10)
┌────────┬──────────┬────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐
│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │
│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │
│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │
╞════════╪══════════╪════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡
│ 1      ┆ Base     ┆ 7447.0 ┆ 3514     ┆ … ┆ 34.114115 ┆ 6.465509  ┆ 2.119237 ┆ 0.189526 │
│ 2      ┆ Base     ┆ 7274.0 ┆ 3422     ┆ … ┆ 34.180888 ┆ 6.892169  ┆ 2.125658 ┆ 0.201638 │
│ 3      ┆ Base     ┆ 7061.0 ┆ 3309     ┆ … ┆ 35.163796 ┆ 7.557122  ┆ 2.133877 ┆ 0.214912 │
│ 4      ┆ Base     ┆ 6596.0 ┆ 3080     ┆ … ┆ 37.333442 ┆ 8.338434  ┆ 2.141558 ┆ 0.22335  │
│ 5      ┆ Base     ┆ 6093.0 ┆ 2847     ┆ … ┆ 38.60836  ┆ 8.984633  ┆ 2.140148 ┆ 0.232712 │
│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …         ┆ …         ┆ …        ┆ …        │
│ 11     ┆ Base     ┆ 2428.0 ┆ 1115     ┆ … ┆ 48.259193 ┆ 13.804259 ┆ 2.177578 ┆ 0.286044 │
│ 12     ┆ Base     ┆ 1320.0 ┆ 605      ┆ … ┆ 50.289256 ┆ 13.414903 ┆ 2.181818 ┆ 0.266755 │
│ 13     ┆ Base     ┆ 700.0  ┆ 319      ┆ … ┆ 55.827586 ┆ 13.90242  ┆ 2.194357 ┆ 0.249024 │
│ 14     ┆ Base     ┆ 315.0  ┆ 141      ┆ … ┆ 63.0      ┆ 15.47561  ┆ 2.234043 ┆ 0.245645 │
│ 15     ┆ Base     ┆ 19.0   ┆ 8        ┆ … ┆ 28.125    ┆ 10.714286 ┆ 2.375    ┆ 0.380952 │
└────────┴──────────┴────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘</code></pre>
</div>
</div>
<p>If the <code>combine_trx</code> argument is set to <code>True</code>, all transaction types will be combined in a group called “All” in the output.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>exposed_data.trx_stats(combine_trx<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="combine-trx" class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Transaction study results

Groups: pol_yr
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (15, 10)
┌────────┬──────────┬─────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐
│ pol_yr ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │
│ ---    ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │
│ u32    ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │
╞════════╪══════════╪═════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡
│ 1      ┆ All      ┆ 15524.0 ┆ 7292     ┆ … ┆ 52.823505 ┆ 20.774985 ┆ 2.128908 ┆ 0.393291 │
│ 2      ┆ All      ┆ 15506.0 ┆ 7256     ┆ … ┆ 55.82704  ┆ 23.869012 ┆ 2.13699  ┆ 0.427553 │
│ 3      ┆ All      ┆ 15265.0 ┆ 7126     ┆ … ┆ 57.697446 ┆ 26.703384 ┆ 2.142155 ┆ 0.462817 │
│ 4      ┆ All      ┆ 14556.0 ┆ 6795     ┆ … ┆ 58.682855 ┆ 28.915881 ┆ 2.142163 ┆ 0.492748 │
│ 5      ┆ All      ┆ 13629.0 ┆ 6368     ┆ … ┆ 58.865735 ┆ 30.640592 ┆ 2.140232 ┆ 0.520517 │
│ …      ┆ …        ┆ …       ┆ …        ┆ … ┆ …         ┆ …         ┆ …        ┆ …        │
│ 11     ┆ All      ┆ 5896.0  ┆ 2712     ┆ … ┆ 71.323378 ┆ 49.622627 ┆ 2.174041 ┆ 0.695741 │
│ 12     ┆ All      ┆ 3718.0  ┆ 1681     ┆ … ┆ 71.917906 ┆ 53.304233 ┆ 2.211779 ┆ 0.741182 │
│ 13     ┆ All      ┆ 2186.0  ┆ 981      ┆ … ┆ 82.251784 ┆ 62.989071 ┆ 2.228338 ┆ 0.765808 │
│ 14     ┆ All      ┆ 1051.0  ┆ 457      ┆ … ┆ 86.501094 ┆ 68.869338 ┆ 2.299781 ┆ 0.796167 │
│ 15     ┆ All      ┆ 38.0    ┆ 17       ┆ … ┆ 68.764706 ┆ 55.666667 ┆ 2.235294 ┆ 0.809524 │
└────────┴──────────┴─────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘</code></pre>
</div>
</div>
</section>
<section id="partial-exposures-are-removed-as-a-default" class="level3">
<h3 class="anchored" data-anchor-id="partial-exposures-are-removed-as-a-default">Partial exposures are removed as a default</h3>
<p>As a default, <code>trx_stats()</code> removes partial exposures before summarizing results. This is done to avoid complexity associated with a lopsided skew in the timing of transactions. For example, if transactions can occur on a monthly basis or annually at the beginning of each policy year, partial exposures may not be appropriate. If a policy had an exposure of 0.5 years and was taking withdrawals annually at the beginning of the year, an argument could be made that the exposure should instead be 1 complete year. If the same policy was expected to take withdrawals 9 months into the year, it’s not clear if the exposure should be 0.5 years or 0.5 / 0.75 years. To override this treatment, set the <code>full_exposures_only</code> argument to <code>False</code>.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>exposed_data.trx_stats(full_exposures_only<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="partial-expo-ok" class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Transaction study results

Groups: pol_yr
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider

shape: (30, 10)
┌────────┬──────────┬────────┬──────────┬───┬────────────┬────────────┬──────────┬──────────┐
│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ avg_trx    ┆ avg_all    ┆ trx_freq ┆ trx_util │
│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---        ┆ ---        ┆ ---      ┆ ---      │
│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64        ┆ f64        ┆ f64      ┆ f64      │
╞════════╪══════════╪════════╪══════════╪═══╪════════════╪════════════╪══════════╪══════════╡
│ 1      ┆ Base     ┆ 8123.0 ┆ 3818     ┆ … ┆ 33.82792   ┆ 6.70858    ┆ 2.127554 ┆ 0.198315 │
│ 1      ┆ Rider    ┆ 8819.0 ┆ 4103     ┆ … ┆ 70.828175  ┆ 15.094785  ┆ 2.149403 ┆ 0.213118 │
│ 2      ┆ Base     ┆ 7924.0 ┆ 3737     ┆ … ┆ 34.321113  ┆ 7.240169   ┆ 2.120417 ┆ 0.210954 │
│ 2      ┆ Rider    ┆ 8976.0 ┆ 4186     ┆ … ┆ 74.692069  ┆ 17.649725  ┆ 2.14429  ┆ 0.2363   │
│ 3      ┆ Base     ┆ 7668.0 ┆ 3603     ┆ … ┆ 35.304468  ┆ 7.90215    ┆ 2.128226 ┆ 0.223829 │
│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …          ┆ …          ┆ …        ┆ …        │
│ 13     ┆ Rider    ┆ 2285.0 ┆ 1026     ┆ … ┆ 91.708577  ┆ 58.085349  ┆ 2.227096 ┆ 0.633369 │
│ 14     ┆ Base     ┆ 622.0  ┆ 283      ┆ … ┆ 60.55477   ┆ 19.656158  ┆ 2.19788  ┆ 0.324601 │
│ 14     ┆ Rider    ┆ 1497.0 ┆ 663      ┆ … ┆ 102.467572 ┆ 77.922667  ┆ 2.257919 ┆ 0.760462 │
│ 15     ┆ Base     ┆ 277.0  ┆ 121      ┆ … ┆ 75.280992  ┆ 33.966156  ┆ 2.289256 ┆ 0.451192 │
│ 15     ┆ Rider    ┆ 705.0  ┆ 309      ┆ … ┆ 101.032362 ┆ 116.411179 ┆ 2.281553 ┆ 1.152217 │
└────────┴──────────┴────────┴──────────┴───┴────────────┴────────────┴──────────┴──────────┘</code></pre>
</div>
</div>
</section>
<section id="summary-method" class="level3">
<h3 class="anchored" data-anchor-id="summary-method">Summary method</h3>
<p>As noted above, the result of <code>trx_stats()</code> is a <code>TrxStats</code> object. If the <code>summary()</code> function is applied to a <code>TrxStats</code> object, the data will be summarized again and return a higher level <code>TrxStats</code> object.</p>
<p>If no additional arguments are passed, <code>summary()</code> returns a single row of aggregate results for each transaction type.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trx_res.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="summary1" class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Transaction study results

Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider
Transactions as % of: av_anniv

shape: (2, 13)
┌──────────┬─────────┬──────────┬────────────┬───┬──────────┬──────────┬─────────────┬─────────────┐
│ trx_type ┆ trx_n   ┆ trx_flag ┆ trx_amt    ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_a ┆ pct_of_av_a │
│ ---      ┆ ---     ┆ ---      ┆ ---        ┆   ┆ ---      ┆ ---      ┆ nniv_all    ┆ nniv_w_trx  │
│ str      ┆ f64     ┆ u32      ┆ f64        ┆   ┆ f64      ┆ f64      ┆ ---         ┆ ---         │
│          ┆         ┆          ┆            ┆   ┆          ┆          ┆ f64         ┆ f64         │
╞══════════╪═════════╪══════════╪════════════╪═══╪══════════╪══════════╪═════════════╪═════════════╡
│ Base     ┆ 60500.0 ┆ 28224    ┆ 1.093899e6 ┆ … ┆ 2.143566 ┆ 0.227296 ┆ 0.005943    ┆ 0.025139    │
│ Rider    ┆ 77321.0 ┆ 35941    ┆ 2.842729e6 ┆ … ┆ 2.151331 ┆ 0.289443 ┆ 0.015444    ┆ 0.059616    │
└──────────┴─────────┴──────────┴────────────┴───┴──────────┴──────────┴─────────────┴─────────────┘</code></pre>
</div>
</div>
<p>If additional variable names are passed to the <code>summary()</code> function, then the output will group the data by those variables. In our example, if <code>pol_yr</code> is passed to <code>summary()</code>, the output will contain one row per policy year for each transaction type.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>trx_res.summary(<span class="st">'pol_yr'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="summary2" class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Transaction study results

Groups: pol_yr
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider
Transactions as % of: av_anniv

shape: (30, 14)
┌────────┬──────────┬────────┬──────────┬───┬──────────┬──────────┬────────────────┬───────────────┐
│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_anni ┆ pct_of_av_ann │
│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---      ┆ ---      ┆ v_all          ┆ iv_w_trx      │
│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64      ┆ f64      ┆ ---            ┆ ---           │
│        ┆          ┆        ┆          ┆   ┆          ┆          ┆ f64            ┆ f64           │
╞════════╪══════════╪════════╪══════════╪═══╪══════════╪══════════╪════════════════╪═══════════════╡
│ 1      ┆ Base     ┆ 7447.0 ┆ 3514     ┆ … ┆ 2.119237 ┆ 0.189526 ┆ 0.00492        ┆ 0.025289      │
│ 1      ┆ Rider    ┆ 8077.0 ┆ 3778     ┆ … ┆ 2.137904 ┆ 0.203765 ┆ 0.010889       ┆ 0.053253      │
│ 2      ┆ Base     ┆ 7274.0 ┆ 3422     ┆ … ┆ 2.125658 ┆ 0.201638 ┆ 0.005082       ┆ 0.024846      │
│ 2      ┆ Rider    ┆ 8232.0 ┆ 3834     ┆ … ┆ 2.147105 ┆ 0.225915 ┆ 0.012519       ┆ 0.057367      │
│ 3      ┆ Base     ┆ 7061.0 ┆ 3309     ┆ … ┆ 2.133877 ┆ 0.214912 ┆ 0.005418       ┆ 0.02509       │
│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …        ┆ …        ┆ …              ┆ …             │
│ 13     ┆ Rider    ┆ 1486.0 ┆ 662      ┆ … ┆ 2.244713 ┆ 0.516784 ┆ 0.025157       ┆ 0.064411      │
│ 14     ┆ Base     ┆ 315.0  ┆ 141      ┆ … ┆ 2.234043 ┆ 0.245645 ┆ 0.007851       ┆ 0.024588      │
│ 14     ┆ Rider    ┆ 736.0  ┆ 316      ┆ … ┆ 2.329114 ┆ 0.550523 ┆ 0.027088       ┆ 0.068         │
│ 15     ┆ Base     ┆ 19.0   ┆ 8        ┆ … ┆ 2.375    ┆ 0.380952 ┆ 0.00725        ┆ 0.02034       │
│ 15     ┆ Rider    ┆ 19.0   ┆ 9        ┆ … ┆ 2.111111 ┆ 0.428571 ┆ 0.030418       ┆ 0.078347      │
└────────┴──────────┴────────┴──────────┴───┴──────────┴──────────┴────────────────┴───────────────┘</code></pre>
</div>
</div>
<p>Similarly, if <code>inc_guar</code> is passed to <code>summary()</code>, the output will contain a row for each transaction type and unique value in <code>inc_guar</code>.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>trx_res.summary(<span class="st">'inc_guar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="summary3" class="cell-output cell-output-display" data-execution_count="19">
<pre><code>Transaction study results

Groups: inc_guar
Study range: 1900-01-01 to 2019-12-31
Transaction types: Base, Rider
Transactions as % of: av_anniv

shape: (4, 14)
┌──────────┬──────────┬─────────┬──────────┬───┬──────────┬──────────┬──────────────┬──────────────┐
│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_an ┆ pct_of_av_an │
│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---      ┆ ---      ┆ niv_all      ┆ niv_w_trx    │
│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64      ┆ f64      ┆ ---          ┆ ---          │
│          ┆          ┆         ┆          ┆   ┆          ┆          ┆ f64          ┆ f64          │
╞══════════╪══════════╪═════════╪══════════╪═══╪══════════╪══════════╪══════════════╪══════════════╡
│ false    ┆ Base     ┆ 52939.0 ┆ 24703    ┆ … ┆ 2.143019 ┆ 0.504782 ┆ 0.012757     ┆ 0.02511      │
│ false    ┆ Rider    ┆ 0.0     ┆ 0        ┆ … ┆ NaN      ┆ 0.0      ┆ 0.0          ┆ NaN          │
│ true     ┆ Base     ┆ 7561.0  ┆ 3521     ┆ … ┆ 2.147401 ┆ 0.0468   ┆ 0.001291     ┆ 0.025336     │
│ true     ┆ Rider    ┆ 77321.0 ┆ 35941    ┆ … ┆ 2.151331 ┆ 0.477716 ┆ 0.025987     ┆ 0.059616     │
└──────────┴──────────┴─────────┴──────────┴───┴──────────┴──────────┴──────────────┴──────────────┘</code></pre>
</div>
</div>
</section>
<section id="column-names" class="level3">
<h3 class="anchored" data-anchor-id="column-names">Column names</h3>
<p>As a default, <code>add_transactions()</code> assumes the transaction data frame (<code>trx_data</code>) uses the following naming conventions:</p>
<ul>
<li>The policy number column is called <code>pol_num</code></li>
<li>The transaction date column is called <code>trx_date</code></li>
<li>The transaction type column is called <code>trx_type</code></li>
<li>The transaction amount column is called <code>trx_amt</code></li>
</ul>
<p>These default names can be overridden using the <code>col_pol_num</code>, <code>col_trx_date</code>, <code>col_trx_type</code>, and <code>col_trx_amt</code> arguments.</p>
<p>For example, if the transaction type column was called <code>transaction_code</code> in our data, we could write:</p>
<div id="col-names-1" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>exposed_data.add_transactions(withdrawals, col_trx_type<span class="op">=</span><span class="st">"transaction_code"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, <code>trx_stats()</code> assumes the input data uses the name <code>exposure</code> for exposures. This default can be overridden using the argument <code>col_exposure</code>.</p>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<p>The <code>trx_stats()</code> function does not produce any calculations related to the persistence of transactions from exposure period to exposure period.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See <a href="../articles/exposures.html">Exposures</a> for more information on creating <code>ExposedDF</code> objects.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>