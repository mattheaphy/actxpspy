[
  {
    "objectID": "reference/TrxStats.html",
    "href": "reference/TrxStats.html",
    "title": "TrxStats",
    "section": "",
    "text": "trx_stats.TrxStats(self, expo, trx_types=None, percent_of=None, combine_trx=False, full_exposures_only=True, conf_int=False, conf_level=0.95, col_exposure='exposure')\nTransactions study summary class\nCreate a summary of transaction counts, amounts, and utilization rates (a TrxStats object).\nTypically, the TrxStats class constructor should not be called directly. The preferred method for creating a TrxStats object is to call the trx_stats() method on an ExposedDF object."
  },
  {
    "objectID": "reference/TrxStats.html#parameters",
    "href": "reference/TrxStats.html#parameters",
    "title": "TrxStats",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nexpo\nactxps.expose.ExposedDF\nAn exposed data frame class\nrequired\n\n\ntrx_types\nlist or str\nA list of transaction types to include in the output. If None is provided, all available transaction types in the trx_types property of expo will be used.\nNone\n\n\npercent_of\nlist | str\nA optional list containing column names in the data property of expo to use as denominators in the calculation of utilization rates or actual-to-expected ratios.\nNone\n\n\ncombine_trx\nbool\nIf False, the results will contain output rows for each transaction type. If True, the results will contain aggregated experience across all transaction types.\nFalse\n\n\nfull_exposures_only\nbool\nIf True, partially exposed records will be ignored in the results.\nTrue\n\n\nconf_int\nbool\nIf True, the output will include confidence intervals around the observed utilization rate and any percent_of output columns.\nFalse\n\n\nconf_level\nfloat\nConfidence level for confidence intervals\n0.95\n\n\ncol_exposure\nstr\nName of the column in the data property of expo containing exposures\n'exposure'"
  },
  {
    "objectID": "reference/TrxStats.html#attributes",
    "href": "reference/TrxStats.html#attributes",
    "title": "TrxStats",
    "section": "Attributes",
    "text": "Attributes\n\n\n\n\n\n\n\n\nName\nType\nDescription\n\n\n\n\ndata\npolars.polars.DataFrame\nA data framethat includes columns for any grouping variables and transaction types, plus the following: trx_n (the number of unique transactions), trx_amt (total transaction amount), trx_flag (the number of observation periods with non-zero transaction amounts), exposure (total exposures), avg_trx (mean transaction amount {trx_amt / trx_flag}), avg_all (mean transaction amount over all records {trx_amt / exposure}), trx_freq (transaction frequency when a transaction occurs {trx_n / trx_flag}), trx_utilization (transaction utilization per observation period {trx_flag / exposure}). If percent_of is provided, the results will also include the sum of any columns passed to percent_of with non-zero transactions (these columns include the suffix _w_trx. - The sum of any columns passed to percent_of), pct_of_{*}_w_trx (total transactions as a percentage of column {*}_w_trx), pct_of_{*}_all (total transactions as a percentage of column {*})."
  },
  {
    "objectID": "reference/TrxStats.html#notes",
    "href": "reference/TrxStats.html#notes",
    "title": "TrxStats",
    "section": "Notes",
    "text": "Notes\nIf the ExposedDF object is grouped (see the group_by() method), the returned TrxStats object’s data will contain one row per group.\nAny number of transaction types can be passed to the trx_types argument, however each transaction type must appear in the trx_types property of the ExposedDF object. In addition, trx_stats() expects to see columns named trx_n_{*} (for transaction counts) and trx_amt_{*} for (transaction amounts) for each transaction type. To ensure .data is in the appropriate format, use the class method ExposedDF.from_DataFrame() to convert an existing data frame with transactions or use add_transactions() to attach transactions to an existing ExposedDF object.\n“Percentage of” calculations\nThe percent_of argument is optional. If provided, this argument must be list with values corresponding to columns in the data property of expo containing values to use as denominators in the calculation of utilization rates or actual-to-expected ratios. Example usage:\n\nIn a study of partial withdrawal transactions, if percent_of refers to account values, observed withdrawal rates can be determined.\nIn a study of recurring claims, if percent_of refers to a column containing a maximum benefit amount, utilization rates can be determined.\n\nConfidence intervals\nIf conf_int is set to True, the output will contain lower and upper confidence interval limits for the observed utilization rate and any percent_of output columns. The confidence level is dictated by conf_level.\n\nIntervals for the utilization rate (trx_util) assume a binomial distribution.\nIntervals for transactions as a percentage of another column with non-zero transactions (pct_of_{*}_w_trx) are constructed using a normal distribution\nIntervals for transactions as a percentage of another column regardless of transaction utilization (pct_of_{*}_all) are calculated assuming that the aggregate distribution is normal with a mean equal to observed transactions and a variance equal to:\nVar(S) = E(N) * Var(X) + E(X)**2 * Var(N),\n\nWhere S is the aggregate transactions random variable, X is an individual transaction amount assumed to follow a normal distribution, and N is a binomial random variable for transaction utilization.\nDefault removal of partial exposures\nAs a default, partial exposures are removed from data before summarizing results. This is done to avoid complexity associated with a lopsided skew in the timing of transactions. For example, if transactions can occur on a monthly basis or annually at the beginning of each policy year, partial exposures may not be appropriate. If a policy had an exposure of 0.5 years and was taking withdrawals annually at the beginning of the year, an argument could be made that the exposure should instead be 1 complete year. If the same policy was expected to take withdrawals 9 months into the year, it’s not clear if the exposure should be 0.5 years or 0.5 / 0.75 years. To override this treatment, set full_exposures_only to False.\nAlternative class constructor\nTrxStats.from_DataFrame() can be used to coerce a data frame containing pre-aggregated experience into a TrxStats object. This is most useful for working with industry study data where individual exposure records are not available."
  },
  {
    "objectID": "reference/TrxStats.html#methods",
    "href": "reference/TrxStats.html#methods",
    "title": "TrxStats",
    "section": "Methods",
    "text": "Methods\n\n\n\nName\nDescription\n\n\n\n\nfrom_DataFrame\nConvert a data frame containing aggregate transaction experience study\n\n\nplot\nPlot transaction study results\n\n\nplot_utilization_rates\nPlot transaction frequency and severity.\n\n\nsummary\nRe-summarize transaction experience data\n\n\ntable\nTabular transaction study summary\n\n\n\n\nfrom_DataFrame\ntrx_stats.TrxStats.from_DataFrame(data, conf_int=False, conf_level=0.95, col_trx_amt='trx_amt', col_trx_n='trx_n', col_trx_flag='trx_flag', col_exposure='exposure', col_percent_of=None, col_percent_of_w_trx=None, col_trx_amt_sq='trx_amt_sq', start_date=date(1900, 1, 1), end_date=None)\nConvert a data frame containing aggregate transaction experience study results to the TrxStats class.\nfrom_DataFrame() is most useful for working with aggregate summaries of experience that were not created by actxps where individual policy information is not available. After converting the data to the TrxStats class, summary() can be used to summarize data by any grouping variables, and plot() and table() are available for reporting.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndata\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA DataFrame containing aggregate transaction study results. See the Notes section for required columns that must be present.\nrequired\n\n\nconf_int\nbool\nIf True, future calls to summary() will include confidence intervals around the observed utilization rates and any percent_of output columns.\nFalse\n\n\nconf_level\nfloat\nConfidence level used for the Limited Fluctuation credibility method and confidence intervals.\n0.95\n\n\ncol_trx_amt\nstr\nName of the column in data containing transaction amounts.\n'trx_amt'\n\n\ncol_trx_n\nstr\nName of the column in data containing transaction counts.\n'trx_n'\n\n\ncol_trx_flag\nstr\nName of the column in data containing the number of exposure records with transactions.\n'trx_flag'\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'\n\n\ncol_percent_of\nstr\nName of the column in data containing a numeric variable to use in “percent of” calculations.\nNone\n\n\ncol_percent_of_w_trx\nstr\nName of the column in data containing a numeric variable to use in “percent of” calculations with transactions.\nNone\n\n\ncol_trx_amt_sq\nstr\nOnly required when col_percent_of is passed and conf_int is True. Name of the column in data containing squared transaction amounts.\n'trx_amt_sq'\n\n\nstart_date\ndatetime.date | str\nTransaction study start date\ndate(1900, 1, 1)\n\n\nend_date\ndatetime.date | str\nTransaction study end date\nNone\n\n\n\n\n\nReturns\n\n\n\nType\nDescription\n\n\n\n\nactxps.trx_stats.TrxStats\nA TrxStats object\n\n\n\n\n\nNotes\nAt a minimum, the following columns are required:\n\nTransaction amounts (trx_amt)\nTransaction counts (trx_n)\nThe number of exposure records with transactions (trx_flag). This number is not necessarily equal to transaction counts. If multiple transactions are allowed per exposure period, trx_flag will be less than trx_n.\nExposures (exposure)\n\nIf transaction amounts should be expressed as a percentage of another variable (i.e. to calculate utilization rates or actual-to-expected ratios), additional columns are required:\n\nA denominator “percent of” column. For example, the sum of account values.\nA denominator “percent of” column for exposure records with transactions. For example, the sum of account values across all records with non-zero transaction amounts.\n\nIf confidence intervals are desired and “percent of” columns are passed, an additional column for the sum of squared transaction amounts (trx_amt_sq) is also required.\nThe names in parentheses above are expected column names. If the data frame passed to from_DataFrame() uses different column names, these can be specified using the col_* arguments.\nstart_date, and end_date are optional arguments that are only used for printing the resulting TrxStats object.\nUnlike ExposedDF.trx_stats(), from_DataFrame() only permits a single transaction type and a single percent_of column.\n\n\nExamples\n\n# convert pre-aggregated experience into a TrxStats object\nimport actxps as xp\nimport polars as pl\n\nagg_sim_dat = xp.load_agg_sim_dat()\ndat = xp.TrxStats.from_DataFrame(\n    agg_sim_dat.with_columns(pl.col('n').cast(float)),\n    col_exposure=\"n\",\n    col_trx_amt=\"wd\",\n    col_trx_n=\"wd_n\",\n    col_trx_flag=\"wd_flag\",\n    col_percent_of=\"av\",\n    col_percent_of_w_trx=\"av_w_wd\",\n    col_trx_amt_sq=\"wd_sq\",\n    start_date=2005, end_date=2019,\n    conf_int=True)\ndat\n\n# summary by policy year\ndat.summary('pol_yr')\n\nTransaction study results\n\nGroups: pol_yr\nStudy range: 2005 to 2019\nTransaction types: wd\nTransactions as % of: av\n\nshape: (15, 21)\n┌────────┬──────────┬───────┬──────────┬───┬─────────────┬─────────────┬─────────────┬─────────────┐\n│ pol_yr ┆ trx_type ┆ trx_n ┆ trx_flag ┆ … ┆ pct_of_av_w ┆ pct_of_av_w ┆ pct_of_av_a ┆ pct_of_av_a │\n│ ---    ┆ ---      ┆ ---   ┆ ---      ┆   ┆ _trx_lower  ┆ _trx_upper  ┆ ll_lower    ┆ ll_upper    │\n│ i64    ┆ str      ┆ i64   ┆ i64      ┆   ┆ ---         ┆ ---         ┆ ---         ┆ ---         │\n│        ┆          ┆       ┆          ┆   ┆ f64         ┆ f64         ┆ f64         ┆ f64         │\n╞════════╪══════════╪═══════╪══════════╪═══╪═════════════╪═════════════╪═════════════╪═════════════╡\n│ 1      ┆ wd       ┆ 16942 ┆ 7921     ┆ … ┆ 0.038276    ┆ 0.041085    ┆ 0.015332    ┆ 0.016587    │\n│ 2      ┆ wd       ┆ 16900 ┆ 7923     ┆ … ┆ 0.039902    ┆ 0.043038    ┆ 0.016931    ┆ 0.01839     │\n│ 3      ┆ wd       ┆ 16679 ┆ 7796     ┆ … ┆ 0.04103     ┆ 0.044065    ┆ 0.018417    ┆ 0.019919    │\n│ 4      ┆ wd       ┆ 16193 ┆ 7575     ┆ … ┆ 0.040991    ┆ 0.044182    ┆ 0.019329    ┆ 0.020971    │\n│ 5      ┆ wd       ┆ 15353 ┆ 7153     ┆ … ┆ 0.040572    ┆ 0.043915    ┆ 0.020021    ┆ 0.021806    │\n│ …      ┆ …        ┆ …     ┆ …        ┆ … ┆ …           ┆ …           ┆ …           ┆ …           │\n│ 11     ┆ wd       ┆ 7470  ┆ 3448     ┆ … ┆ 0.043407    ┆ 0.048177    ┆ 0.027074    ┆ 0.030235    │\n│ 12     ┆ wd       ┆ 5079  ┆ 2314     ┆ … ┆ 0.043491    ┆ 0.049206    ┆ 0.028866    ┆ 0.032877    │\n│ 13     ┆ wd       ┆ 3310  ┆ 1495     ┆ … ┆ 0.043142    ┆ 0.051286    ┆ 0.029488    ┆ 0.035291    │\n│ 14     ┆ wd       ┆ 2119  ┆ 946      ┆ … ┆ 0.044544    ┆ 0.056832    ┆ 0.031782    ┆ 0.040822    │\n│ 15     ┆ wd       ┆ 982   ┆ 430      ┆ … ┆ 0.043576    ┆ 0.059197    ┆ 0.033368    ┆ 0.045754    │\n└────────┴──────────┴───────┴──────────┴───┴─────────────┴─────────────┴─────────────┴─────────────┘\n\n\n\n\nSee Also\nExposedDF.trx_stats() for information on how TrxStats objects are typically created from individual exposure records.\n\n\n\nplot\ntrx_stats.TrxStats.plot(x=None, y='trx_util', color=None, facets=None, mapping=None, scales='fixed', geoms='lines', y_labels=lambda : [f'{v * 100}%' for v in l], y_log10=False, conf_int_bars=False)\nPlot transaction study results\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nx\nstr\nA column name in data to use as the x variable. If None, x will default to the first grouping variable. If there are no grouping variables, x will be set to “All”.\nNone\n\n\ny\nstr\nA column name in data to use as the y variable.\n'trx_util'\n\n\ncolor\nstr\nA column name in data to use as the color and fill variables. If None, y will default to the second grouping variable. If there are less than two grouping variables, the plot will not use a color aesthetic.\nNone\n\n\nfacets\nlist | str\nFaceting variables in data passed to plotnine.facet_wrap(). If None, grouping variables 3+ will be used (assuming there are more than two grouping variables).\nNone\n\n\nmapping\nplotnine.aes\nAesthetic mapping added to plotnine.ggplot(). NOTE: If mapping is supplied, the x, y, and color arguments will be ignored.\nNone\n\n\nscales\nstr\nThe scales argument passed to plotnine.facet_wrap().\n'fixed'\n\n\ngeoms\n‘lines’, ‘bars’, ’points\nType of geometry. If “lines” is passed, the plot will display lines and points. If “bars”, the plot will display bars. If “points”, the plot will display points only.\n'lines'\n\n\ny_labels\ncallable\nLabel function passed to plotnine.scale_y_continuous().\nlambda l: [f\"{v * 100:.1f}%\" for v in l]\n\n\ny_log10\nbool\nIf True, the y-axes are plotted on a log-10 scale.\nFalse\n\n\nconf_int_bars\nbool\nIf True, confidence interval error bars are included in the plot. This option is only available for utilization rates and any pct_of columns.\nFalse\n\n\n\n\n\nNotes\nIf no aesthetic map is supplied, the plot will use the first grouping variable in the groups property on the x axis and trx_util on the y axis. In addition, the second grouping variable in groups will be used for color and fill.\nIf no faceting variables are supplied, the plot will use grouping variables 3 and up as facets. These variables are passed into plotnine.facet_wrap().\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\ntrx_res = (expo.group_by('pol_yr').\n           trx_stats(percent_of='premium'))\n\ntrx_res.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\n\nplot_utilization_rates\ntrx_stats.TrxStats.plot_utilization_rates(**kwargs)\nPlot transaction frequency and severity.\nFrequency is represented by utilization rates (trx_util). Severity is represented by transaction amounts as a percentage of one or more other columns in the data ({*}_w_trx). All severity series begin with the prefix “pct_of_” and end with the suffix “_w_trx”. The suffix refers to the fact that the denominator only includes records with non-zero transactions. Severity series are based on column names passed to the percent_of argument in trx_stats(). If no “percentage of” columns exist, this function will only plot utilization rates.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\n**kwargs\n\nAdditional arguments passed to plot()\n{}\n\n\n\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\naccount_vals = xp.load_account_vals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\nexpo.data = expo.data.join(account_vals, how='left',\n                           on=[\"pol_num\", \"pol_date_yr\"])        \n\ntrx_res = (expo.group_by('pol_yr').\n           trx_stats(percent_of='av_anniv', combine_trx=True))\n\ntrx_res.plot_utilization_rates()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\n\nsummary\ntrx_stats.TrxStats.summary(*by)\nRe-summarize transaction experience data\nRe-summarize the data while retaining any grouping variables passed to the *by argument.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\n*by\n\nColumn names in data that will be used as grouping variables in the re-summarized object. Passing nothing is acceptable and will produce a 1-row experience summary.\n()\n\n\n\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nactxps.trx_stats.TrxStats\nA new TrxStats object with rows for all the unique groups in *by\n\n\n\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\ntrx_res = (expo.group_by('inc_guar', 'pol_yr').\n           trx_stats(percent_of='premium'))\ntrx_res.summary('inc_guar')\n\nTransaction study results\n\nGroups: inc_guar\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\nTransactions as % of: premium\n\nshape: (4, 14)\n┌──────────┬──────────┬─────────┬──────────┬───┬──────────┬──────────┬──────────────┬──────────────┐\n│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_premi ┆ pct_of_premi │\n│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---      ┆ ---      ┆ um_all       ┆ um_w_trx     │\n│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64      ┆ f64      ┆ ---          ┆ ---          │\n│          ┆          ┆         ┆          ┆   ┆          ┆          ┆ f64          ┆ f64          │\n╞══════════╪══════════╪═════════╪══════════╪═══╪══════════╪══════════╪══════════════╪══════════════╡\n│ false    ┆ Base     ┆ 52939.0 ┆ 24703    ┆ … ┆ 2.143019 ┆ 0.504782 ┆ 0.014557     ┆ 0.028089     │\n│ false    ┆ Rider    ┆ 0.0     ┆ 0        ┆ … ┆ NaN      ┆ 0.0      ┆ 0.0          ┆ NaN          │\n│ true     ┆ Base     ┆ 7561.0  ┆ 3521     ┆ … ┆ 2.147401 ┆ 0.0468   ┆ 0.0014       ┆ 0.028594     │\n│ true     ┆ Rider    ┆ 77321.0 ┆ 35941    ┆ … ┆ 2.151331 ┆ 0.477716 ┆ 0.028166     ┆ 0.059362     │\n└──────────┴──────────┴─────────┴──────────┴───┴──────────┴──────────┴──────────────┴──────────────┘\n\n\n\n\n\ntable\ntrx_stats.TrxStats.table(fontsize=100, decimals=1, colorful=True, color_util='GnBu', color_pct_of='RdBu', show_conf_int=False, decimals_amt=0, suffix_amt=False, **rename_cols)\nTabular transaction study summary\nConvert transaction study results to a presentation-friendly format.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nfontsize\nint\nFont size percentage multiplier\n100\n\n\ndecimals\nint\nNumber of decimals to display for percentages\n1\n\n\ncolorful\nbool\nIf True, color will be added to the the observed utilization rate and “percentage of” columns.\nTrue\n\n\ncolor_util\nstr\nColorBrewer palette used for the observed utilization rate.\n'GnBu'\n\n\ncolor_pct_of\nstr\nColorBrewer palette used for “percentage of” columns.\n'RdBu'\n\n\nshow_conf_int\nbool\nIf True any confidence intervals will be displayed.\nFalse\n\n\ndecimals_amt\nint\nNumber of decimals to display for amount columns (transaction counts, total transactions, and average transactions)\n0\n\n\nsuffix_amt\nbool\nThis argument has the same meaning as the compact argument in great_tables.gt.GT.fmt_number() for amount columns. If False, no scaling or suffixing are applied to amount columns. If True, all amount columns are automatically scaled and suffixed by “K” (thousands), “M” (millions), “B” (billions), or “T” (trillions).\nFalse\n\n\nrename_cols\nstr\nKey-value pairs where keys are column names and values are labels that will appear on the output table. This parameter is useful for renaming grouping variables that will appear under their original variable names if left unchanged.\nNone\n\n\n\n\n\nNotes\nFurther customizations can be added using great_tables.gt.GT methods. See the great_tables package documentation for more information.\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\ngreat_tables.great_tables.gt.great_tables.gt.GT\nA formatted HTML table\n\n\n\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\ntrx_res = (expo.group_by('pol_yr').\n           trx_stats(percent_of='premium'))\n\ntrx_res.table()\n\n\n\n\n\n  \n    Transaction Study Results\n  \n  \n    Transaction types: Base, Rider\n  \n\n  \n  \n    Counts\n  \n  Amount\n  \n    Averages\n  \n  Frequency\n  Utilization\n  \n    % of premium\n  \n\n\n  Total\n  Periods\n  w/ trx\n  all\n  w/ trx\n  all\n\n\n\n  Base\n  1\n  7,447\n  3,514\n  119,877\n  34\n  6\n  2.1\n  19.0%\n  2.5%\n  0.5%\n\n\n  2\n  7,274\n  3,422\n  116,967\n  34\n  7\n  2.1\n  20.2%\n  2.5%\n  0.5%\n\n\n  3\n  7,061\n  3,309\n  116,357\n  35\n  8\n  2.1\n  21.5%\n  2.6%\n  0.6%\n\n\n  4\n  6,596\n  3,080\n  114,987\n  37\n  8\n  2.1\n  22.3%\n  2.8%\n  0.6%\n\n\n  5\n  6,093\n  2,847\n  109,918\n  39\n  9\n  2.1\n  23.3%\n  2.8%\n  0.7%\n\n\n  6\n  5,543\n  2,572\n  97,455\n  38\n  9\n  2.2\n  24.0%\n  2.8%\n  0.7%\n\n\n  7\n  4,921\n  2,297\n  92,797\n  40\n  10\n  2.1\n  24.7%\n  2.9%\n  0.7%\n\n\n  8\n  4,200\n  1,964\n  85,740\n  44\n  11\n  2.1\n  25.2%\n  3.1%\n  0.8%\n\n\n  9\n  3,579\n  1,655\n  70,715\n  43\n  11\n  2.2\n  26.0%\n  3.0%\n  0.8%\n\n\n  10\n  3,004\n  1,376\n  57,935\n  42\n  11\n  2.2\n  27.2%\n  3.0%\n  0.8%\n\n\n  11\n  2,428\n  1,115\n  53,809\n  48\n  14\n  2.2\n  28.6%\n  3.4%\n  1.0%\n\n\n  12\n  1,320\n  605\n  30,425\n  50\n  13\n  2.2\n  26.7%\n  3.2%\n  0.9%\n\n\n  13\n  700\n  319\n  17,809\n  56\n  14\n  2.2\n  24.9%\n  3.3%\n  0.9%\n\n\n  14\n  315\n  141\n  8,883\n  63\n  15\n  2.2\n  24.6%\n  3.6%\n  1.0%\n\n\n  15\n  19\n  8\n  225\n  28\n  11\n  2.4\n  38.1%\n  3.0%\n  1.0%\n\n\n  Rider\n  1\n  8,077\n  3,778\n  265,312\n  70\n  14\n  2.1\n  20.4%\n  5.3%\n  1.1%\n\n\n  2\n  8,232\n  3,834\n  288,114\n  75\n  17\n  2.1\n  22.6%\n  5.7%\n  1.3%\n\n\n  3\n  8,204\n  3,817\n  294,795\n  77\n  19\n  2.1\n  24.8%\n  5.8%\n  1.4%\n\n\n  4\n  7,960\n  3,715\n  283,763\n  76\n  21\n  2.1\n  26.9%\n  5.8%\n  1.5%\n\n\n  5\n  7,536\n  3,521\n  264,939\n  75\n  22\n  2.1\n  28.8%\n  5.7%\n  1.6%\n\n\n  6\n  7,118\n  3,342\n  264,516\n  79\n  25\n  2.1\n  31.2%\n  5.9%\n  1.8%\n\n\n  7\n  6,631\n  3,097\n  251,502\n  81\n  27\n  2.1\n  33.3%\n  6.1%\n  2.0%\n\n\n  8\n  5,952\n  2,773\n  226,770\n  82\n  29\n  2.1\n  35.6%\n  6.1%\n  2.1%\n\n\n  9\n  5,173\n  2,406\n  204,000\n  85\n  32\n  2.2\n  37.8%\n  6.3%\n  2.3%\n\n\n  10\n  4,331\n  1,998\n  174,457\n  87\n  35\n  2.2\n  39.5%\n  6.5%\n  2.5%\n\n\n  11\n  3,468\n  1,597\n  139,620\n  87\n  36\n  2.2\n  41.0%\n  6.5%\n  2.6%\n\n\n  12\n  2,398\n  1,076\n  90,469\n  84\n  40\n  2.2\n  47.4%\n  6.2%\n  2.8%\n\n\n  13\n  1,486\n  662\n  62,880\n  95\n  49\n  2.2\n  51.7%\n  6.7%\n  3.2%\n\n\n  14\n  736\n  316\n  30,648\n  97\n  53\n  2.3\n  55.1%\n  7.1%\n  3.6%\n\n\n  15\n  19\n  9\n  944\n  105\n  45\n  2.1\n  42.9%\n  9.0%\n  4.2%\n\n\n  \n  \n  \n    Study range: 1900-01-01 to 2019-12-31"
  },
  {
    "objectID": "reference/sim_data.html",
    "href": "reference/sim_data.html",
    "title": "load_census_dat",
    "section": "",
    "text": "datasets.load_census_dat()\nSimulated annuity census data\nSimulated data for a theoretical deferred annuity product with an optional guaranteed income rider. This data is theoretical only and does not represent the experience on any specific product.\nA data frame with 20,000 rows and 11 columns:\n\npol_num = policy number\nstatus - policy status: Active, Surrender, or Death\nissue_date - issue date\ninc_guar - indicates whether the policy was issued with an income guarantee\nqual - indicates whether the policy was purchased with tax-qualified funds\nage - issue age\nproduct - product: a, b, or c\ngender - M (Male) or F (Female)\nwd_age - Age that withdrawals commence\npremium - Single premium deposit\nterm_date - termination date upon death or surrender\n\n\n\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/sim_data.html#returns",
    "href": "reference/sim_data.html#returns",
    "title": "load_census_dat",
    "section": "",
    "text": "Type\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/sim_data.html#returns-1",
    "href": "reference/sim_data.html#returns-1",
    "title": "load_census_dat",
    "section": "Returns",
    "text": "Returns\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/sim_data.html#returns-2",
    "href": "reference/sim_data.html#returns-2",
    "title": "load_census_dat",
    "section": "Returns",
    "text": "Returns\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/pol_durations.html",
    "href": "reference/pol_durations.html",
    "title": "pol_interval",
    "section": "",
    "text": "dates.pol_interval(dates, issue_date, dur_length)\nCalculate policy durations in years, quarters, months, or weeks\nThis function assumes the first day of each policy year is the anniversary date (or issue date in the first year). The last day of each policy year is the day before the next anniversary date. Analogous rules are used for policy quarters, policy months, and policy weeks."
  },
  {
    "objectID": "reference/pol_durations.html#parameters",
    "href": "reference/pol_durations.html#parameters",
    "title": "pol_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndates\nstr | datetime.date | list | polars.polars.Series\nDate(s)\nrequired\n\n\nissue_date\nstr | datetime.date | list | polars.polars.Series\nIssue date(s)\nrequired\n\n\ndur_length\n(year, quarter, month, week)\nPolicy duration length\n'year'"
  },
  {
    "objectID": "reference/pol_durations.html#returns",
    "href": "reference/pol_durations.html#returns",
    "title": "pol_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/pol_durations.html#see-also",
    "href": "reference/pol_durations.html#see-also",
    "title": "pol_interval",
    "section": "See Also",
    "text": "See Also\npol_yr, pol_qtr, pol_mth, pol_wk"
  },
  {
    "objectID": "reference/pol_durations.html#examples",
    "href": "reference/pol_durations.html#examples",
    "title": "pol_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.pol_interval(['2024-05-01', '2024-02-01'], \n                ['2008-03-14', '2008-03-14'], \n                'year')\n\n\nshape: (2,)\n\n\n\n\n\n\nu32\n\n\n\n\n17\n\n\n16"
  },
  {
    "objectID": "reference/pol_durations.html#parameters-1",
    "href": "reference/pol_durations.html#parameters-1",
    "title": "pol_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndates\nstr | datetime.date | list | polars.polars.Series\nDate(s)\nrequired\n\n\nissue_date\nstr | datetime.date | list | polars.polars.Series\nIssue date(s)\nrequired"
  },
  {
    "objectID": "reference/pol_durations.html#returns-1",
    "href": "reference/pol_durations.html#returns-1",
    "title": "pol_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/pol_durations.html#see-also-1",
    "href": "reference/pol_durations.html#see-also-1",
    "title": "pol_interval",
    "section": "See Also",
    "text": "See Also\npol_interval"
  },
  {
    "objectID": "reference/pol_durations.html#examples-1",
    "href": "reference/pol_durations.html#examples-1",
    "title": "pol_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.pol_yr(['2024-05-01', '2024-02-01'], \n          ['2008-03-14', '2008-03-14'])\n\n\nshape: (2,)\n\n\n\n\n\n\nu32\n\n\n\n\n17\n\n\n16"
  },
  {
    "objectID": "reference/pol_durations.html#parameters-2",
    "href": "reference/pol_durations.html#parameters-2",
    "title": "pol_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndates\nstr | datetime.date | list | polars.polars.Series\nDate(s)\nrequired\n\n\nissue_date\nstr | datetime.date | list | polars.polars.Series\nIssue date(s)\nrequired"
  },
  {
    "objectID": "reference/pol_durations.html#returns-2",
    "href": "reference/pol_durations.html#returns-2",
    "title": "pol_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/pol_durations.html#see-also-2",
    "href": "reference/pol_durations.html#see-also-2",
    "title": "pol_interval",
    "section": "See Also",
    "text": "See Also\npol_interval"
  },
  {
    "objectID": "reference/pol_durations.html#examples-2",
    "href": "reference/pol_durations.html#examples-2",
    "title": "pol_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.pol_qtr(['2024-05-01', '2024-02-01'], \n           ['2008-03-14', '2008-03-14'])\n\n\nshape: (2,)\n\n\n\n\n\n\nu32\n\n\n\n\n65\n\n\n64"
  },
  {
    "objectID": "reference/pol_durations.html#parameters-3",
    "href": "reference/pol_durations.html#parameters-3",
    "title": "pol_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndates\nstr | datetime.date | list | polars.polars.Series\nDate(s)\nrequired\n\n\nissue_date\nstr | datetime.date | list | polars.polars.Series\nIssue date(s)\nrequired"
  },
  {
    "objectID": "reference/pol_durations.html#returns-3",
    "href": "reference/pol_durations.html#returns-3",
    "title": "pol_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/pol_durations.html#see-also-3",
    "href": "reference/pol_durations.html#see-also-3",
    "title": "pol_interval",
    "section": "See Also",
    "text": "See Also\npol_interval"
  },
  {
    "objectID": "reference/pol_durations.html#examples-3",
    "href": "reference/pol_durations.html#examples-3",
    "title": "pol_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.pol_mth(['2024-05-01', '2024-02-01'], \n           ['2008-03-14', '2008-03-14'])\n\n\nshape: (2,)\n\n\n\n\n\n\nu32\n\n\n\n\n194\n\n\n191"
  },
  {
    "objectID": "reference/pol_durations.html#parameters-4",
    "href": "reference/pol_durations.html#parameters-4",
    "title": "pol_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndates\nstr | datetime.date | list | polars.polars.Series\nDate(s)\nrequired\n\n\nissue_date\nstr | datetime.date | list | polars.polars.Series\nIssue date(s)\nrequired"
  },
  {
    "objectID": "reference/pol_durations.html#returns-4",
    "href": "reference/pol_durations.html#returns-4",
    "title": "pol_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/pol_durations.html#see-also-4",
    "href": "reference/pol_durations.html#see-also-4",
    "title": "pol_interval",
    "section": "See Also",
    "text": "See Also\npol_interval"
  },
  {
    "objectID": "reference/pol_durations.html#examples-4",
    "href": "reference/pol_durations.html#examples-4",
    "title": "pol_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.pol_wk(['2024-05-01', '2024-02-01'], \n          ['2008-03-14', '2008-03-14'])\n\n\nshape: (2,)\n\n\n\n\n\n\nu32\n\n\n\n\n842\n\n\n829"
  },
  {
    "objectID": "reference/index.html",
    "href": "reference/index.html",
    "title": "Function reference",
    "section": "",
    "text": "Create exposure records from census records\n\n\n\nExposedDF\nExposed data frame class\n\n\nExposedDF.from_DataFrame\nCoerce a data frame to an ExposedDF object\n\n\nSplitExposedDF\nSplit calendar exposures by policy year\n\n\n\n\n\n\nCreate termination study summaries and reports\n\n\n\nExposedDF.exp_stats\nSummarize experience study records\n\n\nExpStats\nExperience study summary class\n\n\n\n\n\n\nAdd transactions to exposure records, create summaries and reports\n\n\n\nExposedDF.add_transactions\nAdd transactions to an experience study\n\n\nTrxStats\nTransactions study summary class\n\n\n\n\n\n\nLaunch a Shiny application to interactively explore drivers of experience.\n\n\n\nexp_shiny\nInteractively explore experience data\n\n\n\n\n\n\nData sets for testing the functionality of actxps\n\n\n\n\n\nload_toy_census\nToy policy census data\n\n\n\n\n\n\n\n\n\nload_census_dat\nSimulated annuity census data\n\n\nload_withdrawals\nSimulated annuity withdrawal data\n\n\nload_account_vals\nSimulated annuity account value data\n\n\n\n\n\n\n\n\n\nload_qx_iamb\n2012 Individual Annuity Mortality Table\n\n\nload_scale_g2\nProjection Scale G2\n\n\n\n\n\n\n\nSupport functions used for various date calculations\n\n\n\n\n\npol_interval\nCalculate policy durations in years, quarters, months, or weeks\n\n\npol_yr\nCalculate policy years\n\n\npol_qtr\nCalculate policy quarters\n\n\npol_mth\nCalculate policy months\n\n\npol_wk\nCalculate policy weeks\n\n\n\n\n\n\n\n\n\nfrac_interval\nCalculate fractional years, quarters, months, or weeks between two dates\n\n\nfrac_yr\nCalculate fractional years between two dates\n\n\nfrac_qtr\nCalculate fractional quarters between two dates\n\n\nfrac_mth\nCalculate fractional months between two dates\n\n\nfrac_wk\nCalculate fractional weeks between two dates"
  },
  {
    "objectID": "reference/index.html#exposure-calculations",
    "href": "reference/index.html#exposure-calculations",
    "title": "Function reference",
    "section": "",
    "text": "Create exposure records from census records\n\n\n\nExposedDF\nExposed data frame class\n\n\nExposedDF.from_DataFrame\nCoerce a data frame to an ExposedDF object\n\n\nSplitExposedDF\nSplit calendar exposures by policy year"
  },
  {
    "objectID": "reference/index.html#termination-studies",
    "href": "reference/index.html#termination-studies",
    "title": "Function reference",
    "section": "",
    "text": "Create termination study summaries and reports\n\n\n\nExposedDF.exp_stats\nSummarize experience study records\n\n\nExpStats\nExperience study summary class"
  },
  {
    "objectID": "reference/index.html#transaction-studies",
    "href": "reference/index.html#transaction-studies",
    "title": "Function reference",
    "section": "",
    "text": "Add transactions to exposure records, create summaries and reports\n\n\n\nExposedDF.add_transactions\nAdd transactions to an experience study\n\n\nTrxStats\nTransactions study summary class"
  },
  {
    "objectID": "reference/index.html#shiny-app",
    "href": "reference/index.html#shiny-app",
    "title": "Function reference",
    "section": "",
    "text": "Launch a Shiny application to interactively explore drivers of experience.\n\n\n\nexp_shiny\nInteractively explore experience data"
  },
  {
    "objectID": "reference/index.html#sample-data-sets",
    "href": "reference/index.html#sample-data-sets",
    "title": "Function reference",
    "section": "",
    "text": "Data sets for testing the functionality of actxps\n\n\n\n\n\nload_toy_census\nToy policy census data\n\n\n\n\n\n\n\n\n\nload_census_dat\nSimulated annuity census data\n\n\nload_withdrawals\nSimulated annuity withdrawal data\n\n\nload_account_vals\nSimulated annuity account value data\n\n\n\n\n\n\n\n\n\nload_qx_iamb\n2012 Individual Annuity Mortality Table\n\n\nload_scale_g2\nProjection Scale G2"
  },
  {
    "objectID": "reference/index.html#date-functions",
    "href": "reference/index.html#date-functions",
    "title": "Function reference",
    "section": "",
    "text": "Support functions used for various date calculations\n\n\n\n\n\npol_interval\nCalculate policy durations in years, quarters, months, or weeks\n\n\npol_yr\nCalculate policy years\n\n\npol_qtr\nCalculate policy quarters\n\n\npol_mth\nCalculate policy months\n\n\npol_wk\nCalculate policy weeks\n\n\n\n\n\n\n\n\n\nfrac_interval\nCalculate fractional years, quarters, months, or weeks between two dates\n\n\nfrac_yr\nCalculate fractional years between two dates\n\n\nfrac_qtr\nCalculate fractional quarters between two dates\n\n\nfrac_mth\nCalculate fractional months between two dates\n\n\nfrac_wk\nCalculate fractional weeks between two dates"
  },
  {
    "objectID": "reference/exp_shiny.html",
    "href": "reference/exp_shiny.html",
    "title": "exp_shiny",
    "section": "",
    "text": "exp_shiny.exp_shiny(self, predictors=None, expected=None, distinct_max=25, title=None, credibility=True, conf_level=0.95, cred_r=0.05, bootswatch_theme=None, col_exposure='exposure')\nInteractively explore experience data\nLaunch a Shiny application to interactively explore drivers of experience."
  },
  {
    "objectID": "reference/exp_shiny.html#parameters",
    "href": "reference/exp_shiny.html#parameters",
    "title": "exp_shiny",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\npredictors\nstr | list | numpy.numpy.ndarray\nA character vector of independent variables in the data property to include in the shiny app.\nNone\n\n\nexpected\nstr | list | numpy.numpy.ndarray\nA character vector of expected values in the data property to include in the shiny app.\nNone\n\n\ndistinct_max\nint\nMaximum number of distinct values allowed for predictors to be included as “Color” and “Facets” grouping variables. This input prevents the drawing of overly complex plots. Default value = 25.\n25\n\n\ntitle\nstr\nTitle of the Shiny app. If no title is provided, a descriptive title will be generated based on attributes of the ExposedDF object.\nNone\n\n\ncredibility\nbool\nIf True, future calls to summary() will include partial credibility weights and credibility-weighted termination rates.\nFalse\n\n\nconf_level\nfloat\nConfidence level used for the Limited Fluctuation credibility method and confidence intervals.\n0.95\n\n\ncred_r\nfloat\nError tolerance under the Limited Fluctuation credibility method.\n0.05\n\n\nbootswatch_theme\nstr\nThe name of a preset bootswatch theme passed to shinyswatch.get_theme.\nNone\n\n\ncol_exposure\nstr\nName of the column in the data property containing exposures. This input is only used to clarify the exposure basis when the ExposedDF is also a SplitExposedDF object. For more information on split exposures, see ExposedDF.expose_split().\n'exposure'"
  },
  {
    "objectID": "reference/exp_shiny.html#notes",
    "href": "reference/exp_shiny.html#notes",
    "title": "exp_shiny",
    "section": "Notes",
    "text": "Notes\nIf transactions have been attached to the ExposedDF object, the app will contain features for both termination and transaction studies. Otherwise, the app will only support termination studies.\nIf nothing is passed to predictors, all columns names in dat will be used (excluding the policy number, status, termination date, exposure, transaction counts, and transaction amounts columns).\nThe expected argument is optional. As a default, any column names containing the word “expected” are used.\nLayout\nFilters\nThe sidebar contains filtering widgets organized by data type for all variables passed to the predictors argument.\nAt the top of the sidebar, information is shown on the percentage of records remaining after applying filters. A description of all active filters is also provided.\nThe top of the sidebar also includes a “play / pause” switch that can pause reactivity of the application. Pausing is a good option when multiple changes are made in quick succession, especially when the underlying data set is large.\nGrouping variables\nThis box includes widgets to select grouping variables for summarizing experience. The “x” widget is also used as the x variable in the plot output. Similarly, the “Color” and “Facets” widgets are used for color and facets. Multiple faceting variables are allowed. For the table output, “x”, “Color”, and “Facets” have no particular meaning beyond the order in which of grouping variables are displayed.\nStudy type\nThis box includes a toggle to switch between termination studies and transaction studies (if available). Different options are available for each study type.\nTermination studies\nThe expected values checkboxes are used to activate and deactivate expected values passed to the expected argument. This impacts the table output directly and the available “y” variables for the plot. If there are no expected values available, this widget will not appear. The “Weight by” widget is used to specify which column, if any, contains weights for summarizing experience.\nTransaction studies\nThe transaction types checkboxes are used to activate and deactivate transaction types that appear in the plot and table outputs. The available transaction types are taken from the trx_types property of the ExposedDF object. In the plot output, transaction type will always appear as a faceting variable. The “Transactions as % of” selector will expand the list of available “y” variables for the plot and impact the table output directly. Lastly, a checkbox exists that allows for all transaction types to be aggregated into a single group.\nOutput\nPlot\nThis tab includes a plot and various options for customization:\n\ny: y variable\nGeometry: plotting geometry\nAdd Smoothing: activate to plot loess curves\nConfidence intervals: If available, add error bars for confidence intervals around the selected y variable\nFree y Scales: activate to enable separate y scales in each plot\nLog y-axis: activate to plot all y-axes on a log-10 scale\n\nThe gear icon above the plot contains a pop-up menu that can be used to change the size of the plot for exporting.\nTable\nThe gear icon above the table contains a pop-up menu that can be used to change the appearance of the table:\n\nThe “Confidence intervals” and “Credibility-weighted termination rates” switches add these outputs to the table. These values are hidden as a default to prevent over-crowding.\nThe “Include color scales” switch disables or re-enables conditional color formatting.\nThe “Decimals” slider controls the number of decimals displayed for percentage fields.\nThe “Font size multiple” slider impacts the table’s font size\n\nExport\nThis pop-up menu contains options for saving summarized experience data or the plot. Data is saved as a CSV file. The plot is saved as a png file."
  },
  {
    "objectID": "reference/exp_shiny.html#examples",
    "href": "reference/exp_shiny.html#examples",
    "title": "exp_shiny",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nimport polars as pl\nimport numpy as np\n\ncensus_dat = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\naccount_vals = xp.load_account_vals()\n\nexpo = xp.ExposedDF(census_dat, \"2019-12-31\",\n                    target_status=\"Surrender\")\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10),\n                                [.2, .15], np.repeat(0.05, 3)))\nexpo.data = expo.data.with_columns(\n    expected_1=expected_table[expo.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)                                \nexpo.add_transactions(withdrawals)\nexpo.data = expo.data.join(account_vals, how='left',\n                           on=[\"pol_num\", \"pol_date_yr\"])\n\napp = expo.exp_shiny(expected=['expected_1', 'expected_2'])"
  },
  {
    "objectID": "reference/ExposedDF.html",
    "href": "reference/ExposedDF.html",
    "title": "ExposedDF",
    "section": "",
    "text": "expose.ExposedDF(self, data, end_date, start_date=date(1900, 1, 1), target_status=None, cal_expo=False, expo_length='year', col_pol_num='pol_num', col_status='status', col_issue_date='issue_date', col_term_date='term_date', default_status=None)\nExposed data frame class\nConvert a data frame of census-level records into an object with exposure-level records."
  },
  {
    "objectID": "reference/ExposedDF.html#parameters",
    "href": "reference/ExposedDF.html#parameters",
    "title": "ExposedDF",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndata\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame with census-level records\nrequired\n\n\nend_date\ndatetime.date | str\nExperience study end date. If a string is passed, it must be in %Y-%m-%d format.\nrequired\n\n\nstart_date\ndatetime.date | str\nExperience study start date. If a string is passed, it must be in %Y-%m-%d format.\ndate(1900, 1, 1)\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nTarget status values\nNone\n\n\ncal_expo\nbool\nSet to True for calendar year exposures. Otherwise policy year exposures are assumed.\nFalse\n\n\nexpo_length\n(year, quarter, month, week)\nExposure period length\n'year'\n\n\ncol_pol_num\nstr\nName of the column in data containing the policy number\n'pol_num'\n\n\ncol_status\nstr\nname of the column in data containing the policy status\n'status'\n\n\ncol_issue_date\nstr\nname of the column in data containing the issue date\n'issue_date'\n\n\ncol_term_date\nstr\nname of the column in data containing the termination date\n'term_date'\n\n\ndefault_status\nstr\nDefault active status code. If None, the most common status is assumed.\nNone"
  },
  {
    "objectID": "reference/ExposedDF.html#attributes",
    "href": "reference/ExposedDF.html#attributes",
    "title": "ExposedDF",
    "section": "Attributes",
    "text": "Attributes\n\n\n\n\n\n\n\n\nName\nType\nDescription\n\n\n\n\ndata\npolars.polars.DataFrame\nA Polars data frame with exposure level records. The results include all existing columns in the original input data plus new columns for exposures and observation periods. Observation periods include counters for policy exposures, start dates, and end dates. Both start dates and end dates are inclusive bounds. For policy year exposures, two observation period columns are returned. Columns beginning with (pol_) are integer policy periods. Columns beginning with (pol_date_) are calendar dates representing anniversary dates, monthiversary dates, etc.\n\n\nend_date, start_date, target_status, cal_expo, expo_length, default_status\n\nValues passed on class instantiation. See Parameters for definitions.\n\n\nexposure_type\nstr\nA description of the exposure type that combines the cal_expo and expo_length properties\n\n\ndate_cols\ntuple\nNames of the start and end date columns in data for each exposure period\n\n\ntrx_types\nlist\nList of transaction types that have been attached to data using the add_transactions() method."
  },
  {
    "objectID": "reference/ExposedDF.html#notes",
    "href": "reference/ExposedDF.html#notes",
    "title": "ExposedDF",
    "section": "Notes",
    "text": "Notes\nCensus-level data refers to a data set wherein there is one row per unique policy. Exposure-level data expands census-level data such that there is one record per policy per observation period. Observation periods could be any meaningful period of time such as a policy year, policy month, calendar year, calendar quarter, calendar month, etc.\ntarget_status is used in the calculation of exposures. The annual exposure method is applied, which allocates a full period of exposure for any statuses in target_status. For all other statuses, new entrants and exits are partially exposed based on the time elapsed in the observation period. This method is consistent with the Balducci Hypothesis, which assumes that the probability of termination is proportionate to the time elapsed in the observation period. If the annual exposure method isn’t desired, target_status can be ignored. In this case, partial exposures are always applied regardless of status.\ndefault_status is used to indicate the default active status that should be used when exposure records are created. If None, then the most common status will be assumed.\nAlternative class constructors\n\nexpose_py(), expose_pq(), expose_pm(), expose_pw(), expose_cy(), expose_cq(), expose_cm(), expose_cw()\nConvenience constructor functions for specific exposure calculations. The two characters after the underscore describe the exposure type and exposure period, respectively. For exposures types p refers to policy years c refers to calendar years For exposure periods y = years q = quarters m = months w = weeks Each constructor has the same inputs as the __init__ method except that expo_length and cal_expo arguments are prepopulated.\nfrom_DataFrame() Convert a data frame that already has exposure-level records into an ExposedDF object."
  },
  {
    "objectID": "reference/ExposedDF.html#references",
    "href": "reference/ExposedDF.html#references",
    "title": "ExposedDF",
    "section": "References",
    "text": "References\nAtkinson and McGarry (2016). Experience Study Calculations\nhttps://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf"
  },
  {
    "objectID": "reference/ExposedDF.html#examples",
    "href": "reference/ExposedDF.html#examples",
    "title": "ExposedDF",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\n\nxp.ExposedDF(xp.load_toy_census(), \"2020-12-31\", \n             target_status='Surrender')\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2020-12-31\n\nshape: (33, 8)\n┌─────────┬────────┬────────────┬───────────┬────────┬─────────────┬─────────────────┬──────────┐\n│ pol_num ┆ status ┆ issue_date ┆ term_date ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_end ┆ exposure │\n│ ---     ┆ ---    ┆ ---        ┆ ---       ┆ ---    ┆ ---         ┆ ---             ┆ ---      │\n│ i64     ┆ enum   ┆ date       ┆ date      ┆ u32    ┆ date        ┆ date            ┆ f64      │\n╞═════════╪════════╪════════════╪═══════════╪════════╪═════════════╪═════════════════╪══════════╡\n│ 1       ┆ Active ┆ 2010-01-01 ┆ null      ┆ 1      ┆ 2010-01-01  ┆ 2010-12-31      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2010-01-01 ┆ null      ┆ 2      ┆ 2011-01-01  ┆ 2011-12-31      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2010-01-01 ┆ null      ┆ 3      ┆ 2012-01-01  ┆ 2012-12-31      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2010-01-01 ┆ null      ┆ 4      ┆ 2013-01-01  ┆ 2013-12-31      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2010-01-01 ┆ null      ┆ 5      ┆ 2014-01-01  ┆ 2014-12-31      ┆ 1.0      │\n│ …       ┆ …      ┆ …          ┆ …         ┆ …      ┆ …           ┆ …               ┆ …        │\n│ 3       ┆ Active ┆ 2009-11-10 ┆ null      ┆ 8      ┆ 2016-11-10  ┆ 2017-11-09      ┆ 1.0      │\n│ 3       ┆ Active ┆ 2009-11-10 ┆ null      ┆ 9      ┆ 2017-11-10  ┆ 2018-11-09      ┆ 1.0      │\n│ 3       ┆ Active ┆ 2009-11-10 ┆ null      ┆ 10     ┆ 2018-11-10  ┆ 2019-11-09      ┆ 1.0      │\n│ 3       ┆ Active ┆ 2009-11-10 ┆ null      ┆ 11     ┆ 2019-11-10  ┆ 2020-11-09      ┆ 1.0      │\n│ 3       ┆ Active ┆ 2009-11-10 ┆ null      ┆ 12     ┆ 2020-11-10  ┆ 2021-11-09      ┆ 0.142466 │\n└─────────┴────────┴────────────┴───────────┴────────┴─────────────┴─────────────────┴──────────┘"
  },
  {
    "objectID": "reference/ExposedDF.html#methods",
    "href": "reference/ExposedDF.html#methods",
    "title": "ExposedDF",
    "section": "Methods",
    "text": "Methods\n\n\n\nName\nDescription\n\n\n\n\nadd_transactions\nAdd transactions to an experience study\n\n\nexp_stats\nSummarize experience study records\n\n\nexpose_cm\nCreate an ExposedDF with calendar month exposures\n\n\nexpose_cq\nCreate an ExposedDF with calendar quarter exposures\n\n\nexpose_cw\nCreate an ExposedDF with calendar week exposures\n\n\nexpose_cy\nCreate an ExposedDF with calendar year exposures\n\n\nexpose_pm\nCreate an ExposedDF with policy month exposures\n\n\nexpose_pq\nCreate an ExposedDF with policy quarter exposures\n\n\nexpose_pw\nCreate an ExposedDF with policy week exposures\n\n\nexpose_py\nCreate an ExposedDF with policy year exposures\n\n\nexpose_split\nSplit calendar exposures by policy year\n\n\nfrom_DataFrame\nCoerce a data frame to an ExposedDF object\n\n\ngroup_by\nSet grouping variables for summary methods like exp_stats() and\n\n\ntrx_stats\nSummarize transactions and utilization rates\n\n\nungroup\nRemove all grouping variables for summary methods like exp_stats()\n\n\n\n\nadd_transactions\nexpose.ExposedDF.add_transactions(trx_data, col_pol_num='pol_num', col_trx_date='trx_date', col_trx_type='trx_type', col_trx_amt='trx_amt')\nAdd transactions to an experience study\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ntrx_data\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame containing transactions details. This data frame must have columns for policy numbers, transaction dates, transaction types, and transaction amounts.\nrequired\n\n\ncol_pol_num\nstr\nName of the column in trx_data containing the policy number\n'pol_num'\n\n\ncol_trx_date\nstr\nName of the column in trx_data containing the transaction date\n'trx_date'\n\n\ncol_trx_type\nstr\nName of the column in trx_data containing the transaction type\n'trx_type'\n\n\ncol_trx_amt\nstr\nName of the column in trx_data containing the transaction amount\n'trx_amt'\n\n\n\n\n\nNotes\nThis function attaches transactions to an ExposedDF object. Transactions are grouped and summarized such that the number of rows in the data does not change. Two columns are added to the output for each transaction type. These columns have names of the pattern trx_n_{*} (transaction counts) and trx_amt_{*} (transaction_amounts). The trx_types property is updated to include the new transaction types found in trx_data.\nTransactions are associated with the data object by matching transactions dates with exposure dates ranges found in the ExposedDF.\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (141_252, 19)\n┌─────────┬────────┬────────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ trx_n_Base ┆ trx_n_Ride ┆ trx_amt_Ba ┆ trx_amt_Ri │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---        ┆ r          ┆ se         ┆ der        │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ i32        ┆ ---        ┆ ---        ┆ ---        │\n│         ┆        ┆            ┆          ┆   ┆            ┆ i32        ┆ f64        ┆ f64        │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 547.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 106.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 31.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 75.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 466.0      │\n└─────────┴────────┴────────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘\n\n\n\n\n\nexp_stats\nexpose.ExposedDF.exp_stats(target_status=None, expected=None, wt=None, conf_int=False, credibility=False, conf_level=0.95, cred_r=0.05, col_exposure='exposure')\nSummarize experience study records\nCreate a summary of termination experience for a given target status (an ExpStats object).\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nA single string, list, or array of target status values\nNone\n\n\nexpected\nstr | list | numpy.numpy.ndarray\nA single string, list, or array of column names in the data property with expected values\nNone\n\n\nwt\nstr\nName of the column in the data property containing weights to use in the calculation of claims, exposures, and partial credibility.\nNone\n\n\nconf_int\nbool\nIf True, the output will include confidence intervals around the observed termination rates and any actual-to-expected ratios.\nFalse\n\n\ncredibility\nbool\nWhether the output should include partial credibility weights and credibility-weighted decrement rates.\nFalse\n\n\nconf_level\nfloat\nConfidence level under the Limited Fluctuation credibility method\n0.95\n\n\ncred_r\nfloat\nError tolerance under the Limited Fluctuation credibility method\n0.05\n\n\ncol_exposure\nstr\nName of the column in data containing exposures. Only necessary for SplitExposedDF objects.\n'exposure'\n\n\n\n\n\nNotes\nIf the ExposedDF object is grouped (see the group_by() method), the returned ExpStats object’s data will contain one row per group.\nIf nothing is passed to target_status, the target_status property of the ExposedDF object will be used. If that property is None, all status values except the first level will be assumed. This will produce a warning message.\nExpected values\nThe expected argument is optional. If provided, this argument must be a string, list, or array with values corresponding to columns in the data property containing expected experience. More than one expected basis can be provided.\nConfidence intervals\nIf conf_int is set to True, the output will contain lower and upper confidence interval limits for the observed termination rate and any actual-to-expected ratios. The confidence level is dictated by conf_level. If no weighting variable is passed to wt, confidence intervals will be constructed assuming a binomial distribution of claims. Otherwise, confidence intervals will be calculated assuming that the aggregate claims distribution is normal with a mean equal to observed claims and a variance equal to:\nVar(S) = E(N) * Var(X) + E(X)**2 * Var(N),\nWhere S is the aggregate claim random variable, X is the weighting variable assumed to follow a normal distribution, and N is a binomial random variable for the number of claims.\nIf credibility is True and expected values are passed to expected, the output will also contain confidence intervals for any credibility-weighted termination rates.\nCredibility\nIf credibility is set to True, the output will contain a credibility column equal to the partial credibility estimate under the Limited Fluctuation credibility method (also known as Classical Credibility) assuming a binomial distribution of claims.\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nExpStats\nAn ExpStats object with a data property that includes columns for any grouping variables, claims, exposures, and observed decrement rates (q_obs). If any values are passed to expected, additional columns will be added for expected decrements and actual-to-expected ratios. If credibility is set to True, additional columns are added for partial credibility and credibility-weighted decrement rates (assuming values are passed to expected). If conf_int is set to True, additional columns are added for lower and upper confidence interval limits around the observed termination rates and any actual-to-expected ratios. Additionally, if credibility is True and expected values are passed to expected, the output will contain confidence intervals around credibility-weighted termination rates. Confidence interval columns include the name of the original output column suffixed by either _lower or _upper. If a value is passed to wt, additional columns are created containing the the sum of weights (.weight), the sum of squared weights (.weight_qs), and the number of records (.weight_n).\n\n\n\n\n\nReferences\nHerzog, Thomas (1999). Introduction to Credibility Theory\n\n\nExamples\n\nimport actxps as xp\n\n(xp.ExposedDF(xp.load_census_dat(),\n              \"2019-12-31\", \n              target_status=\"Surrender\").\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(conf_int=True))\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (30, 8)\n┌────────┬──────────┬──────────┬────────┬──────────────┬──────────┬─────────────┬─────────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    ┆ q_obs_lower ┆ q_obs_upper │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆ ---          ┆ ---      ┆ ---         ┆ ---         │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆ f64          ┆ f64      ┆ f64         ┆ f64         │\n╞════════╪══════════╪══════════╪════════╪══════════════╪══════════╪═════════════╪═════════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ 7719.80774   ┆ 0.007254 ┆ 0.005441    ┆ 0.009197    │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ 11532.404626 ┆ 0.003989 ┆ 0.002862    ┆ 0.005203    │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ 7102.81316   ┆ 0.012953 ┆ 0.010418    ┆ 0.015628    │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ 10611.967258 ┆ 0.006408 ┆ 0.0049      ┆ 0.00801     │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ 6446.916146  ┆ 0.010393 ┆ 0.008066    ┆ 0.012874    │\n│ …      ┆ …        ┆ …        ┆ …      ┆ …            ┆ …        ┆ …           ┆ …           │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ 1117.137361  ┆ 0.043862 ┆ 0.032225    ┆ 0.056394    │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ 262.622262   ┆ 0.125656 ┆ 0.087578    ┆ 0.167541    │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ 609.216476   ┆ 0.047602 ┆ 0.031188    ┆ 0.065658    │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ 74.050109    ┆ 0.108035 ┆ 0.040513    ┆ 0.189061    │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ 194.128602   ┆ 0.046361 ┆ 0.020605    ┆ 0.077268    │\n└────────┴──────────┴──────────┴────────┴──────────────┴──────────┴─────────────┴─────────────┘\n\n\n\n\n\nexpose_cm\nexpose.ExposedDF.expose_cm(data, end_date, **kwargs)\nCreate an ExposedDF with calendar month exposures\n\n\nexpose_cq\nexpose.ExposedDF.expose_cq(data, end_date, **kwargs)\nCreate an ExposedDF with calendar quarter exposures\n\n\nexpose_cw\nexpose.ExposedDF.expose_cw(data, end_date, **kwargs)\nCreate an ExposedDF with calendar week exposures\n\n\nexpose_cy\nexpose.ExposedDF.expose_cy(data, end_date, **kwargs)\nCreate an ExposedDF with calendar year exposures\n\n\nexpose_pm\nexpose.ExposedDF.expose_pm(data, end_date, **kwargs)\nCreate an ExposedDF with policy month exposures\n\n\nexpose_pq\nexpose.ExposedDF.expose_pq(data, end_date, **kwargs)\nCreate an ExposedDF with policy quarter exposures\n\n\nexpose_pw\nexpose.ExposedDF.expose_pw(data, end_date, **kwargs)\nCreate an ExposedDF with policy week exposures\n\n\nexpose_py\nexpose.ExposedDF.expose_py(data, end_date, **kwargs)\nCreate an ExposedDF with policy year exposures\n\n\nexpose_split\nexpose.ExposedDF.expose_split()\nSplit calendar exposures by policy year\nSplit calendar period exposures that cross a policy anniversary into a pre-anniversary record and a post-anniversary record.\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nSplitExposedDF\nA subclass of ExposedDF with calendar period exposures split by policy year.\n\n\n\n\n\nNotes\nThe ExposedDF must have calendar year, quarter, month, or week exposure records. Calendar year exposures are created by passing cal_expo=True to ExposedDF (or alternatively, with the class methods ExposedDF.expose_cy(), ExposedDF.expose_cq(), ExposedDF.expose_cm(), and ExposedDF.expose_cw()).\nAfter splitting, the resulting data will contain both calendar exposures and policy year exposures. These columns will be named ‘exposure_cal’ and ‘exposure_pol’, respectively. Calendar exposures will be in the original units passed to SplitExposedDF(). Policy exposures will always be expressed in years. Downstream functions like exp_stats() and exp_shiny() will require clarification as to which exposure basis should be used to summarize results.\nAfter splitting, the column ‘pol_yr’ will contain policy years.\n\n\nExamples\n\nimport actxps as xp\ntoy_census = xp.load_toy_census()\nexpo = xp.ExposedDF.expose_cy(toy_census, \"2022-12-31\")\nexpo.expose_split()\n\nExposure data\n\nExposure type: split_year\nTarget status: None\nStudy range: 1900-01-01 to 2022-12-31\n\nshape: (58, 9)\n┌─────────┬───────────┬────────────┬────────────┬───┬────────────┬────────┬────────────┬───────────┐\n│ pol_num ┆ status    ┆ issue_date ┆ term_date  ┆ … ┆ cal_yr_end ┆ pol_yr ┆ exposure_p ┆ exposure_ │\n│ ---     ┆ ---       ┆ ---        ┆ ---        ┆   ┆ ---        ┆ ---    ┆ ol         ┆ cal       │\n│ i64     ┆ enum      ┆ date       ┆ date       ┆   ┆ date       ┆ i32    ┆ ---        ┆ ---       │\n│         ┆           ┆            ┆            ┆   ┆            ┆        ┆ f64        ┆ f64       │\n╞═════════╪═══════════╪════════════╪════════════╪═══╪════════════╪════════╪════════════╪═══════════╡\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2010-12-31 ┆ 1      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2011-12-31 ┆ 2      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2012-12-31 ┆ 3      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2013-12-31 ┆ 4      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2014-12-31 ┆ 5      ┆ 1.0        ┆ 1.0       │\n│ …       ┆ …         ┆ …          ┆ …          ┆ … ┆ …          ┆ …      ┆ …          ┆ …         │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2020-11-09 ┆ 11     ┆ 0.857923   ┆ 0.857923  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2020-12-31 ┆ 12     ┆ 0.142466   ┆ 0.142077  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2021-11-09 ┆ 12     ┆ 0.857534   ┆ 0.857534  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2021-12-31 ┆ 13     ┆ 0.142466   ┆ 0.142466  │\n│ 3       ┆ Surrender ┆ 2009-11-10 ┆ 2022-02-25 ┆ … ┆ 2022-11-09 ┆ 13     ┆ 0.153425   ┆ 0.153425  │\n└─────────┴───────────┴────────────┴────────────┴───┴────────────┴────────┴────────────┴───────────┘\n\n\n\n\nSee Also\nSplitExposedDF() for full information on SplitExposedDF class.\n\n\n\nfrom_DataFrame\nexpose.ExposedDF.from_DataFrame(data, end_date, start_date=date(1900, 1, 1), target_status=None, cal_expo=False, expo_length='year', trx_types=None, col_pol_num='pol_num', col_status='status', col_exposure='exposure', col_pol_per=None, cols_dates=None, col_trx_n_='trx_n_', col_trx_amt_='trx_amt_', default_status=None)\nCoerce a data frame to an ExposedDF object\nThe input data frame must have columns for policy numbers, statuses, exposures, policy periods (for policy exposures only), and exposure start / end dates. Optionally, if data has transaction counts and amounts by type, these can be specified without calling add_transactions().\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndata\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame with exposure-level records\nrequired\n\n\nend_date\ndatetime.date | str\nExperience study end date\nrequired\n\n\nstart_date\ndatetime.date | str\nExperience study start date\ndate(1900, 1, 1)\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nTarget status values\nNone\n\n\ncal_expo\nbool\nSet to True for calendar year exposures. Otherwise policy year exposures are assumed.\nFalse\n\n\nexpo_length\nstr\nExposure period length. Must be ‘year’, ‘quarter’, ‘month’, or ‘week’\n'year'\n\n\ntrx_types\nlist | str\nList containing unique transaction types that have been attached to data. For each value in trx_types, from_DataFrame requires that columns exist in data named trx_n_{*} and trx_amt_{*} containing transaction counts and amounts, respectively. The prefixes “trx_n_” and “trx_amt_” can be overridden using the col_trx_n_ and col_trx_amt_ arguments.\nNone\n\n\ncol_pol_num\nstr\nName of the column in data containing the policy number\n'pol_num'\n\n\ncol_status\nstr\nname of the column in data containing the policy status\n'status'\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'\n\n\ncol_pol_per\nstr\nName of the column in data containing policy exposure periods. Only necessary if cal_expo is False. The assumed default is either “pol_yr”, “pol_qtr”, “pol_mth”, or “pol_wk” depending on the value of expo_length.\nNone\n\n\ncols_dates\nstr\nNames of the columns in data containing exposure start and end dates. Both date ranges are assumed to be exclusive. The assumed default is of the form A_B. A is “cal” if cal_expo is True or “pol” otherwise. B is either “yr”, “qtr”, “mth”, or “wk” depending on the value of expo_length.\nNone\n\n\ncol_trx_n_\nstr\nPrefix to use for columns containing transaction counts.\n\"trx_n_\"\n\n\ncol_trx_amt_\nstr\nPrefix to use for columns containing transaction amounts.\n\"trx_amt_\"\n\n\ndefault_status\nstr\nDefault active status code\nNone\n\n\n\n\n\nReturns\n\n\n\nType\nDescription\n\n\n\n\nactxps.expose.ExposedDF\nAn ExposedDF object.\n\n\n\n\n\n\ngroup_by\nexpose.ExposedDF.group_by(*by)\nSet grouping variables for summary methods like exp_stats() and trx_stats().\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\n*by\n\nColumn names in data that will be used as grouping variables\n()\n\n\n\n\n\nNotes\nThis function will not directly apply the DataFrame.group_by() method to the data property. Instead, it will set the groups property of the ExposedDF object. The groups property is subsequently used to group data within summary methods like exp_stats() and trx_stats().\n\n\n\ntrx_stats\nexpose.ExposedDF.trx_stats(trx_types=None, percent_of=None, combine_trx=False, full_exposures_only=True, conf_int=False, conf_level=0.95, col_exposure='exposure')\nSummarize transactions and utilization rates\nCreate a summary of transaction counts, amounts, and utilization rates (a TrxStats object).\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ntrx_types\nlist or str\nA list of transaction types to include in the output. If None is provided, all available transaction types in the trx_types property will be used.\nNone\n\n\npercent_of\nlist or str\nA list containing column names in the data property to use as denominators in the calculation of utilization rates or actual-to-expected ratios.\nNone\n\n\ncombine_trx\nbool\nIf False (default), the results will contain output rows for each transaction type. If True, the results will contains aggregated results across all transaction types.\nFalse\n\n\nfull_exposures_only\nbool\nIf True (default), partially exposed records will be ignored in the results.\nTrue\n\n\nconf_int\nbool\nIf True, the output will include confidence intervals around the observed utilization rate and any percent_of output columns.\nFalse\n\n\nconf_level\nfloat\nConfidence level for confidence intervals\n0.95\n\n\ncol_exposure\nstr\nName of the column in the data property containing exposures. Only necessary for SplitExposedDF objects.\n'exposure'\n\n\n\n\n\nNotes\nIf the ExposedDF object is grouped (see the group_by() method), the returned TrxStats object’s data will contain one row per group.\nAny number of transaction types can be passed to the trx_types argument, however each transaction type must appear in the trx_types property of the ExposedDF object. In addition, trx_stats() expects to see columns named trx_n_{*} (for transaction counts) and trx_amt_{*} for (transaction amounts) for each transaction type. To ensure data is in the appropriate format, use the class method ExposedDF.from_DataFrame() to convert an existing data frame with transactions or use add_transactions() to attach transactions to an existing ExposedDF object.\n“Percentage of” calculations\nThe percent_of argument is optional. If provided, this argument must be list with values corresponding to columns in the data property containing values to use as denominators in the calculation of utilization rates or actual-to-expected ratios. Example usage:\n\nIn a study of partial withdrawal transactions, if percent_of refers to account values, observed withdrawal rates can be determined.\nIn a study of recurring claims, if percent_of refers to a column containing a maximum benefit amount, utilization rates can be determined.\n\nConfidence intervals\nIf conf_int is set to True, the output will contain lower and upper confidence interval limits for the observed utilization rate and any percent_of output columns. The confidence level is dictated by conf_level.\n\nIntervals for the utilization rate (trx_util) assume a binomial distribution.\nIntervals for transactions as a percentage of another column with non-zero transactions (pct_of_{*}_w_trx) are constructed using a normal distribution\nIntervals for transactions as a percentage of another column regardless of transaction utilization (pct_of_{*}_all) are calculated assuming that the aggregate distribution is normal with a mean equal to observed transactions and a variance equal to:\nVar(S) = E(N) * Var(X) + E(X)**2 * Var(N),\n\nWhere S is the aggregate transactions random variable, X is an individual transaction amount assumed to follow a normal distribution, and N is a binomial random variable for transaction utilization.\nDefault removal of partial exposures\nAs a default, partial exposures are removed from data before summarizing results. This is done to avoid complexity associated with a lopsided skew in the timing of transactions. For example, if transactions can occur on a monthly basis or annually at the beginning of each policy year, partial exposures may not be appropriate. If a policy had an exposure of 0.5 years and was taking withdrawals annually at the beginning of the year, an argument could be made that the exposure should instead be 1 complete year. If the same policy was expected to take withdrawals 9 months into the year, it’s not clear if the exposure should be 0.5 years or 0.5 / 0.75 years. To override this treatment, set full_exposures_only to False.\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nTrxStats\nA TrxStats object with a data property that includes columns for any grouping variables and transaction types, plus the following: - trx_n: the number of unique transactions. - trx_amt: total transaction amount - trx_flag: the number of observation periods with non-zero transaction amounts. - exposure: total exposures - avg_trx: mean transaction amount (trx_amt / trx_flag) - avg_all: mean transaction amount over all records (trx_amt / exposure) - trx_freq: transaction frequency when a transaction occurs (trx_n / trx_flag) - trx_utilization: transaction utilization per observation period (trx_flag / exposure) If percent_of is provided, the results will also include: - The sum of any columns passed to percent_of with non-zero transactions. These columns include the suffix _w_trx. - The sum of any columns passed to percent_of - pct_of_{*}_w_trx: total transactions as a percentage of column {*}_w_trx - pct_of_{*}_all: total transactions as a percentage of column {*} If conf_int is set to True, additional columns are added for lower and upper confidence interval limits around the observed utilization rate and any percent_of output columns. Confidence interval columns include the name of the original output column suffixed by either _lower or _upper. If values are passed to percent_of, an additional column is created containing the the sum of squared transaction amounts (trx_amt_sq).\n\n\n\n\n\nExamples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\nexpo.group_by('inc_guar').trx_stats(percent_of=\"premium\",\n                                    combine_trx=True,\n                                    conf_int=True)\n\nTransaction study results\n\nGroups: inc_guar\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\nTransactions as % of: premium\n\nshape: (2, 21)\n┌──────────┬──────────┬─────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ pct_of_pre ┆ pct_of_pre ┆ pct_of_pre ┆ pct_of_pre │\n│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ mium_w_trx ┆ mium_w_trx ┆ mium_all_l ┆ mium_all_u │\n│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ _lower     ┆ _upper     ┆ ower       ┆ pper       │\n│          ┆          ┆         ┆          ┆   ┆ ---        ┆ ---        ┆ ---        ┆ ---        │\n│          ┆          ┆         ┆          ┆   ┆ f64        ┆ f64        ┆ f64        ┆ f64        │\n╞══════════╪══════════╪═════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ false    ┆ All      ┆ 52939.0 ┆ 24703    ┆ … ┆ 0.027557   ┆ 0.028621   ┆ 0.014253   ┆ 0.014861   │\n│ true     ┆ All      ┆ 84882.0 ┆ 39462    ┆ … ┆ 0.055607   ┆ 0.057363   ┆ 0.029064   ┆ 0.030067   │\n└──────────┴──────────┴─────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘\n\n\n\n\n\nungroup\nexpose.ExposedDF.ungroup()\nRemove all grouping variables for summary methods like exp_stats() and trx_stats()."
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html",
    "href": "reference/ExposedDF.exp_stats.html",
    "title": "ExposedDF.exp_stats",
    "section": "",
    "text": "expose.ExposedDF.exp_stats(target_status=None, expected=None, wt=None, conf_int=False, credibility=False, conf_level=0.95, cred_r=0.05, col_exposure='exposure')\nSummarize experience study records\nCreate a summary of termination experience for a given target status (an ExpStats object)."
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html#parameters",
    "href": "reference/ExposedDF.exp_stats.html#parameters",
    "title": "ExposedDF.exp_stats",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nA single string, list, or array of target status values\nNone\n\n\nexpected\nstr | list | numpy.numpy.ndarray\nA single string, list, or array of column names in the data property with expected values\nNone\n\n\nwt\nstr\nName of the column in the data property containing weights to use in the calculation of claims, exposures, and partial credibility.\nNone\n\n\nconf_int\nbool\nIf True, the output will include confidence intervals around the observed termination rates and any actual-to-expected ratios.\nFalse\n\n\ncredibility\nbool\nWhether the output should include partial credibility weights and credibility-weighted decrement rates.\nFalse\n\n\nconf_level\nfloat\nConfidence level under the Limited Fluctuation credibility method\n0.95\n\n\ncred_r\nfloat\nError tolerance under the Limited Fluctuation credibility method\n0.05\n\n\ncol_exposure\nstr\nName of the column in data containing exposures. Only necessary for SplitExposedDF objects.\n'exposure'"
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html#notes",
    "href": "reference/ExposedDF.exp_stats.html#notes",
    "title": "ExposedDF.exp_stats",
    "section": "Notes",
    "text": "Notes\nIf the ExposedDF object is grouped (see the group_by() method), the returned ExpStats object’s data will contain one row per group.\nIf nothing is passed to target_status, the target_status property of the ExposedDF object will be used. If that property is None, all status values except the first level will be assumed. This will produce a warning message.\nExpected values\nThe expected argument is optional. If provided, this argument must be a string, list, or array with values corresponding to columns in the data property containing expected experience. More than one expected basis can be provided.\nConfidence intervals\nIf conf_int is set to True, the output will contain lower and upper confidence interval limits for the observed termination rate and any actual-to-expected ratios. The confidence level is dictated by conf_level. If no weighting variable is passed to wt, confidence intervals will be constructed assuming a binomial distribution of claims. Otherwise, confidence intervals will be calculated assuming that the aggregate claims distribution is normal with a mean equal to observed claims and a variance equal to:\nVar(S) = E(N) * Var(X) + E(X)**2 * Var(N),\nWhere S is the aggregate claim random variable, X is the weighting variable assumed to follow a normal distribution, and N is a binomial random variable for the number of claims.\nIf credibility is True and expected values are passed to expected, the output will also contain confidence intervals for any credibility-weighted termination rates.\nCredibility\nIf credibility is set to True, the output will contain a credibility column equal to the partial credibility estimate under the Limited Fluctuation credibility method (also known as Classical Credibility) assuming a binomial distribution of claims."
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html#returns",
    "href": "reference/ExposedDF.exp_stats.html#returns",
    "title": "ExposedDF.exp_stats",
    "section": "Returns",
    "text": "Returns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nExpStats\nAn ExpStats object with a data property that includes columns for any grouping variables, claims, exposures, and observed decrement rates (q_obs). If any values are passed to expected, additional columns will be added for expected decrements and actual-to-expected ratios. If credibility is set to True, additional columns are added for partial credibility and credibility-weighted decrement rates (assuming values are passed to expected). If conf_int is set to True, additional columns are added for lower and upper confidence interval limits around the observed termination rates and any actual-to-expected ratios. Additionally, if credibility is True and expected values are passed to expected, the output will contain confidence intervals around credibility-weighted termination rates. Confidence interval columns include the name of the original output column suffixed by either _lower or _upper. If a value is passed to wt, additional columns are created containing the the sum of weights (.weight), the sum of squared weights (.weight_qs), and the number of records (.weight_n)."
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html#references",
    "href": "reference/ExposedDF.exp_stats.html#references",
    "title": "ExposedDF.exp_stats",
    "section": "References",
    "text": "References\nHerzog, Thomas (1999). Introduction to Credibility Theory"
  },
  {
    "objectID": "reference/ExposedDF.exp_stats.html#examples",
    "href": "reference/ExposedDF.exp_stats.html#examples",
    "title": "ExposedDF.exp_stats",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\n\n(xp.ExposedDF(xp.load_census_dat(),\n              \"2019-12-31\", \n              target_status=\"Surrender\").\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(conf_int=True))\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (30, 8)\n┌────────┬──────────┬──────────┬────────┬──────────────┬──────────┬─────────────┬─────────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    ┆ q_obs_lower ┆ q_obs_upper │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆ ---          ┆ ---      ┆ ---         ┆ ---         │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆ f64          ┆ f64      ┆ f64         ┆ f64         │\n╞════════╪══════════╪══════════╪════════╪══════════════╪══════════╪═════════════╪═════════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ 7719.80774   ┆ 0.007254 ┆ 0.005441    ┆ 0.009197    │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ 11532.404626 ┆ 0.003989 ┆ 0.002862    ┆ 0.005203    │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ 7102.81316   ┆ 0.012953 ┆ 0.010418    ┆ 0.015628    │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ 10611.967258 ┆ 0.006408 ┆ 0.0049      ┆ 0.00801     │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ 6446.916146  ┆ 0.010393 ┆ 0.008066    ┆ 0.012874    │\n│ …      ┆ …        ┆ …        ┆ …      ┆ …            ┆ …        ┆ …           ┆ …           │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ 1117.137361  ┆ 0.043862 ┆ 0.032225    ┆ 0.056394    │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ 262.622262   ┆ 0.125656 ┆ 0.087578    ┆ 0.167541    │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ 609.216476   ┆ 0.047602 ┆ 0.031188    ┆ 0.065658    │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ 74.050109    ┆ 0.108035 ┆ 0.040513    ┆ 0.189061    │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ 194.128602   ┆ 0.046361 ┆ 0.020605    ┆ 0.077268    │\n└────────┴──────────┴──────────┴────────┴──────────────┴──────────┴─────────────┴─────────────┘"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "actxps ",
    "section": "",
    "text": "The actxps package provides a set of tools to assist with the creation of actuarial experience studies. Experience studies are used by actuaries to explore historical experience across blocks of business and to inform assumption setting for projection models."
  },
  {
    "objectID": "index.html#installation",
    "href": "index.html#installation",
    "title": "actxps ",
    "section": "Installation",
    "text": "Installation\nThe actxps package can be installed from PyPI with:\n$ pip install actxps"
  },
  {
    "objectID": "index.html#basic-usage",
    "href": "index.html#basic-usage",
    "title": "actxps ",
    "section": "Basic usage",
    "text": "Basic usage\nAn expanded version of this demo is available at Getting started with actxps.\nThe actxps package includes simulated census data for a theoretical deferred annuity product with an optional guaranteed income rider. The grain of this data is one row per policy.\n\nimport actxps as xp\nimport numpy as np\nimport polars as pl\n\ncensus_dat = xp.load_census_dat()\nprint(census_dat)\n\nshape: (20_000, 11)\n┌─────────┬───────────┬────────────┬──────────┬───┬────────┬────────┬─────────┬────────────┐\n│ pol_num ┆ status    ┆ issue_date ┆ inc_guar ┆ … ┆ gender ┆ wd_age ┆ premium ┆ term_date  │\n│ ---     ┆ ---       ┆ ---        ┆ ---      ┆   ┆ ---    ┆ ---    ┆ ---     ┆ ---        │\n│ i64     ┆ cat       ┆ date       ┆ bool     ┆   ┆ cat    ┆ i64    ┆ f64     ┆ date       │\n╞═════════╪═══════════╪════════════╪══════════╪═══╪════════╪════════╪═════════╪════════════╡\n│ 1       ┆ Active    ┆ 2014-12-17 ┆ true     ┆ … ┆ F      ┆ 77     ┆ 370.0   ┆ null       │\n│ 2       ┆ Surrender ┆ 2007-09-24 ┆ false    ┆ … ┆ F      ┆ 71     ┆ 708.0   ┆ 2019-03-08 │\n│ 3       ┆ Active    ┆ 2012-10-06 ┆ false    ┆ … ┆ F      ┆ 63     ┆ 466.0   ┆ null       │\n│ 4       ┆ Surrender ┆ 2005-06-27 ┆ true     ┆ … ┆ M      ┆ 62     ┆ 485.0   ┆ 2018-11-29 │\n│ 5       ┆ Active    ┆ 2019-11-22 ┆ false    ┆ … ┆ F      ┆ 67     ┆ 978.0   ┆ null       │\n│ …       ┆ …         ┆ …          ┆ …        ┆ … ┆ …      ┆ …      ┆ …       ┆ …          │\n│ 19996   ┆ Active    ┆ 2014-08-11 ┆ true     ┆ … ┆ F      ┆ 75     ┆ 3551.0  ┆ null       │\n│ 19997   ┆ Surrender ┆ 2006-11-20 ┆ false    ┆ … ┆ F      ┆ 77     ┆ 336.0   ┆ 2017-07-09 │\n│ 19998   ┆ Surrender ┆ 2017-02-20 ┆ true     ┆ … ┆ F      ┆ 68     ┆ 1222.0  ┆ 2018-08-03 │\n│ 19999   ┆ Active    ┆ 2015-04-11 ┆ false    ┆ … ┆ M      ┆ 78     ┆ 2138.0  ┆ null       │\n│ 20000   ┆ Active    ┆ 2009-04-29 ┆ true     ┆ … ┆ M      ┆ 72     ┆ 5751.0  ┆ null       │\n└─────────┴───────────┴────────────┴──────────┴───┴────────┴────────┴─────────┴────────────┘\n\n\nConvert census records to exposure records with one row per policy per year.\n\nexposed_data = xp.ExposedDF(census_dat,\n                            end_date=\"2019-12-31\",\n                            target_status=\"Surrender\")\n\nexposed_data\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (141_252, 15)\n┌─────────┬────────┬────────────┬──────────┬───┬────────┬─────────────┬─────────────────┬──────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_end ┆ exposure │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---    ┆ ---         ┆ ---             ┆ ---      │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ u32    ┆ date        ┆ date            ┆ f64      │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════╪═════════════╪═════════════════╪══════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 1      ┆ 2014-12-17  ┆ 2015-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 2      ┆ 2015-12-17  ┆ 2016-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 3      ┆ 2016-12-17  ┆ 2017-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 4      ┆ 2017-12-17  ┆ 2018-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 5      ┆ 2018-12-17  ┆ 2019-12-16      ┆ 1.0      │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …      ┆ …           ┆ …               ┆ …        │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 7      ┆ 2015-04-29  ┆ 2016-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 8      ┆ 2016-04-29  ┆ 2017-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 9      ┆ 2017-04-29  ┆ 2018-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 10     ┆ 2018-04-29  ┆ 2019-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 11     ┆ 2019-04-29  ┆ 2020-04-28      ┆ 0.674863 │\n└─────────┴────────┴────────────┴──────────┴───┴────────┴─────────────┴─────────────────┴──────────┘\n\n\nCreate a summary grouped by policy year and the presence of a guaranteed income rider.\n\nexp_res = (exposed_data.\n           group_by('pol_yr', 'inc_guar').\n           exp_stats())\n\nexp_res\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (30, 6)\n┌────────┬──────────┬──────────┬────────┬──────────────┬──────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆ ---          ┆ ---      │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆ f64          ┆ f64      │\n╞════════╪══════════╪══════════╪════════╪══════════════╪══════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ 7719.80774   ┆ 0.007254 │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ 11532.404626 ┆ 0.003989 │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ 7102.81316   ┆ 0.012953 │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ 10611.967258 ┆ 0.006408 │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ 6446.916146  ┆ 0.010393 │\n│ …      ┆ …        ┆ …        ┆ …      ┆ …            ┆ …        │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ 1117.137361  ┆ 0.043862 │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ 262.622262   ┆ 0.125656 │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ 609.216476   ┆ 0.047602 │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ 74.050109    ┆ 0.108035 │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ 194.128602   ┆ 0.046361 │\n└────────┴──────────┴──────────┴────────┴──────────────┴──────────┘\n\n\nCalculate actual-to-expected ratios.\nFirst, attach one or more columns of expected termination rates to the exposure data. Then, pass these column names to the expected argument of exp_stats().\n\nexpected_table = np.concatenate((\n    np.linspace(0.005, 0.03, 10), \n    np.array([0.2, 0.15]), \n    np.repeat(0.05, 3)\n    ))\n\n# using 2 different expected termination rates\nexposed_data.data = exposed_data.data.with_columns(\n    expected_1=expected_table[exposed_data.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (exposed_data.\n           group_by('pol_yr', 'inc_guar').\n           exp_stats(expected = [\"expected_1\", \"expected_2\"]))\n\nexp_res\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (30, 10)\n┌────────┬──────────┬──────────┬────────┬───┬────────────┬────────────┬──────────────┬─────────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ … ┆ expected_1 ┆ expected_2 ┆ ae_expected_ ┆ ae_expected │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆   ┆ ---        ┆ ---        ┆ 1            ┆ _2          │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆   ┆ f64        ┆ f64        ┆ ---          ┆ ---         │\n│        ┆          ┆          ┆        ┆   ┆            ┆            ┆ f64          ┆ f64         │\n╞════════╪══════════╪══════════╪════════╪═══╪════════════╪════════════╪══════════════╪═════════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ … ┆ 0.005      ┆ 0.03       ┆ 1.450813     ┆ 0.241802    │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ … ┆ 0.005      ┆ 0.015      ┆ 0.797752     ┆ 0.265917    │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ … ┆ 0.007778   ┆ 0.03       ┆ 1.665336     ┆ 0.431754    │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ … ┆ 0.007778   ┆ 0.015      ┆ 0.823868     ┆ 0.427191    │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ … ┆ 0.010556   ┆ 0.03       ┆ 0.984559     ┆ 0.346419    │\n│ …      ┆ …        ┆ …        ┆ …      ┆ … ┆ …          ┆ …          ┆ …            ┆ …           │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.877242     ┆ 2.924141    │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ … ┆ 0.05       ┆ 0.03       ┆ 2.513115     ┆ 4.188525    │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.952043     ┆ 3.173475    │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ … ┆ 0.05       ┆ 0.03       ┆ 2.160699     ┆ 3.601165    │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.92722      ┆ 3.090735    │\n└────────┴──────────┴──────────┴────────┴───┴────────────┴────────────┴──────────────┴─────────────┘\n\n\nCreate visualizations using the plot() and table() methods.\n\nexp_res.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n# first 10 rows showed for brevity\nexp_res.table()\n\n\n\n\nLaunch a shiny app to interactively explore experience data.\n\nexposed_data.exp_shiny()\n\n\n Logo\nImage by macrovector on Freepik"
  },
  {
    "objectID": "articles/visualizations.html",
    "href": "articles/visualizations.html",
    "title": "Data visualizations",
    "section": "",
    "text": "This article describes the data visualization functions available in the actxps package."
  },
  {
    "objectID": "articles/visualizations.html#plotting-termination-studies",
    "href": "articles/visualizations.html#plotting-termination-studies",
    "title": "Data visualizations",
    "section": "Plotting termination studies",
    "text": "Plotting termination studies\nBefore we start plotting, we need to create experience study data. The examples below use the simulated census_dat and withdrawals data sets that come with the actxps package. First, exposure records are created using ExposedDF(). Then, illustrative expected values and withdrawal transactions are added to the data.\n\nimport actxps as xp\nimport polars as pl\nimport numpy as np\n\n# create exposure records\ncensus_dat = xp.load_census_dat()\nexposed_data = xp.ExposedDF(census_dat, end_date=\"2019-12-31\",\n                            target_status=\"Surrender\")\n\n# add expected values\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10),\n                                 [.2, .15], np.repeat(0.05, 3)))\n\nexposed_data.data = exposed_data.data.with_columns(\n    expected_1=expected_table[exposed_data.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\n# add transactions\nwithdrawals = xp.load_withdrawals()\nexposed_data.add_transactions(withdrawals)\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (141_252, 21)\n┌─────────┬────────┬────────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ trx_n_Base ┆ trx_n_Ride ┆ trx_amt_Ba ┆ trx_amt_Ri │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---        ┆ r          ┆ se         ┆ der        │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ i32        ┆ ---        ┆ ---        ┆ ---        │\n│         ┆        ┆            ┆          ┆   ┆            ┆ i32        ┆ f64        ┆ f64        │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 547.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 106.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 31.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 75.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 466.0      │\n└─────────┴────────┴────────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘\n\n\n\nExpStats.plot()\nThe actxps package provides a plot() method for ExpStats objects.\nBelow, an ExpStats object is created using exp_stats().\n\nexp_res = (exposed_data.\n           group_by('pol_yr').\n           exp_stats(conf_int=True))\n\nThe default plot produced by ExpStats.plot() is a line plot of the observed termination rate (q_obs). The x variable corresponds to the first grouping variable of the ExpStats object3.\n\nexp_res.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nIf there is a second grouping variable, it is mapped onto color.\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats().\n    plot())\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nAny additional grouping variables beyond two are used to create facets.\n\nexp_res2 = (exposed_data. \n    group_by('pol_yr', 'product', 'inc_guar').\n    exp_stats())\n\nexp_res2.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nExpStats.plot() arguments\nThere are two means of overriding the default aesthetics selected by ExpStats.plot().\n\nThe x, y, color, and ... arguments can be passed column names to use as the x, y, color / fill, and faceting variables, respectively.\nThe mapping argument can be passed an aesthetic mapping using plotnine.aes(). If this argument is supplied, the x, y, and color arguments are ignored.\n\nLet’s assume we want to plot the number of claims instead of the termination rate, and we want inc_guar to be the color variable instead of product.\nUsing the y, color, and ... arguments, we could write:\n\nexp_res2.plot(y='claims', color='inc_guar', facets='product')\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nAlternatively, we could supply a mapping for more fine-grained control. Note that the example below adds an additional mapping for linetype which is otherwise unavailable under the defaults for ExpStats.plot().\n\nfrom plotnine import aes\n\nexp_res2.plot(mapping=aes(x='pol_yr', y='claims', color='inc_guar',\n                          linetype='inc_guar'),\n              facets='product')\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nThe ExpStats.plot() function defaults to percentages for y-axis labels. As seen in the immediately preceding example, this will not always be appropriate. The y_labels function can be used to pass a different labeling function.\n\nexp_res2.plot(mapping=aes(x='pol_yr', y='claims', color='inc_guar',\n                          linetype='inc_guar'),\n              y_labels=lambda l: [f\"{v:,.0f}\" for v in l],\n              facets='product')\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nTo set axis scales that vary by subplot, use the scales argument. This argument is subsequently forwarded to plotnine.facet_wrap(). Under the default value “fixed”, scales are identical across subplots. If “free_y” is passed as shown below, the y-scales will vary. If “free_x” is passed, the x-scales will vary. If “free” is passed, both the x- and y-scales will vary.\n\nexp_res2.plot(scales=\"free_y\")\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nThe geoms argument can be used to change the plotting geometry. Under the default value of “lines”, points and lines are displayed. If “bars” is passed, a bar plot will be drawn. If “points” is passed, a scatter plot will be drawn.\n\nexp_res.plot(geoms=\"bars\")\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nIf the y_log10 argument is set to True, the y-axis will be plotted on a logarithmic base ten scale.\n\nexp_res.plot(y_log10=True)\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nConfidence interval error bars can be added to a plot by passing conf_int_bars=True. Confidence intervals will only be displayed if they are available for the selected y variable.\n\nexp_res.plot(conf_int_bars=True)\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\nExpStats.plot_termination_rates()\nA limitation of ExpStats.plot() is that it doesn’t allow one to plot observed termination rates alongside one or more expected termination rates. This type of plot is common as an alternative to actual-to-expected ratio plots.\nThe plot_termination_rates() method produces a plot of the observed termination rates plus any expected termination rates that were passed to the expected argument of exp_stats().\nIn the example below, a new ExpStats object is created that contains two sets of expected surrender rates. This object is then passed into plot_termination_rates().\n\nexp_res3 = (exposed_data .\n            group_by('pol_yr').\n            exp_stats(expected=[\"expected_1\", \"expected_2\"], credibility=True))\n\nexp_res3.plot_termination_rates()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\nIn the plot above, termination rates are mapped to the y variable and the Series variable specifies a color scale. Similar to ExpStats.plot(), the x variable is the first grouping variable (here, pol_yr).\nIf the ExpStats object contains credibility-weighted termination rates4, these rates can be included in the plot using the argument include_cred_adj=True.\n\nexp_res3.plot_termination_rates(include_cred_adj=True)\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\nplot_actual_to_expected()\nThe plot_actual_to_expected() function is similar to plot_termination_rates() except that all actual-to-expected ratios are plotted on the y-axis instead.\n\nexp_res3.plot_actual_to_expected()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\nRelationship of ExpStats.plot_termination_rates() and ExpStats.plot_actual_to_expected() to ExpStats.plot()\nBehind the scenes, plot_termination_rates() and plot_actual_to_expected() call plot() after reshaping the ExpStats object. As such, all arguments passed to ExpStats.plot() described above can also be passed to these functions. However, there is an exception: the y variable is reserved and cannot be modified. In addition, while the color variable can be overridden, this is discouraged because it may result in odd-looking plots.\nSince these functions automatically create a color variable, any grouping variables beyond the first are used to create facets. This differs from ExpStats.plot() which uses grouping variables beyond the second to create facets"
  },
  {
    "objectID": "articles/visualizations.html#plotting-transaction-studies",
    "href": "articles/visualizations.html#plotting-transaction-studies",
    "title": "Data visualizations",
    "section": "Plotting transaction studies",
    "text": "Plotting transaction studies\nThe actxps package also provides a plot() method for TrxStats objects. The TrxStats.plot() method has the same arguments as ExpStats.plot(), so all options described in the previous section can be used for transaction studies as well.\nThe y variable defaults to the observed transaction frequency (trx_util). Like ExpStats.plot(), any numeric column can be mapped onto the y-axis using the y or mapping arguments.\nUnder the defaults, TrxStats.plot() handles grouping variables the same as ExpStats.plot():\n\nThe first grouping variable is mapped onto x\nThe second grouping variable is mapped onto color\nAny additional grouping variables are used to create subplots\n\nIn addition to the above, facets are also created for each transaction type found in the data.\n\ntrx_res = (exposed_data .\n           group_by('pol_yr', 'inc_guar').\n           trx_stats(percent_of=\"premium\"))\n\ntrx_res.plot(y='pct_of_premium_all')\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\nTrxStats.plot_utilization_rates()\nThe plot_utilization_rates() function creates a side-by-side view of both transaction frequency and severity. This type of plot is useful for answering questions like, “what percentage of customers are taking withdrawals each quarter, and of those taking withdrawals, what is the average percentage of account value taken out?”.\nTransaction frequency is represented by utilization rates (trx_util). Severity is represented by transaction amounts as a percentage of one or more other columns in the data. All severity series begin with the prefix pct_of_ and end with the suffix _w_trx. The suffix refers to the fact that the denominator only includes records with non-zero transactions. Severity series are automatically selected based on column names passed to the percent_of argument in trx_stats(). If no “percentage of” columns exist, this function will only plot utilization rates.\nLike plot_termination_rates() and plot_actual_to_expected(), this function calls plot() after reshaping the data. All arguments passed to TrxStats.plot() can be utilized by this function except y and scales. The y argument is reserved for utilization rates, and the scales argument is preset to allow differing scales between the frequency and severity subplots.\n\ntrx_res.plot_utilization_rates()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;"
  },
  {
    "objectID": "articles/visualizations.html#tables",
    "href": "articles/visualizations.html#tables",
    "title": "Data visualizations",
    "section": "Tables",
    "text": "Tables\nThe table() method creates summary tables of termination or transaction study results. This method is available for ExpStats and TrxStats objects.\n\nTermination study output example\n\n\n\n\n\nTransaction study output example\n\n\n\nArguments:\n\nfontsize is a multiple that increases or decreases the font size. Values less than 100 decrease the font size, and values greater than 100 increase the font size.\ndecimals controls the number of decimal places displayed for percentage columns (default=1)\nIf colorful is True, conditional color formatting will be added to the table.\n\nFor termination studies, color_q_obs and color_ae_ specify the color palettes used for observed termination rates and actual-to-expected ratios, respectively.\nFor transaction studies, color_util and color_pct_of specify the color palettes used for utilization rates and “percentage of” columns, respectively.\n\nThese inputs must be strings referencing a Matplotlib colormap. For a full list of available palettes, see matplotlob.colormaps.\n**rename_cols can be used to relabel columns. Names are equal to original column names and values equal the desired column labels. Most of the column names created by table() are presentation-ready, however, grouping variables on the left side of the table may require updates since they default to the variable names that appear in the data.\nshow_conf_int and show_cred_adj can be used to include any confidence intervals and credibility-weighted termination rates, if available. As a default, these columns are not included to avoid producing overcrowded tables."
  },
  {
    "objectID": "articles/visualizations.html#interactive-shiny-app",
    "href": "articles/visualizations.html#interactive-shiny-app",
    "title": "Data visualizations",
    "section": "Interactive Shiny app",
    "text": "Interactive Shiny app\nExposedDF.exp_shiny() is a powerful method that launches an interactive Shiny app containing filters, grouping variables, plots produced by plot(), tables produced by table(), and exporting capabilities.\nThe left sidebar of the app contains filtering widgets organized by data type for all variables passed to the predictors argument. If predictors is not specified, all columns in the data except policy numbers, statuses, termination dates, exposures, and transaction columns will be used. The type of widget will vary depending on the data type and number of unique values in each predictor.\nAt the top of the sidebar, information is shown on the percentage of records remaining after applying filters. A text description of all active filters is also provided.\nThe top of the sidebar also includes a “play / pause” switch that can pause reactivity of the app. Pausing is a good option when multiple changes are made in quick succession, especially when the underlying data set is large.\nThe “Grouping variables” box includes widgets to select grouping variables for summarizing experience. The “x” widget determines the x variable in the plot output. Similarly, the “Color” and “Facets” widgets are used for color and facets. Multiple faceting variable selections are allowed. For the table output, “x”, “Color”, and “Facets” have no particular meaning beyond the order in which grouping variables are displayed.\nThe “Study type” box will always include a tab for termination studies. If transactions are attached to the ExposedDF object5, an additional section will be displayed for transaction studies.\n\nTermination study options include the ability to activate and deactivate expected values and the selection of an optional numeric weighting variable for claims and exposures. Available expected value choices are dictated by the expected argument. If this argument is not specified, any columns containing the word “expected” are assumed to be expected values.\nTransaction study options include the ability to activate and deactivate transaction types, optional numeric columns to use in “percentage of” statistics, and an option to lump all transaction types into a single category.\n\nThe output section includes tabs for plots, tables, and exporting results.\nThe plot tab includes a plot and various options for customization:\n\ny: y variable\nGeometry: plotting geometry - bars, points and lines, or points only\nAdd Smoothing: plots smooth loess curves\nConfidence intervals: If available, add confidence intervals error bars for around the selected y variable\nFree y Scales: enables separate y scales in each plot\nLog y-axis: plots all y-axes on a log-10 scale\nThe gear icon above the plot contains a pop-up menu for updating the size of the plot.\n\nThe table tab includes the table itself plus a pop-up menu for changing the table’s appearance:\n\nThe “Confidence intervals” and “Credibility-weighted termination rates” switches add these outputs to the table. These values are hidden as a default to prevent over-crowding.\nThe “Include color scales” switch disables or re-enables conditional color formatting.\nThe “Decimals” slider controls the number of decimals displayed for percentage fields.\nThe “Font size multiple” slider impacts the table’s font size\n\nThe export pop-up menu contains options for saving summarized experience data or the plot. Data is saved as a CSV file. The plot is saved as a png file.\n\nOther arguments\n\ndistinct_max: an upper limit on the number of distinct values a variable is allowed to have to be included as a viable option for the color and facets grouping variables. Default=25.\ntitle: an optional title for the app\ncredibility, conf_level, cred_r: credibility options for termination studies. See exp_stats() for more information. Limited fluctuation credibility estimates at a 95% confidence within 5% of the theoretical mean assuming a binomial distribution are used as a default.\nThe conf_level argument is also used for confidence intervals for both termination and transaction studies.\nbootswatch_theme: replace the default theme of the app by passing the name of a preset bootswatch theme."
  },
  {
    "objectID": "articles/visualizations.html#footnotes",
    "href": "articles/visualizations.html#footnotes",
    "title": "Data visualizations",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nExpStats objects are created by ExposedDF.exp_stats() see Experience summaries for more information↩︎\nTrxStats objects are created by ExposedDF.trx_stats() see Transactions for more information↩︎\nIf there are no grouping variables, a single point is plotted↩︎\nSee the credibility argument of exp_stats() for more information↩︎\nSee add_transactions() for information on attaching transactions to an ExposedDF object.↩︎"
  },
  {
    "objectID": "articles/misc.html",
    "href": "articles/misc.html",
    "title": "Other functions",
    "section": "",
    "text": "This article features functions that are not covered in other articles.\nimport actxps as xp\nimport polars as pl\nfrom datetime import date"
  },
  {
    "objectID": "articles/misc.html#working-with-aggregate-experience-data",
    "href": "articles/misc.html#working-with-aggregate-experience-data",
    "title": "Other functions",
    "section": "Working with aggregate experience data",
    "text": "Working with aggregate experience data\nSeriatim-level policy experience data is often not available for analysis. This is almost always the case with industry studies that contain experience data submitted by multiple parties. In these cases, experience is grouped by a several common policy attributes and aggregated accordingly.\nThe typical workflow in actxps of ExposedDF().exp_stats() for termination studies or ExposedDF().add_transactions().trx_stats() for transaction studies doesn’t apply if the starting data is aggregated. That is because another party has already gone through the steps of creating exposure records and performing an initial level of aggregation.\nActxps provides two functions designed to work with aggregate experience data.\n\nFor termination studies, ExpStats.from_DataFrame() converts a data frame of aggregate experience into an ExpStats object. = For transaction studies, TrxStats.from_DataFrame() converts a data frame of aggregate experience into a TrxStats object.\n\nBoth object classes have a summary() method which summarizes experience across any grouping variables passed to the function. The output of summary() will always be another ExpStats (or TrxStats) object, and will look just like the results of exp_stats() (or trx_stats()). For downstream reporting, summary results can be passed to the visualization methods plot() and table().\nThe agg_sim_dat data set contains aggregate experience on a theoretical block of deferred annuity contracts. Below, ExpStats.from_DataFrame() is used to convert the data to an ExpStats, and summary() is called using multiple grouping variables.\n\nagg_sim_dat = xp.load_agg_sim_dat()\nagg_sim_ExpStats = xp.ExpStats.from_DataFrame(\n    agg_sim_dat,\n    col_exposure=\"exposure_n\",\n    col_claims=\"claims_n\",\n    conf_int=True,\n    start_date=2005,\n    end_date=2019,\n    target_status=\"Surrender\")\n\nResults summarized by policy year\n\nagg_sim_ExpStats.summary('pol_yr')\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender\nStudy range: 2005 to 2019\n\nshape: (15, 7)\n┌────────┬──────────┬────────┬──────────────┬──────────┬─────────────┬─────────────┐\n│ pol_yr ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    ┆ q_obs_lower ┆ q_obs_upper │\n│ ---    ┆ ---      ┆ ---    ┆ ---          ┆ ---      ┆ ---         ┆ ---         │\n│ i64    ┆ i64      ┆ i64    ┆ f64          ┆ f64      ┆ f64         ┆ f64         │\n╞════════╪══════════╪════════╪══════════════╪══════════╪═════════════╪═════════════╡\n│ 1      ┆ 102      ┆ 102    ┆ 19252.212366 ┆ 0.005298 ┆ 0.004311    ┆ 0.006337    │\n│ 2      ┆ 160      ┆ 160    ┆ 17714.780418 ┆ 0.009032 ┆ 0.007677    ┆ 0.010443    │\n│ 3      ┆ 124      ┆ 124    ┆ 16097.137376 ┆ 0.007703 ┆ 0.006399    ┆ 0.00907     │\n│ 4      ┆ 168      ┆ 168    ┆ 14535.852953 ┆ 0.011558 ┆ 0.009838    ┆ 0.013346    │\n│ 5      ┆ 164      ┆ 164    ┆ 12915.526244 ┆ 0.012698 ┆ 0.01084     ┆ 0.014634    │\n│ …      ┆ …        ┆ …      ┆ …            ┆ …        ┆ …           ┆ …           │\n│ 11     ┆ 804      ┆ 804    ┆ 4390.402949  ┆ 0.183127 ┆ 0.171738    ┆ 0.194515    │\n│ 12     ┆ 330      ┆ 330    ┆ 2663.379931  ┆ 0.123903 ┆ 0.111512    ┆ 0.136668    │\n│ 13     ┆ 99       ┆ 99     ┆ 1619.90935   ┆ 0.061115 ┆ 0.050003    ┆ 0.072844    │\n│ 14     ┆ 62       ┆ 62     ┆ 871.838738   ┆ 0.071114 ┆ 0.055056    ┆ 0.088319    │\n│ 15     ┆ 17       ┆ 17     ┆ 268.178711   ┆ 0.063391 ┆ 0.037289    ┆ 0.093221    │\n└────────┴──────────┴────────┴──────────────┴──────────┴─────────────┴─────────────┘\n\n\nResults summarized by income guarantee presence and product\n\nagg_sim_ExpStats.summary('inc_guar', 'product')\n\nExperience study results\n\nGroups: inc_guar, product\nTarget status: Surrender\nStudy range: 2005 to 2019\n\nshape: (6, 8)\n┌──────────┬─────────┬──────────┬────────┬──────────────┬──────────┬─────────────┬─────────────┐\n│ inc_guar ┆ product ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    ┆ q_obs_lower ┆ q_obs_upper │\n│ ---      ┆ ---     ┆ ---      ┆ ---    ┆ ---          ┆ ---      ┆ ---         ┆ ---         │\n│ bool     ┆ cat     ┆ i64      ┆ i64    ┆ f64          ┆ f64      ┆ f64         ┆ f64         │\n╞══════════╪═════════╪══════════╪════════╪══════════════╪══════════╪═════════════╪═════════════╡\n│ false    ┆ a       ┆ 449      ┆ 449    ┆ 12738.212621 ┆ 0.035248 ┆ 0.032108    ┆ 0.038467    │\n│ false    ┆ b       ┆ 392      ┆ 392    ┆ 13489.708578 ┆ 0.029059 ┆ 0.026242    ┆ 0.03195     │\n│ false    ┆ c       ┆ 760      ┆ 760    ┆ 25895.314881 ┆ 0.029349 ┆ 0.027302    ┆ 0.031434    │\n│ true     ┆ a       ┆ 361      ┆ 361    ┆ 19966.02882  ┆ 0.018081 ┆ 0.016278    ┆ 0.019934    │\n│ true     ┆ b       ┆ 273      ┆ 273    ┆ 19694.192761 ┆ 0.013862 ┆ 0.012237    ┆ 0.015538    │\n│ true     ┆ c       ┆ 634      ┆ 634    ┆ 40850.51051  ┆ 0.01552  ┆ 0.014345    ┆ 0.016719    │\n└──────────┴─────────┴──────────┴────────┴──────────────┴──────────┴─────────────┴─────────────┘\n\n\nExpStats.from_DataFrame() and TrxStats.from_DataFrame() contain several arguments for optional calculations like confidence intervals, expected values, weighting variables, and more. These arguments mirror the functionality in exp_stats() and trx_stats(). Both functions also contain multiple arguments for specifying column names associated with required values like exposures and claims."
  },
  {
    "objectID": "articles/misc.html#policy-duration-functions",
    "href": "articles/misc.html#policy-duration-functions",
    "title": "Other functions",
    "section": "Policy duration functions",
    "text": "Policy duration functions\nThe pol_*() family of functions calculates policy years, months, quarters, or weeks. Each function accepts strings, single dates, or Polars series of dates and issue dates.\nExample: assume a policy was issued on 2022-05-10 and we are interested in calculating various policy duration values at the end of calendar years 2022-2032.\n\ndates = pl.date_range(\n    date(2022, 12, 31),\n    date(2033, 12, 31),\n    interval = '1y', \n    eager=True)\n\n# policy years\nxp.pol_yr(dates, \"2022-05-10\")\n\n\nshape: (12,)\n\n\n\n\n\n\nu32\n\n\n\n\n1\n\n\n2\n\n\n3\n\n\n4\n\n\n5\n\n\n6\n\n\n7\n\n\n8\n\n\n9\n\n\n10\n\n\n11\n\n\n12\n\n\n\n\n\n\n\n# policy quarters\nxp.pol_qtr(dates, \"2022-05-10\")\n\n\nshape: (12,)\n\n\n\n\n\n\nu32\n\n\n\n\n3\n\n\n7\n\n\n11\n\n\n15\n\n\n19\n\n\n23\n\n\n27\n\n\n31\n\n\n35\n\n\n39\n\n\n43\n\n\n47\n\n\n\n\n\n\n\n# policy months\nxp.pol_mth(dates, \"2022-05-10\")\n\n\nshape: (12,)\n\n\n\n\n\n\nu32\n\n\n\n\n8\n\n\n20\n\n\n32\n\n\n44\n\n\n56\n\n\n68\n\n\n80\n\n\n92\n\n\n104\n\n\n116\n\n\n128\n\n\n140\n\n\n\n\n\n\n\n# policy weeks\nxp.pol_wk(dates, \"2022-05-10\")\n\n\nshape: (12,)\n\n\n\n\n\n\nu32\n\n\n\n\n34\n\n\n86\n\n\n139\n\n\n191\n\n\n243\n\n\n295\n\n\n347\n\n\n399\n\n\n452\n\n\n504\n\n\n556\n\n\n608"
  },
  {
    "objectID": "articles/misc.html#fractional-period-functions",
    "href": "articles/misc.html#fractional-period-functions",
    "title": "Other functions",
    "section": "Fractional period functions",
    "text": "Fractional period functions\nThe frac_*() family of functions calculates the fractional number of years, months, quarters, or weeks between two sets of dates. Similar to the pol_*() functions, strings, single dates, or Polars series are accepted.\nExample: Continuing from the previous example, fractional durations from an issue date of 2022-05-10 can be calculated as follows:\n\nxp.frac_yr(\"2022-05-10\", dates)\n\n\nshape: (12,)\n\n\n\n\n\n\nf64\n\n\n\n\n0.643836\n\n\n1.642077\n\n\n2.643836\n\n\n3.643836\n\n\n4.643836\n\n\n5.642077\n\n\n6.643836\n\n\n7.643836\n\n\n8.643836\n\n\n9.642077\n\n\n10.643836\n\n\n11.643836\n\n\n\n\n\n\n\nxp.frac_qtr(\"2022-05-10\", dates)\n\n\nshape: (12,)\n\n\n\n\n\n\nf64\n\n\n\n\n2.554348\n\n\n6.554348\n\n\n10.554348\n\n\n14.554348\n\n\n18.554348\n\n\n22.554348\n\n\n26.554348\n\n\n30.554348\n\n\n34.554348\n\n\n38.554348\n\n\n42.554348\n\n\n46.554348\n\n\n\n\n\n\n\nxp.frac_mth(\"2022-05-10\", dates)\n\n\nshape: (12,)\n\n\n\n\n\n\nf64\n\n\n\n\n7.677419\n\n\n19.677419\n\n\n31.677419\n\n\n43.677419\n\n\n55.677419\n\n\n67.677419\n\n\n79.677419\n\n\n91.677419\n\n\n103.677419\n\n\n115.677419\n\n\n127.677419\n\n\n139.677419\n\n\n\n\n\n\n\nxp.frac_wk(\"2022-05-10\", dates)\n\n\nshape: (12,)\n\n\n\nliteral\n\n\nf64\n\n\n\n\n33.571429\n\n\n85.714286\n\n\n138.0\n\n\n190.142857\n\n\n242.285714\n\n\n294.428571\n\n\n346.714286\n\n\n398.857143\n\n\n451.0\n\n\n503.142857\n\n\n555.428571\n\n\n607.571429"
  },
  {
    "objectID": "articles/exposures.html",
    "href": "articles/exposures.html",
    "title": "Exposure calculations",
    "section": "",
    "text": "Census-level data refers to a data set wherein there is one row per policy. Exposure-level data expands census-level data such that there is one record per policy per observation period. Observation periods could be any meaningful period of time such as a policy year, policy month, calendar year, calendar quarter, calendar month, etc.\nA common step in experience studies is converting census-level data into exposure-level data. The ExposedDF class performs this task. Specifically, this class:\nIf you already have exposure-level data available, the class method ExposedDF.from_DataFrame() can be used to convert a data frame into an ExposedDF object."
  },
  {
    "objectID": "articles/exposures.html#toy-census-data",
    "href": "articles/exposures.html#toy-census-data",
    "title": "Exposure calculations",
    "section": "Toy census data",
    "text": "Toy census data\nTo get started, we’re going to use a toy census data frame from the actxps package that contains 3 policies: one active, one that terminated due to death, and one that terminated due to surrender.\ntoy_census contains the 4 columns necessary to compute exposures:\n\npol_num: a unique identifier for individual policies\nstatus: the policy status\nissue_date: issue date\nterm_date: termination date, if any. Otherwise NA\n\n\nimport actxps as xp\nimport polars as pl\n\ntoy_census = xp.load_toy_census()\ntoy_census\n\n\nshape: (3, 4)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\n\n\ni64\ncat\ndate\ndate\n\n\n\n\n1\n\"Active\"\n2010-01-01\nnull\n\n\n2\n\"Death\"\n2011-05-27\n2020-09-14\n\n\n3\n\"Surrender\"\n2009-11-10\n2022-02-25\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\ntoy_census is a Polars data frame. Actxps functions accept both Polars and Pandas data frames. For speed and efficiency reasons, Polars is used internally for all data wrangling, so if a Pandas data frame is passed to an actxps function it will be converted to Polars. To convert a Polars data frame to Pandas the method DataFrame.to_pandas() is available."
  },
  {
    "objectID": "articles/exposures.html#policy-year-exposures",
    "href": "articles/exposures.html#policy-year-exposures",
    "title": "Exposure calculations",
    "section": "Policy year exposures",
    "text": "Policy year exposures\nLet’s assume we’re performing an experience study as of 2022-12-31 and we’re interested in policy year exposures. Here’s what we should expect for our 3 policies.\n\nPolicy 1 was issued on January 1, 2010 and has not terminated. Therefore we expect 13 exposure years.\nPolicy 2 was issued on May 27, 2011 and was terminated in 2020 due to death. The death occurred after the 9th policy anniversary, therefore we expect 9 fully exposed years and a partial exposure in the 10th year.\nPolicy 3 was issued on November 10, 2009 and was terminated in 2022 due to surrender. The surrender occurred after the 12th policy anniversary, therefore we expect 12 fully exposed years and a partial exposure in the 13th year.\n\nTo calculate exposures, we pass our data to ExposedDF() and we specify a study end_date.\n\nexposed_data = xp.ExposedDF(toy_census, end_date=\"2022-12-31\")\n\nThis creates a new ExposedDF object, which contains a data property and additional attributes related to the experience study.\nLet’s examine what happened to each policy.\nPolicy 1: As expected, there are 13 rows for this policy. New columns were added for the policy year (pol_yr), date ranges (pol_date_yr, pol_date_yr_end), and exposure. All exposures are 100% since this policy was active for all 13 years.\nWhen the data is printed, additional attributes from the ExposedDF class are displayed.\n\nexposed_data.data.filter(pl.col('pol_num') == 1)\n\n\nshape: (13, 8)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\npol_yr\npol_date_yr\npol_date_yr_end\nexposure\n\n\ni64\nenum\ndate\ndate\nu32\ndate\ndate\nf64\n\n\n\n\n1\n\"Active\"\n2010-01-01\nnull\n1\n2010-01-01\n2010-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n2\n2011-01-01\n2011-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n3\n2012-01-01\n2012-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n4\n2013-01-01\n2013-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n5\n2014-01-01\n2014-12-31\n1.0\n\n\n…\n…\n…\n…\n…\n…\n…\n…\n\n\n1\n\"Active\"\n2010-01-01\nnull\n9\n2018-01-01\n2018-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n10\n2019-01-01\n2019-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n11\n2020-01-01\n2020-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n12\n2021-01-01\n2021-12-31\n1.0\n\n\n1\n\"Active\"\n2010-01-01\nnull\n13\n2022-01-01\n2022-12-31\n1.0\n\n\n\n\n\n\nPolicy 2: There are 10 rows for this policy. The first 9 periods show the policy in an active status and the termination date (term_date) is set to NA. The last period includes the final status of “Death” and the actual termination date. The last exposure is less than one because roughly a third of a year elapsed between the last anniversary date on 2020-05-27 and the termination date on 2020-09-14.\n\nexposed_data.data.filter(pl.col('pol_num') == 2)\n\n\nshape: (10, 8)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\npol_yr\npol_date_yr\npol_date_yr_end\nexposure\n\n\ni64\nenum\ndate\ndate\nu32\ndate\ndate\nf64\n\n\n\n\n2\n\"Active\"\n2011-05-27\nnull\n1\n2011-05-27\n2012-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2\n2012-05-27\n2013-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n3\n2013-05-27\n2014-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n4\n2014-05-27\n2015-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n5\n2015-05-27\n2016-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n6\n2016-05-27\n2017-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n7\n2017-05-27\n2018-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n8\n2018-05-27\n2019-05-26\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n9\n2019-05-27\n2020-05-26\n1.0\n\n\n2\n\"Death\"\n2011-05-27\n2020-09-14\n10\n2020-05-27\n2021-05-26\n0.30411\n\n\n\n\n\n\nPolicy 3: There are 13 rows for this policy. The first 12 periods show the policy in an active status and the termination date (term_date) is set to NA. The last period includes the final status of “Surrender” and the actual termination date. The last exposure is less than one because the roughly a third of a year elapsed between the last anniversary date on 2021-11-10 and the termination date on 2022-02-25.\n\nexposed_data.data.filter(pl.col('pol_num') == 3)\n\n\nshape: (13, 8)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\npol_yr\npol_date_yr\npol_date_yr_end\nexposure\n\n\ni64\nenum\ndate\ndate\nu32\ndate\ndate\nf64\n\n\n\n\n3\n\"Active\"\n2009-11-10\nnull\n1\n2009-11-10\n2010-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n2\n2010-11-10\n2011-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n3\n2011-11-10\n2012-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n4\n2012-11-10\n2013-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n5\n2013-11-10\n2014-11-09\n1.0\n\n\n…\n…\n…\n…\n…\n…\n…\n…\n\n\n3\n\"Active\"\n2009-11-10\nnull\n9\n2017-11-10\n2018-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n10\n2018-11-10\n2019-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n11\n2019-11-10\n2020-11-09\n1.0\n\n\n3\n\"Active\"\n2009-11-10\nnull\n12\n2020-11-10\n2021-11-09\n1.0\n\n\n3\n\"Surrender\"\n2009-11-10\n2022-02-25\n13\n2021-11-10\n2022-11-09\n0.29589\n\n\n\n\n\n\n\nStudy start date\nThe previous section only supplied data and a study end_date to ExposedDF(). This is the minimum required arguments for the function. Optionally, a start_date can be supplied that will drop exposure periods that begin before a specified date.\n\nxp.ExposedDF(toy_census, end_date=\"2022-12-31\", start_date=\"2019-12-31\")\n\nExposure data\n\nExposure type: policy_year\nTarget status: None\nStudy range: 2019-12-31 to 2022-12-31\n\nshape: (6, 8)\n┌─────────┬───────────┬────────────┬────────────┬────────┬─────────────┬────────────────┬──────────┐\n│ pol_num ┆ status    ┆ issue_date ┆ term_date  ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_en ┆ exposure │\n│ ---     ┆ ---       ┆ ---        ┆ ---        ┆ ---    ┆ ---         ┆ d              ┆ ---      │\n│ i64     ┆ enum      ┆ date       ┆ date       ┆ u32    ┆ date        ┆ ---            ┆ f64      │\n│         ┆           ┆            ┆            ┆        ┆             ┆ date           ┆          │\n╞═════════╪═══════════╪════════════╪════════════╪════════╪═════════════╪════════════════╪══════════╡\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ 11     ┆ 2020-01-01  ┆ 2020-12-31     ┆ 1.0      │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ 12     ┆ 2021-01-01  ┆ 2021-12-31     ┆ 1.0      │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ 13     ┆ 2022-01-01  ┆ 2022-12-31     ┆ 1.0      │\n│ 2       ┆ Death     ┆ 2011-05-27 ┆ 2020-09-14 ┆ 10     ┆ 2020-05-27  ┆ 2021-05-26     ┆ 0.30411  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ 12     ┆ 2020-11-10  ┆ 2021-11-09     ┆ 1.0      │\n│ 3       ┆ Surrender ┆ 2009-11-10 ┆ 2022-02-25 ┆ 13     ┆ 2021-11-10  ┆ 2022-11-09     ┆ 0.29589  │\n└─────────┴───────────┴────────────┴────────────┴────────┴─────────────┴────────────────┴──────────┘\n\n\n\n\nTarget status\nMost experience studies use the annual exposure method which allocates a full period of exposure for the particular termination event of interest in the scope of the study.\nThe intuition for this approach is simple: let’s assume we have an unrealistically small study with a single data point for one policy over the course of one year. Let’s assume that policy terminated due to surrender half way through the year.\nIf we don’t apply the annual exposure method, we would calculate a termination rate as:\n\\[\nq^{surr} = \\frac{claims}{exposures} = \\frac{1}{0.5} = 200\\%\n\\]\nA termination rate of 200% doesn’t make any sense. Under the annual exposure method we would see a rate of 100%, which is intuitive.\n\\[\nq^{surr} = \\frac{claims}{exposures} = \\frac{1}{1} = 100\\%\n\\]\nThe annual exposure method can be applied by passing a character vector of target statuses to the ExposedDF() class.\nLet’s assume we are performing a surrender study.\n\nexposed_data2 = xp.ExposedDF(toy_census, end_date=\"2022-12-31\",\n                             target_status=\"Surrender\")\n\nNow let’s verify that the exposure on the surrendered policy increased to 100% in the last exposure period.\n\nexposed_data2.data.group_by('pol_num').tail(1)\n\n\nshape: (3, 8)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\npol_yr\npol_date_yr\npol_date_yr_end\nexposure\n\n\ni64\nenum\ndate\ndate\nu32\ndate\ndate\nf64\n\n\n\n\n1\n\"Active\"\n2010-01-01\nnull\n13\n2022-01-01\n2022-12-31\n1.0\n\n\n3\n\"Surrender\"\n2009-11-10\n2022-02-25\n13\n2021-11-10\n2022-11-09\n1.0\n\n\n2\n\"Death\"\n2011-05-27\n2020-09-14\n10\n2020-05-27\n2021-05-26\n0.30411"
  },
  {
    "objectID": "articles/exposures.html#other-exposure-periods",
    "href": "articles/exposures.html#other-exposure-periods",
    "title": "Exposure calculations",
    "section": "Other exposure periods",
    "text": "Other exposure periods\nThe default exposure basis used by ExposedDF() is policy years. Using the arguments cal_expo and expo_length other exposure periods can be used.\n\nCalendar years\nIf cal_expo is set to True, calendar year exposures will be calculated.\nLooking at the second policy, we can see that the first year is left-censored because the policy was issued two-fifths of the way through the year, and the last period is right-censored because the policy terminated roughly seven-tenths of the way through the year.\n\nexposed_cal = xp.ExposedDF(toy_census, end_date=\"2022-12-31\",\n                           cal_expo=True, target_status=\"Surrender\")\n\nexposed_cal.data.filter(pl.col('pol_num') == 2)\n\n\nshape: (10, 7)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\ncal_yr\ncal_yr_end\nexposure\n\n\ni64\nenum\ndate\ndate\ndate\ndate\nf64\n\n\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2011-01-01\n2011-12-31\n0.6\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2012-01-01\n2012-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2013-01-01\n2013-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2014-01-01\n2014-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2015-01-01\n2015-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2016-01-01\n2016-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2017-01-01\n2017-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2018-01-01\n2018-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2019-01-01\n2019-12-31\n1.0\n\n\n2\n\"Death\"\n2011-05-27\n2020-09-14\n2020-01-01\n2020-12-31\n0.704918\n\n\n\n\n\n\n\n\nQuarters, months, and weeks\nThe length of the exposure period can be decreased by passing \"quarter\", \"month\", or \"week\" to the expo_length argument. This can be used with policy or calendar-based exposures.\n\n(xp.ExposedDF(toy_census, end_date=\"2022-12-31\", cal_expo=True,\n              expo_length=\"quarter\", target_status=\"Surrender\").\n              data.filter(pl.col('pol_num') == 2))\n\n\nshape: (38, 7)\n\n\n\npol_num\nstatus\nissue_date\nterm_date\ncal_qtr\ncal_qtr_end\nexposure\n\n\ni64\nenum\ndate\ndate\ndate\ndate\nf64\n\n\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2011-04-01\n2011-06-30\n0.384615\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2011-07-01\n2011-09-30\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2011-10-01\n2011-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2012-01-01\n2012-03-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2012-04-01\n2012-06-30\n1.0\n\n\n…\n…\n…\n…\n…\n…\n…\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2019-07-01\n2019-09-30\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2019-10-01\n2019-12-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2020-01-01\n2020-03-31\n1.0\n\n\n2\n\"Active\"\n2011-05-27\nnull\n2020-04-01\n2020-06-30\n1.0\n\n\n2\n\"Death\"\n2011-05-27\n2020-09-14\n2020-07-01\n2020-09-30\n0.826087\n\n\n\n\n\n\n\n\nConvenience functions\nThe following functions are class methods of ExposedDF() that target a specific exposure type without specifying cal_expo and expo_length.\n\nExposedDF.expose_py() = exposures by policy year\nExposedDF.expose_pq() = exposures by policy quarter\nExposedDF.expose_pm() = exposures by policy month\nExposedDF.expose_pw() = exposures by policy week\nExposedDF.expose_cy() = exposures by calendar year\nExposedDF.expose_cq() = exposures by calendar quarter\nExposedDF.expose_cm() = exposures by calendar month\nExposedDF.expose_cw() = exposures by calendar week"
  },
  {
    "objectID": "articles/exposures.html#split-exposures-by-calendar-period-and-policy-year",
    "href": "articles/exposures.html#split-exposures-by-calendar-period-and-policy-year",
    "title": "Exposure calculations",
    "section": "Split exposures by calendar period and policy year",
    "text": "Split exposures by calendar period and policy year\nA common technique used in experience studies is to split calendar years into two records: a pre-anniversary record and a post-anniversary record. In actxps, this can be accomplished using the expose_split() method.\nLet’s continue examining the second policy. exposed_cal, which contains calendar year exposures, is passed into expose_split(). The resulting data now contains 19 records instead of 10. There is one record for 2011 and 2 records for all other years. The year 2011 only has a single record because the policy was issued in this year, so there can only be a post-anniversary record.\n\nsplit = exposed_cal.expose_split()\n\n(split.data.\n filter(pl.col('pol_num') == 2).\n select('cal_yr', 'cal_yr_end', 'pol_yr', 'exposure_pol', 'exposure_cal'))\n\n\nshape: (19, 5)\n\n\n\ncal_yr\ncal_yr_end\npol_yr\nexposure_pol\nexposure_cal\n\n\ndate\ndate\ni32\nf64\nf64\n\n\n\n\n2011-05-27\n2011-12-31\n1\n0.598361\n0.6\n\n\n2012-01-01\n2012-05-26\n1\n0.401639\n0.401639\n\n\n2012-05-27\n2012-12-31\n2\n0.6\n0.598361\n\n\n2013-01-01\n2013-05-26\n2\n0.4\n0.4\n\n\n2013-05-27\n2013-12-31\n3\n0.6\n0.6\n\n\n…\n…\n…\n…\n…\n\n\n2018-05-27\n2018-12-31\n8\n0.6\n0.6\n\n\n2019-01-01\n2019-05-26\n8\n0.4\n0.4\n\n\n2019-05-27\n2019-12-31\n9\n0.598361\n0.6\n\n\n2020-01-01\n2020-05-26\n9\n0.401639\n0.401639\n\n\n2020-05-27\n2020-12-31\n10\n0.30411\n0.303279\n\n\n\n\n\n\nThe output of expose_split() contains two exposure columns.\n\nexposure_pol contains policy year exposures\nexposure_cal contains calendar year exposures\n\nThe two exposure bases will often not match for two reasons:\n\nCalendar years and policy years have different start and end dates that may or may not include a leap day. In the first row, the calendar year exposure is 0.6 years of the year 2011, which does not include a leap day. In the second row, the policy year exposure is 0.5984 years of the policy year spanning 2011-05-27 to 2012-05-26, which does include a leap day.\nApplication of the annual exposure method. If the termination event of interest appears on a post-anniversary record, policy exposures will be 1 and calendar exposures will be the fraction of the year spanning the anniversary to December 31st. Conversely, if the termination event of interest appears on a pre-anniversary record, calendar exposures will be 1 and policy exposures will be the fraction of the policy year from January 1st to the last day of the current policy year. While it may sound confusing at first, these rules are important to ensure that the termination event of interest always has an exposure of 1 when the data is grouped on a calendar year or policy year basis.\n\nSome downstream methods like exp_stats() expect ExposedDF objects to have a single column for exposures. For split exposures, the exposure basis must be specified using the col_exposure argument.\n\nsplit.exp_stats()\n\n\n\nA `SplitExposedDF` was passed without clarifying which exposure basis should be used to summarize results. Hint: Pass \"exposure_pol\" to `col_exposure` for policy year exposures pass \"exposure_cal\" to `col_exposure` for calendar exposures.\n\n\n\nsplit.exp_stats(col_exposure=\"exposure_pol\")\n\nExperience study results\n\nTarget status: Surrender\nStudy range: 1900-01-01 to 2022-12-31\n\nshape: (1, 4)\n┌──────────┬────────┬──────────┬──────────┐\n│ n_claims ┆ claims ┆ exposure ┆ q_obs    │\n│ ---      ┆ ---    ┆ ---      ┆ ---      │\n│ u32      ┆ u32    ┆ f64      ┆ f64      │\n╞══════════╪════════╪══════════╪══════════╡\n│ 1        ┆ 1      ┆ 35.30411 ┆ 0.028325 │\n└──────────┴────────┴──────────┴──────────┘\n\n\nexpose_split() doesn’t just work with calendar year exposures. Calendar quarters, months, or weeks can also be split. For periods shorter than a year, a record is only split into pre- and post-anniversary segments if a policy anniversary appears in the middle of the period.\n\n(xp.ExposedDF.expose_cq(toy_census, \"2022-12-31\",\n                        target_status=\"Surrender\").\n    expose_split().\n    data.filter(pl.col('pol_num') == 2).\n    select('cal_qtr', 'cal_qtr_end', 'pol_yr', 'exposure_pol', 'exposure_cal'))\n\n\nshape: (47, 5)\n\n\n\ncal_qtr\ncal_qtr_end\npol_yr\nexposure_pol\nexposure_cal\n\n\ndate\ndate\ni32\nf64\nf64\n\n\n\n\n2011-05-27\n2011-06-30\n1\n0.095628\n0.384615\n\n\n2011-07-01\n2011-09-30\n1\n0.251366\n1.0\n\n\n2011-10-01\n2011-12-31\n1\n0.251366\n1.0\n\n\n2012-01-01\n2012-03-31\n1\n0.248634\n1.0\n\n\n2012-04-01\n2012-05-26\n1\n0.153005\n0.615385\n\n\n…\n…\n…\n…\n…\n\n\n2019-10-01\n2019-12-31\n9\n0.251366\n1.0\n\n\n2020-01-01\n2020-03-31\n9\n0.248634\n1.0\n\n\n2020-04-01\n2020-05-26\n9\n0.153005\n0.615385\n\n\n2020-05-27\n2020-06-30\n10\n0.09589\n0.384615\n\n\n2020-07-01\n2020-09-30\n10\n0.30411\n1.206522\n\n\n\n\n\n\nNote, however, that calendar period exposures will always be expressed in the original units and policy exposures will always be expressed in years. Above, calendar exposures are quarters whereas policy exposures are years."
  },
  {
    "objectID": "articles/exposures.html#miscellaneous",
    "href": "articles/exposures.html#miscellaneous",
    "title": "Exposure calculations",
    "section": "Miscellaneous",
    "text": "Miscellaneous\n\nColumn names\nAs a default, ExposedDF() assumes the census data frame uses the following naming conventions:\n\nThe policy number column is called pol_num\nThe status column is called status\nThe issue date column is called issue_date\nThe termination date column is called term_date\n\nThese default names can be overridden using the col_pol_num, col_status, col_issue_date, and col_term_date arguments.\nFor example, if the policy number column was called id in our census-level data, we could write:\n\nxp.ExposedDF(toy_census, end_date=\"2022-12-31\", target_status=\"Surrender\",\n             col_pol_num=\"id\")\n\n\n\nTreatment of additional columns in the census data\nIf the census-level data contains other policy attributes like plan type or policy values, they will be broadcast across all exposure periods. Depending on the nature of the data, this may or may not be desirable. Constant policy attributes like plan type make sense to broadcast, but numeric values may or may not depending on the circumstances.\n\ntoy_census2 = toy_census.clone().with_columns(\n    plan_type=pl.Series([\"X\", \"Y\", \"Z\"]),\n    policy_value=pl.Series([100, 125, 90])\n)\n\n(xp.ExposedDF(toy_census2, end_date=\"2022-12-31\", target_status=\"Surrender\").\n     data.select('pol_num', 'status', 'pol_yr', 'exposure',\n                 'plan_type', 'policy_value'))\n\n\nshape: (36, 6)\n\n\n\npol_num\nstatus\npol_yr\nexposure\nplan_type\npolicy_value\n\n\ni64\nenum\nu32\nf64\nstr\ni64\n\n\n\n\n1\n\"Active\"\n1\n1.0\n\"X\"\n100\n\n\n1\n\"Active\"\n2\n1.0\n\"X\"\n100\n\n\n1\n\"Active\"\n3\n1.0\n\"X\"\n100\n\n\n1\n\"Active\"\n4\n1.0\n\"X\"\n100\n\n\n1\n\"Active\"\n5\n1.0\n\"X\"\n100\n\n\n…\n…\n…\n…\n…\n…\n\n\n3\n\"Active\"\n9\n1.0\n\"Z\"\n90\n\n\n3\n\"Active\"\n10\n1.0\n\"Z\"\n90\n\n\n3\n\"Active\"\n11\n1.0\n\"Z\"\n90\n\n\n3\n\"Active\"\n12\n1.0\n\"Z\"\n90\n\n\n3\n\"Surrender\"\n13\n1.0\n\"Z\"\n90\n\n\n\n\n\n\nIf your experience study requires a numeric feature that varies over time (ex: policy values, crediting rates, etc.), you can always attach it to an ExposedDF object’s data using a join function.\n\n# Illustrative example - assume `values` is a data frame containing the columns pol_num and pol_yr.\n\nexposed_data.data.join(values, on=['pol_num', 'pol_yr'], how='left')\n\n\n\nLimitations\nExposedDF() does not support studies with multiple changes between an active status and an inactive status."
  },
  {
    "objectID": "articles/actxps.html",
    "href": "articles/actxps.html",
    "title": "Getting started with actxps",
    "section": "",
    "text": "This article is based on creating a termination study using sample data that comes with the actxps package. For information on transaction studies, see Transactions."
  },
  {
    "objectID": "articles/actxps.html#simulated-data-set",
    "href": "articles/actxps.html#simulated-data-set",
    "title": "Getting started with actxps",
    "section": "Simulated data set",
    "text": "Simulated data set\nThe actxps package includes a Polars data frame containing simulated census data for a theoretical deferred annuity product with an optional guaranteed income rider. The grain of this data is one row per policy.\n\nimport actxps as xp\nimport numpy as np\nimport polars as pl\n\ncensus_dat = xp.load_census_dat()\ncensus_dat\n\n\nshape: (20_000, 11)\n\n\n\npol_num\nstatus\nissue_date\ninc_guar\nqual\nage\nproduct\ngender\nwd_age\npremium\nterm_date\n\n\ni64\ncat\ndate\nbool\nbool\ni64\ncat\ncat\ni64\nf64\ndate\n\n\n\n\n1\n\"Active\"\n2014-12-17\ntrue\nfalse\n56\n\"b\"\n\"F\"\n77\n370.0\nnull\n\n\n2\n\"Surrender\"\n2007-09-24\nfalse\nfalse\n71\n\"a\"\n\"F\"\n71\n708.0\n2019-03-08\n\n\n3\n\"Active\"\n2012-10-06\nfalse\ntrue\n62\n\"b\"\n\"F\"\n63\n466.0\nnull\n\n\n4\n\"Surrender\"\n2005-06-27\ntrue\ntrue\n62\n\"c\"\n\"M\"\n62\n485.0\n2018-11-29\n\n\n5\n\"Active\"\n2019-11-22\nfalse\nfalse\n62\n\"c\"\n\"F\"\n67\n978.0\nnull\n\n\n…\n…\n…\n…\n…\n…\n…\n…\n…\n…\n…\n\n\n19996\n\"Active\"\n2014-08-11\ntrue\ntrue\n55\n\"b\"\n\"F\"\n75\n3551.0\nnull\n\n\n19997\n\"Surrender\"\n2006-11-20\nfalse\nfalse\n68\n\"c\"\n\"F\"\n77\n336.0\n2017-07-09\n\n\n19998\n\"Surrender\"\n2017-02-20\ntrue\nfalse\n68\n\"c\"\n\"F\"\n68\n1222.0\n2018-08-03\n\n\n19999\n\"Active\"\n2015-04-11\nfalse\ntrue\n67\n\"a\"\n\"M\"\n78\n2138.0\nnull\n\n\n20000\n\"Active\"\n2009-04-29\ntrue\ntrue\n72\n\"c\"\n\"M\"\n72\n5751.0\nnull\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\ncensus_dat is a Polars data frame. Actxps functions accept both Polars and Pandas data frames. For speed and efficiency reasons, Polars is used internally for all data wrangling, so if a Pandas data frame is passed to an actxps function it will be converted to Polars. To convert a Polars data frame to Pandas the method DataFrame.to_pandas() is available.\n\n\nThe data includes 3 policy statuses: Active, Death, and Surrender.\n\nstatus_counts = census_dat['status'].value_counts()\nstatus_counts\n\n\nshape: (3, 2)\n\n\n\nstatus\ncount\n\n\ncat\nu32\n\n\n\n\n\"Active\"\n15212\n\n\n\"Death\"\n1816\n\n\n\"Surrender\"\n2972\n\n\n\n\n\n\nLet’s assume we’re interested in calculating the probability of surrender over one policy year. We cannot simply calculate the proportion of policies in a surrendered status as this does not represent an annualized surrender rate.\n\n# incorrect\nstatus_counts.with_columns(pl.col('count') / pl.col('count').sum())\n\n\nshape: (3, 2)\n\n\n\nstatus\ncount\n\n\ncat\nf64\n\n\n\n\n\"Active\"\n0.7606\n\n\n\"Death\"\n0.0908\n\n\n\"Surrender\"\n0.1486"
  },
  {
    "objectID": "articles/actxps.html#creating-exposed-data",
    "href": "articles/actxps.html#creating-exposed-data",
    "title": "Getting started with actxps",
    "section": "Creating exposed data",
    "text": "Creating exposed data\nIn order to calculate annual surrender rates, we need to break each policy into multiple records. There should be one row per policy per year.\nThe ExposedDF() class is used to perform this transformation.\n\nexposed_data = xp.ExposedDF(census_dat, end_date=\"2019-12-31\",\n                            target_status=\"Surrender\")\n\nexposed_data\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (141_252, 15)\n┌─────────┬────────┬────────────┬──────────┬───┬────────┬─────────────┬─────────────────┬──────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_end ┆ exposure │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---    ┆ ---         ┆ ---             ┆ ---      │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ u32    ┆ date        ┆ date            ┆ f64      │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════╪═════════════╪═════════════════╪══════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 1      ┆ 2014-12-17  ┆ 2015-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 2      ┆ 2015-12-17  ┆ 2016-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 3      ┆ 2016-12-17  ┆ 2017-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 4      ┆ 2017-12-17  ┆ 2018-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 5      ┆ 2018-12-17  ┆ 2019-12-16      ┆ 1.0      │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …      ┆ …           ┆ …               ┆ …        │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 7      ┆ 2015-04-29  ┆ 2016-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 8      ┆ 2016-04-29  ┆ 2017-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 9      ┆ 2017-04-29  ┆ 2018-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 10     ┆ 2018-04-29  ┆ 2019-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 11     ┆ 2019-04-29  ┆ 2020-04-28      ┆ 0.674863 │\n└─────────┴────────┴────────────┴──────────┴───┴────────┴─────────────┴─────────────────┴──────────┘\n\n\nExposedDF objects include an exposure data frame in the data property and some additional attributes related to the experience study.\nNow that the data has been “exposed” by policy year, the observed annual surrender probability can be calculated as:\n\n(sum(exposed_data.data['status'] == \"Surrender\") /\n sum(exposed_data.data['exposure']))\n\n0.021630959546465652\n\n\nAs a default, ExposedDF() calculates exposures by policy year. This can also be accomplished with the class method ExposedDF.expose_py(). Other implementations of ExposedDF() include:\n\nExposedDF.expose_cy = exposures by calendar year\nExposedDF.expose_cq = exposures by calendar quarter\nExposedDF.expose_cm = exposures by calendar month\nExposedDF.expose_cw = exposures by calendar week\nExposedDF.expose_pq = exposures by policy quarter\nExposedDF.expose_pm = exposures by policy month\nExposedDF.expose_pw = exposures by policy week\n\nSee Exposures for further details on exposure calculations."
  },
  {
    "objectID": "articles/actxps.html#experience-study-summary-function",
    "href": "articles/actxps.html#experience-study-summary-function",
    "title": "Getting started with actxps",
    "section": "Experience study summary function",
    "text": "Experience study summary function\nThe exp_stats() method creates a summary of observed experience data. The output of this function is an ExpStats object.\n\nexposed_data.exp_stats()\n\nExperience study results\n\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (1, 4)\n┌──────────┬────────┬───────────────┬──────────┐\n│ n_claims ┆ claims ┆ exposure      ┆ q_obs    │\n│ ---      ┆ ---    ┆ ---           ┆ ---      │\n│ u32      ┆ u32    ┆ f64           ┆ f64      │\n╞══════════╪════════╪═══════════════╪══════════╡\n│ 2869     ┆ 2869   ┆ 132633.968171 ┆ 0.021631 │\n└──────────┴────────┴───────────────┴──────────┘\n\n\nSee Experience Summaries for further details on exposure calculations.\n\nGrouped experience data\nExposedDF objects contain a group_by() method that is used to specify grouping variables for downstream methods like exp_stats(). Below, the data is grouped by policy year (pol_yr) and an indicator for the presence of a guaranteed income rider (inc_guar). After exp_stats() is called, the resulting output contains one record for each unique group.\n\nexp_res = (exposed_data.\n    group_by(\"pol_yr\", \"inc_guar\").\n    exp_stats())\n\nexp_res\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (30, 6)\n┌────────┬──────────┬──────────┬────────┬──────────────┬──────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆ ---          ┆ ---      │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆ f64          ┆ f64      │\n╞════════╪══════════╪══════════╪════════╪══════════════╪══════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ 7719.80774   ┆ 0.007254 │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ 11532.404626 ┆ 0.003989 │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ 7102.81316   ┆ 0.012953 │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ 10611.967258 ┆ 0.006408 │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ 6446.916146  ┆ 0.010393 │\n│ …      ┆ …        ┆ …        ┆ …      ┆ …            ┆ …        │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ 1117.137361  ┆ 0.043862 │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ 262.622262   ┆ 0.125656 │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ 609.216476   ┆ 0.047602 │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ 74.050109    ┆ 0.108035 │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ 194.128602   ┆ 0.046361 │\n└────────┴──────────┴──────────┴────────┴──────────────┴──────────┘\n\n\n\n\nActual-to-expected rates\nTo derive actual-to-expected rates, first attach one or more columns of expected termination rates to the exposure data. Then, pass these column names to the expected argument of exp_stats().\n\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10),\n                                 [.2, .15], np.repeat(0.05, 3)))\n\n# using 2 different expected termination rates\nexposed_data.data = exposed_data.data.with_columns(\n    expected_1=expected_table[exposed_data.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (exposed_data.\n           group_by(\"pol_yr\", \"inc_guar\").\n           exp_stats(expected=[\"expected_1\", \"expected_2\"]))\n\nexp_res\n\nExperience study results\n\nGroups: pol_yr, inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (30, 10)\n┌────────┬──────────┬──────────┬────────┬───┬────────────┬────────────┬──────────────┬─────────────┐\n│ pol_yr ┆ inc_guar ┆ n_claims ┆ claims ┆ … ┆ expected_1 ┆ expected_2 ┆ ae_expected_ ┆ ae_expected │\n│ ---    ┆ ---      ┆ ---      ┆ ---    ┆   ┆ ---        ┆ ---        ┆ 1            ┆ _2          │\n│ u32    ┆ bool     ┆ u32      ┆ u32    ┆   ┆ f64        ┆ f64        ┆ ---          ┆ ---         │\n│        ┆          ┆          ┆        ┆   ┆            ┆            ┆ f64          ┆ f64         │\n╞════════╪══════════╪══════════╪════════╪═══╪════════════╪════════════╪══════════════╪═════════════╡\n│ 1      ┆ false    ┆ 56       ┆ 56     ┆ … ┆ 0.005      ┆ 0.03       ┆ 1.450813     ┆ 0.241802    │\n│ 1      ┆ true     ┆ 46       ┆ 46     ┆ … ┆ 0.005      ┆ 0.015      ┆ 0.797752     ┆ 0.265917    │\n│ 2      ┆ false    ┆ 92       ┆ 92     ┆ … ┆ 0.007778   ┆ 0.03       ┆ 1.665336     ┆ 0.431754    │\n│ 2      ┆ true     ┆ 68       ┆ 68     ┆ … ┆ 0.007778   ┆ 0.015      ┆ 0.823868     ┆ 0.427191    │\n│ 3      ┆ false    ┆ 67       ┆ 67     ┆ … ┆ 0.010556   ┆ 0.03       ┆ 0.984559     ┆ 0.346419    │\n│ …      ┆ …        ┆ …        ┆ …      ┆ … ┆ …          ┆ …          ┆ …            ┆ …           │\n│ 13     ┆ true     ┆ 49       ┆ 49     ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.877242     ┆ 2.924141    │\n│ 14     ┆ false    ┆ 33       ┆ 33     ┆ … ┆ 0.05       ┆ 0.03       ┆ 2.513115     ┆ 4.188525    │\n│ 14     ┆ true     ┆ 29       ┆ 29     ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.952043     ┆ 3.173475    │\n│ 15     ┆ false    ┆ 8        ┆ 8      ┆ … ┆ 0.05       ┆ 0.03       ┆ 2.160699     ┆ 3.601165    │\n│ 15     ┆ true     ┆ 9        ┆ 9      ┆ … ┆ 0.05       ┆ 0.015      ┆ 0.92722      ┆ 3.090735    │\n└────────┴──────────┴──────────┴────────┴───┴────────────┴────────────┴──────────────┴─────────────┘\n\n\n\n\nplot() and table() methods\nExpStats objects have plot() and table() methods that create visualizations and summary tables. See Data visualizations for full details on these functions.\n\nexp_res.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n# first 10 rows showed for brevity\nexp_res.table()\n\n\n\n\n\n\nsummary()\nCalling the summary() method on an ExpStats object re-summarizes experience results. This also produces an ExpStats object.\n\nexp_res.summary()\n\nExperience study results\n\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (1, 8)\n┌──────────┬────────┬─────────────┬──────────┬────────────┬────────────┬─────────────┬─────────────┐\n│ n_claims ┆ claims ┆ exposure    ┆ q_obs    ┆ expected_1 ┆ expected_2 ┆ ae_expected ┆ ae_expected │\n│ ---      ┆ ---    ┆ ---         ┆ ---      ┆ ---        ┆ ---        ┆ _1          ┆ _2          │\n│ u32      ┆ u32    ┆ f64         ┆ f64      ┆ f64        ┆ f64        ┆ ---         ┆ ---         │\n│          ┆        ┆             ┆          ┆            ┆            ┆ f64         ┆ f64         │\n╞══════════╪════════╪═════════════╪══════════╪════════════╪════════════╪═════════════╪═════════════╡\n│ 2869     ┆ 2869   ┆ 132633.9681 ┆ 0.021631 ┆ 0.024242   ┆ 0.020895   ┆ 0.892304    ┆ 1.035233    │\n│          ┆        ┆ 71          ┆          ┆            ┆            ┆             ┆             │\n└──────────┴────────┴─────────────┴──────────┴────────────┴────────────┴─────────────┴─────────────┘\n\n\nIf additional variables are passed to *by, these variables become groups in the re-summarized ExpStats object.\n\nexp_res.summary('inc_guar')\n\nExperience study results\n\nGroups: inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (2, 9)\n┌──────────┬──────────┬────────┬────────────┬───┬────────────┬────────────┬────────────┬───────────┐\n│ inc_guar ┆ n_claims ┆ claims ┆ exposure   ┆ … ┆ expected_1 ┆ expected_2 ┆ ae_expecte ┆ ae_expect │\n│ ---      ┆ ---      ┆ ---    ┆ ---        ┆   ┆ ---        ┆ ---        ┆ d_1        ┆ ed_2      │\n│ bool     ┆ u32      ┆ u32    ┆ f64        ┆   ┆ f64        ┆ f64        ┆ ---        ┆ ---       │\n│          ┆          ┆        ┆            ┆   ┆            ┆            ┆ f64        ┆ f64       │\n╞══════════╪══════════╪════════╪════════════╪═══╪════════════╪════════════╪════════════╪═══════════╡\n│ false    ┆ 1601     ┆ 1601   ┆ 52123.2360 ┆ … ┆ 0.023481   ┆ 0.03       ┆ 1.308099   ┆ 1.023856  │\n│          ┆          ┆        ┆ 81         ┆   ┆            ┆            ┆            ┆           │\n│ true     ┆ 1268     ┆ 1268   ┆ 80510.7320 ┆ … ┆ 0.024734   ┆ 0.015      ┆ 0.636751   ┆ 1.049964  │\n│          ┆          ┆        ┆ 91         ┆   ┆            ┆            ┆            ┆           │\n└──────────┴──────────┴────────┴────────────┴───┴────────────┴────────────┴────────────┴───────────┘"
  },
  {
    "objectID": "articles/actxps.html#shiny-app",
    "href": "articles/actxps.html#shiny-app",
    "title": "Getting started with actxps",
    "section": "Shiny App",
    "text": "Shiny App\nExposedDF objects have an exp_shiny() method that launches a Shiny app to enable interactive exploration of experience data.\n\nexposed_data.exp_shiny()"
  },
  {
    "objectID": "articles/exp_summary.html",
    "href": "articles/exp_summary.html",
    "title": "Experience summaries",
    "section": "",
    "text": "After experience data has been prepared for analysis, the next step is to summarize results. The actxps package’s workhorse function for summarizing termination experience is the exp_stats() method of the ExposedDF class. This function returns an ExpStats object, which is a type of data frame containing additional attributes about the experience study.\nAt a minimum, an ExpStats includes:\nOptionally, an ExpStats can also include:\nTo demonstrate this function, we’re going to use a data frame containing simulated census data for a theoretical deferred annuity product that has an optional guaranteed income rider. Before exp_stats() can be used, we must convert our census data into exposure records using the ExposedDF() class1. In addition, let’s assume we’re interested in studying surrender rates, so we’ll pass the argument target_status='Surrender' to ExposedDF().\nimport actxps as xp\nimport polars as pl\nimport numpy as np\n\ncensus_dat = xp.load_census_dat()\nexposed_data = xp.ExposedDF(census_dat, end_date=\"2019-12-31\",\n                            target_status=\"Surrender\")"
  },
  {
    "objectID": "articles/exp_summary.html#the-exp_stats-method",
    "href": "articles/exp_summary.html#the-exp_stats-method",
    "title": "Experience summaries",
    "section": "The exp_stats() method",
    "text": "The exp_stats() method\nTo use exp_stats(), simply call the method from an ExposedDF object.\n\nexposed_data.exp_stats()\n\nExperience study results\n\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (1, 4)\n┌──────────┬────────┬───────────────┬──────────┐\n│ n_claims ┆ claims ┆ exposure      ┆ q_obs    │\n│ ---      ┆ ---    ┆ ---           ┆ ---      │\n│ u32      ┆ u32    ┆ f64           ┆ f64      │\n╞══════════╪════════╪═══════════════╪══════════╡\n│ 2869     ┆ 2869   ┆ 132633.968171 ┆ 0.021631 │\n└──────────┴────────┴───────────────┴──────────┘\n\n\nThe results show us that we specified no groups, which is why the output data is a single row. In addition, we can see that we’re looking at surrender rates through the end of 2019, which exp_stats() inferred from exposed_data.\nThe number of claims (n_claims) is equal to the number of “Surrender” statuses in exposed_data. Since we didn’t specify any weighting variable, the amount of claims (claims) equals the number of claims.\n\namount = sum(exposed_data.data[\"status\"] == \"Surrender\")\namount\n\n2869\n\n\nThe total exposure (exposure) is equal to the sum of the exposures in exposed_data. Had we specified a weighting variable, this would be equal to the sum of weighted exposures.\n\nsum_expo = sum(exposed_data.data['exposure'])\nsum_expo\n\n132633.9681712721\n\n\nLastly, the observed termination rate (q_obs) equals the amount of claims divided by the exposures.\n\namount / sum_expo\n\n0.021630959546465652\n\n\n\nGrouped data\nIf the data is grouped using the group_by() method, future calls to exp_stats() will contain one record for each unique group.\nIn the following, exposed_data is grouped by policy year before exp_stats() is called. This results in one row per policy year found in the data.\n\n(exposed_data.\n    group_by('pol_yr').\n    exp_stats())\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (15, 5)\n┌────────┬──────────┬────────┬──────────────┬──────────┐\n│ pol_yr ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    │\n│ ---    ┆ ---      ┆ ---    ┆ ---          ┆ ---      │\n│ u32    ┆ u32      ┆ u32    ┆ f64          ┆ f64      │\n╞════════╪══════════╪════════╪══════════════╪══════════╡\n│ 1      ┆ 102      ┆ 102    ┆ 19252.212366 ┆ 0.005298 │\n│ 2      ┆ 160      ┆ 160    ┆ 17714.780418 ┆ 0.009032 │\n│ 3      ┆ 124      ┆ 124    ┆ 16097.137376 ┆ 0.007703 │\n│ 4      ┆ 168      ┆ 168    ┆ 14535.852953 ┆ 0.011558 │\n│ 5      ┆ 164      ┆ 164    ┆ 12915.526244 ┆ 0.012698 │\n│ …      ┆ …        ┆ …      ┆ …            ┆ …        │\n│ 11     ┆ 804      ┆ 804    ┆ 4390.402949  ┆ 0.183127 │\n│ 12     ┆ 330      ┆ 330    ┆ 2663.379931  ┆ 0.123903 │\n│ 13     ┆ 99       ┆ 99     ┆ 1619.90935   ┆ 0.061115 │\n│ 14     ┆ 62       ┆ 62     ┆ 871.838738   ┆ 0.071114 │\n│ 15     ┆ 17       ┆ 17     ┆ 268.178711   ┆ 0.063391 │\n└────────┴──────────┴────────┴──────────────┴──────────┘\n\n\nMultiple grouping variables are allowed. Below, the presence of an income guarantee (inc_guar) is added as a second grouping variable.\n\n(exposed_data.\n    group_by('inc_guar', 'pol_yr').\n    exp_stats())\n\nExperience study results\n\nGroups: inc_guar, pol_yr\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (30, 6)\n┌──────────┬────────┬──────────┬────────┬─────────────┬──────────┐\n│ inc_guar ┆ pol_yr ┆ n_claims ┆ claims ┆ exposure    ┆ q_obs    │\n│ ---      ┆ ---    ┆ ---      ┆ ---    ┆ ---         ┆ ---      │\n│ bool     ┆ u32    ┆ u32      ┆ u32    ┆ f64         ┆ f64      │\n╞══════════╪════════╪══════════╪════════╪═════════════╪══════════╡\n│ false    ┆ 1      ┆ 56       ┆ 56     ┆ 7719.80774  ┆ 0.007254 │\n│ false    ┆ 2      ┆ 92       ┆ 92     ┆ 7102.81316  ┆ 0.012953 │\n│ false    ┆ 3      ┆ 67       ┆ 67     ┆ 6446.916146 ┆ 0.010393 │\n│ false    ┆ 4      ┆ 123      ┆ 123    ┆ 5798.905405 ┆ 0.021211 │\n│ false    ┆ 5      ┆ 97       ┆ 97     ┆ 5105.875799 ┆ 0.018998 │\n│ …        ┆ …      ┆ …        ┆ …      ┆ …           ┆ …        │\n│ true     ┆ 11     ┆ 347      ┆ 347    ┆ 2696.783674 ┆ 0.128672 │\n│ true     ┆ 12     ┆ 150      ┆ 150    ┆ 1768.300449 ┆ 0.084827 │\n│ true     ┆ 13     ┆ 49       ┆ 49     ┆ 1117.137361 ┆ 0.043862 │\n│ true     ┆ 14     ┆ 29       ┆ 29     ┆ 609.216476  ┆ 0.047602 │\n│ true     ┆ 15     ┆ 9        ┆ 9      ┆ 194.128602  ┆ 0.046361 │\n└──────────┴────────┴──────────┴────────┴─────────────┴──────────┘\n\n\nGrouping persists after group_by() is called. To remove groups, the ungroup() method can be used.\n\n# check groups\nprint(exposed_data.groups)\n\n['inc_guar', 'pol_yr']\n\n\n\n# ungroup, then check groups again\nexposed_data.ungroup()\nprint(exposed_data.groups is None)\n\nTrue\n\n\n\n\nTarget status\nThe target_status argument of exp_stats() specifies which status levels count as claims in the experience study summary. If the ExposedDF object already has a specified target status (from the original call to ExposedDF()), then this argument is not necessary because the target status is automatically inferred.\nEven if the target status exists, it can be overridden. However care should be taken to ensure that exposure values in the data are appropriate for the new status.\nUsing the example data, a total termination rate can be estimated by including both death and surrender statuses in target_status. To ensure exposures are accurate, an adjustment is made to fully expose deaths prior to calling exp_stats()2.\n\nfrom copy import deepcopy\n\nexposed_data2 = deepcopy(exposed_data)\nexposed_data2.data = exposed_data2.data.with_columns(\n    exposure=pl.when(pl.col('status') == \"Death\").\n             then(1).\n             otherwise('exposure'))\n\n(exposed_data2.group_by('pol_yr').\n    exp_stats(target_status=[\"Surrender\", \"Death\"]))\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender, Death\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (15, 5)\n┌────────┬──────────┬────────┬──────────────┬──────────┐\n│ pol_yr ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    │\n│ ---    ┆ ---      ┆ ---    ┆ ---          ┆ ---      │\n│ u32    ┆ u32      ┆ u32    ┆ f64          ┆ f64      │\n╞════════╪══════════╪════════╪══════════════╪══════════╡\n│ 1      ┆ 290      ┆ 290    ┆ 19348.986084 ┆ 0.014988 │\n│ 2      ┆ 325      ┆ 325    ┆ 17796.251718 ┆ 0.018262 │\n│ 3      ┆ 292      ┆ 292    ┆ 16180.430159 ┆ 0.018046 │\n│ 4      ┆ 329      ┆ 329    ┆ 14611.259031 ┆ 0.022517 │\n│ 5      ┆ 329      ┆ 329    ┆ 12997.512119 ┆ 0.025313 │\n│ …      ┆ …        ┆ …      ┆ …            ┆ …        │\n│ 11     ┆ 894      ┆ 894    ┆ 4441.499731  ┆ 0.201283 │\n│ 12     ┆ 398      ┆ 398    ┆ 2696.530653  ┆ 0.147597 │\n│ 13     ┆ 131      ┆ 131    ┆ 1634.27666   ┆ 0.080158 │\n│ 14     ┆ 89       ┆ 89     ┆ 886.369047   ┆ 0.10041  │\n│ 15     ┆ 23       ┆ 23     ┆ 272.059698   ┆ 0.08454  │\n└────────┴──────────┴────────┴──────────────┴──────────┘"
  },
  {
    "objectID": "articles/exp_summary.html#weighted-results",
    "href": "articles/exp_summary.html#weighted-results",
    "title": "Experience summaries",
    "section": "Weighted results",
    "text": "Weighted results\nExperience studies often weight output by key policy values. Examples include account values, cash values, face amount, premiums, and more. Weighting can be accomplished by passing the name of a weighting column to the wt argument of exp_stats().\nOur sample data contains a column called premium that we can weight by. When weights are supplied, the claims, exposure, and q_obs columns will be weighted. If expected termination rates are supplied (see below), these rates and A/E values will also be weighted.3\n\n#  label: weight-res\n(exposed_data.\n    group_by('pol_yr').\n    exp_stats(wt='premium'))\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nWeighted by: premium\n\nshape: (15, 8)\n┌────────┬──────────┬──────────┬──────────────┬──────────┬─────────────┬───────────┬──────────┐\n│ pol_yr ┆ n_claims ┆ claims   ┆ exposure     ┆ q_obs    ┆ weight      ┆ weight_sq ┆ weight_n │\n│ ---    ┆ ---      ┆ ---      ┆ ---          ┆ ---      ┆ ---         ┆ ---       ┆ ---      │\n│ u32    ┆ u32      ┆ f64      ┆ f64          ┆ f64      ┆ f64         ┆ f64       ┆ i32      │\n╞════════╪══════════╪══════════╪══════════════╪══════════╪═════════════╪═══════════╪══════════╡\n│ 1      ┆ 102      ┆ 83223.0  ┆ 2.5313e7     ┆ 0.003288 ┆ 2.6301746e7 ┆ 6.0743e10 ┆ 19995    │\n│ 2      ┆ 160      ┆ 170058.0 ┆ 2.3352e7     ┆ 0.007282 ┆ 2.4275265e7 ┆ 5.6233e10 ┆ 18434    │\n│ 3      ┆ 124      ┆ 123554.0 ┆ 2.1247e7     ┆ 0.005815 ┆ 2.2201817e7 ┆ 5.1747e10 ┆ 16806    │\n│ 4      ┆ 168      ┆ 176751.0 ┆ 1.9271e7     ┆ 0.009172 ┆ 2.0200019e7 ┆ 4.7142e10 ┆ 15266    │\n│ 5      ┆ 164      ┆ 173273.0 ┆ 1.7229e7     ┆ 0.010057 ┆ 1.8134795e7 ┆ 4.2888e10 ┆ 13618    │\n│ …      ┆ …        ┆ …        ┆ …            ┆ …        ┆ …           ┆ …         ┆ …        │\n│ 11     ┆ 804      ┆ 856379.0 ┆ 6.0932e6     ┆ 0.140547 ┆ 6.783273e6  ┆ 1.6220e10 ┆ 4897     │\n│ 12     ┆ 330      ┆ 383055.0 ┆ 3.8835e6     ┆ 0.098636 ┆ 4.525027e6  ┆ 1.1191e10 ┆ 3093     │\n│ 13     ┆ 99       ┆ 123357.0 ┆ 2.4503e6     ┆ 0.050344 ┆ 2.891573e6  ┆ 7.0759e9  ┆ 1937     │\n│ 14     ┆ 62       ┆ 75534.0  ┆ 1.3392e6     ┆ 0.056401 ┆ 1.821026e6  ┆ 4.6557e9  ┆ 1182     │\n│ 15     ┆ 17       ┆ 19168.0  ┆ 401173.13882 ┆ 0.04778  ┆ 783146.0    ┆ 1.9448e9  ┆ 510      │\n└────────┴──────────┴──────────┴──────────────┴──────────┴─────────────┴───────────┴──────────┘"
  },
  {
    "objectID": "articles/exp_summary.html#expected-values-and-ae-ratios",
    "href": "articles/exp_summary.html#expected-values-and-ae-ratios",
    "title": "Experience summaries",
    "section": "Expected values and A/E ratios",
    "text": "Expected values and A/E ratios\nAs common metric in experience studies is the actual-to-expected, or A/E ratio.\n\\[\nA/E\\ ratio = \\frac{observed\\ value}{expected\\ value}\n\\]\nIf the data passed to exp_stats() has one or more columns containing expected termination rates, A/E ratios can be calculated by passing the names of these columns to the expected argument.\nLet’s assume we have two sets of expected rates. The first set is a vector that varies by policy year. The second set is either 1.5% or 3.0% depending on whether the policy has a guaranteed income benefit. First, we need to attach these assumptions to our exposure data. We will use the names expected_1 and expected_2. Then we pass these names to the expected argument when we call exp_stats().\nIn the output, 4 new columns are created for expected rates and A/E ratios.\n\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10),\n                                 [.2, .15], np.repeat(0.05, 3)))\n\n# using 2 different expected termination rates\nexposed_data.data = exposed_data.data.with_columns(\n    expected_1=expected_table[exposed_data.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (exposed_data.\n           group_by(\"pol_yr\", \"inc_guar\").\n           exp_stats(expected=[\"expected_1\", \"expected_2\"]))\n\nexp_res.data.select('pol_yr', 'inc_guar', 'q_obs', pl.col('^.*expected.*$'))\n\n\nshape: (30, 7)\n\n\n\npol_yr\ninc_guar\nq_obs\nexpected_1\nexpected_2\nae_expected_1\nae_expected_2\n\n\nu32\nbool\nf64\nf64\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n0.007254\n0.005\n0.03\n1.450813\n0.241802\n\n\n1\ntrue\n0.003989\n0.005\n0.015\n0.797752\n0.265917\n\n\n2\nfalse\n0.012953\n0.007778\n0.03\n1.665336\n0.431754\n\n\n2\ntrue\n0.006408\n0.007778\n0.015\n0.823868\n0.427191\n\n\n3\nfalse\n0.010393\n0.010556\n0.03\n0.984559\n0.346419\n\n\n…\n…\n…\n…\n…\n…\n…\n\n\n13\ntrue\n0.043862\n0.05\n0.015\n0.877242\n2.924141\n\n\n14\nfalse\n0.125656\n0.05\n0.03\n2.513115\n4.188525\n\n\n14\ntrue\n0.047602\n0.05\n0.015\n0.952043\n3.173475\n\n\n15\nfalse\n0.108035\n0.05\n0.03\n2.160699\n3.601165\n\n\n15\ntrue\n0.046361\n0.05\n0.015\n0.92722\n3.090735\n\n\n\n\n\n\nAs noted above, if weights are passed to exp_stats() then A/E ratios will also be weighted.\n\nexp_res_wt = (exposed_data.\n              group_by('pol_yr', 'inc_guar').\n              exp_stats(expected=[\"expected_1\", \"expected_2\"],\n                        wt=\"premium\"))\n\nexp_res_wt.data.select('pol_yr', 'inc_guar', 'q_obs', pl.col('^.*expected.*$'))\n\n\nshape: (30, 7)\n\n\n\npol_yr\ninc_guar\nq_obs\nexpected_1\nexpected_2\nae_expected_1\nae_expected_2\n\n\nu32\nbool\nf64\nf64\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n0.004709\n0.005\n0.03\n0.94182\n0.15697\n\n\n1\ntrue\n0.002351\n0.005\n0.015\n0.470113\n0.156704\n\n\n2\nfalse\n0.01054\n0.007778\n0.03\n1.355163\n0.351339\n\n\n2\ntrue\n0.005132\n0.007778\n0.015\n0.659867\n0.342153\n\n\n3\nfalse\n0.007373\n0.010556\n0.03\n0.698464\n0.245756\n\n\n…\n…\n…\n…\n…\n…\n…\n\n\n13\ntrue\n0.038539\n0.05\n0.015\n0.770787\n2.569291\n\n\n14\nfalse\n0.096951\n0.05\n0.03\n1.939013\n3.231688\n\n\n14\ntrue\n0.036829\n0.05\n0.015\n0.736585\n2.455285\n\n\n15\nfalse\n0.066549\n0.05\n0.03\n1.330984\n2.218307\n\n\n15\ntrue\n0.039654\n0.05\n0.015\n0.793086\n2.64362"
  },
  {
    "objectID": "articles/exp_summary.html#credibility",
    "href": "articles/exp_summary.html#credibility",
    "title": "Experience summaries",
    "section": "Credibility",
    "text": "Credibility\nIf the credibility argument is set to True, exp_stats() will produce an estimate of partial credibility under the Limited Fluctuation credibility method (also known as Classical Credibility) assuming a binomial distribution of claims.4\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(credibility=True).\n    data.select('pol_yr', 'inc_guar', 'claims', 'q_obs', 'credibility'))\n\n\nshape: (30, 5)\n\n\n\npol_yr\ninc_guar\nclaims\nq_obs\ncredibility\n\n\nu32\nbool\nu32\nf64\nf64\n\n\n\n\n1\nfalse\n56\n0.007254\n0.191601\n\n\n1\ntrue\n46\n0.003989\n0.173368\n\n\n2\nfalse\n92\n0.012953\n0.24629\n\n\n2\ntrue\n68\n0.006408\n0.211044\n\n\n3\nfalse\n67\n0.010393\n0.209907\n\n\n…\n…\n…\n…\n…\n\n\n13\ntrue\n49\n0.043862\n0.182625\n\n\n14\nfalse\n33\n0.125656\n0.156725\n\n\n14\ntrue\n29\n0.047602\n0.140771\n\n\n15\nfalse\n8\n0.108035\n0.0764\n\n\n15\ntrue\n9\n0.046361\n0.07837\n\n\n\n\n\n\nUnder the default arguments, credibility calculations assume a 95% confidence of being within 5% of the true value. These parameters can be overridden using the conf_level and cred_r arguments, respectively.\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(credibility=True, conf_level=0.98, cred_r=0.03).\n    data.select('pol_yr', 'inc_guar', 'claims', 'q_obs', 'credibility'))\n\n\nshape: (30, 5)\n\n\n\npol_yr\ninc_guar\nclaims\nq_obs\ncredibility\n\n\nu32\nbool\nu32\nf64\nf64\n\n\n\n\n1\nfalse\n56\n0.007254\n0.096855\n\n\n1\ntrue\n46\n0.003989\n0.087638\n\n\n2\nfalse\n92\n0.012953\n0.124501\n\n\n2\ntrue\n68\n0.006408\n0.106683\n\n\n3\nfalse\n67\n0.010393\n0.106109\n\n\n…\n…\n…\n…\n…\n\n\n13\ntrue\n49\n0.043862\n0.092318\n\n\n14\nfalse\n33\n0.125656\n0.079225\n\n\n14\ntrue\n29\n0.047602\n0.07116\n\n\n15\nfalse\n8\n0.108035\n0.03862\n\n\n15\ntrue\n9\n0.046361\n0.039616\n\n\n\n\n\n\nIf expected values are passed to exp_stats() and credibility is set to True, then the output will also contain credibility-weighted expected values:\n\\[\nq^{adj} = Z^{cred} \\times q^{obs} + (1-Z^{cred}) \\times q^{exp}\n\\] where,\n\n\\(q^{adj}\\) = credibility-weighted estimate\n\\(Z^{cred}\\) = partial credibility factor\n\\(q^{obs}\\) = observed termination rate\n\\(q^{exp}\\) = expected termination rate\n\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(credibility=True, expected='expected_1').\n    data.select('pol_yr', 'inc_guar', 'claims', 'q_obs', 'credibility',\n                pl.col('^.*expected.*$')))\n\n\nshape: (30, 8)\n\n\n\npol_yr\ninc_guar\nclaims\nq_obs\ncredibility\nexpected_1\nae_expected_1\nadj_expected_1\n\n\nu32\nbool\nu32\nf64\nf64\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n56\n0.007254\n0.191601\n0.005\n1.450813\n0.005432\n\n\n1\ntrue\n46\n0.003989\n0.173368\n0.005\n0.797752\n0.004825\n\n\n2\nfalse\n92\n0.012953\n0.24629\n0.007778\n1.665336\n0.009052\n\n\n2\ntrue\n68\n0.006408\n0.211044\n0.007778\n0.823868\n0.007489\n\n\n3\nfalse\n67\n0.010393\n0.209907\n0.010556\n0.984559\n0.010521\n\n\n…\n…\n…\n…\n…\n…\n…\n…\n\n\n13\ntrue\n49\n0.043862\n0.182625\n0.05\n0.877242\n0.048879\n\n\n14\nfalse\n33\n0.125656\n0.156725\n0.05\n2.513115\n0.061857\n\n\n14\ntrue\n29\n0.047602\n0.140771\n0.05\n0.952043\n0.049662\n\n\n15\nfalse\n8\n0.108035\n0.0764\n0.05\n2.160699\n0.054434\n\n\n15\ntrue\n9\n0.046361\n0.07837\n0.05\n0.92722\n0.049715"
  },
  {
    "objectID": "articles/exp_summary.html#confidence-intervals",
    "href": "articles/exp_summary.html#confidence-intervals",
    "title": "Experience summaries",
    "section": "Confidence intervals",
    "text": "Confidence intervals\nIf conf_int is set to True, exp_stats() will produce lower and upper confidence interval limits for the observed termination rate.\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(conf_int=True).\n    data.select('pol_yr', 'inc_guar', pl.col('^q_obs.*$')))\n\n\nshape: (30, 5)\n\n\n\npol_yr\ninc_guar\nq_obs\nq_obs_lower\nq_obs_upper\n\n\nu32\nbool\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n0.007254\n0.005441\n0.009197\n\n\n1\ntrue\n0.003989\n0.002862\n0.005203\n\n\n2\nfalse\n0.012953\n0.010418\n0.015628\n\n\n2\ntrue\n0.006408\n0.0049\n0.00801\n\n\n3\nfalse\n0.010393\n0.008066\n0.012874\n\n\n…\n…\n…\n…\n…\n\n\n13\ntrue\n0.043862\n0.032225\n0.056394\n\n\n14\nfalse\n0.125656\n0.087578\n0.167541\n\n\n14\ntrue\n0.047602\n0.031188\n0.065658\n\n\n15\nfalse\n0.108035\n0.040513\n0.189061\n\n\n15\ntrue\n0.046361\n0.020605\n0.077268\n\n\n\n\n\n\nIf no weighting variable is passed to wt, confidence intervals will be constructed assuming a binomial distribution of claims. However, if a weighting variable is supplied, a normal distribution for aggregate claims will be assumed with a mean equal to observed claims and a variance equal to:\n\\[\nVar(S) = E(N) \\times Var(X) + E(X)^2 \\times Var(N)\n\\]\nWhere S is the aggregate claim random variable, X is the weighting variable assumed to follow a normal distribution, and N is a binomial random variable for the number of claims.\nThe default confidence level is 95%. This can be changed using the conf_level argument. Below, tighter confidence intervals are constructed by decreasing the confidence level to 90%.\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(conf_int = True, conf_level = 0.9).\n    data.select('pol_yr', 'inc_guar', pl.col('^q_obs.*$')))\n\n\nshape: (30, 5)\n\n\n\npol_yr\ninc_guar\nq_obs\nq_obs_lower\nq_obs_upper\n\n\nu32\nbool\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n0.007254\n0.0057\n0.008938\n\n\n1\ntrue\n0.003989\n0.003035\n0.004943\n\n\n2\nfalse\n0.012953\n0.010841\n0.015205\n\n\n2\ntrue\n0.006408\n0.005183\n0.007727\n\n\n3\nfalse\n0.010393\n0.008376\n0.012564\n\n\n…\n…\n…\n…\n…\n\n\n13\ntrue\n0.043862\n0.034016\n0.053709\n\n\n14\nfalse\n0.125656\n0.091386\n0.159926\n\n\n14\ntrue\n0.047602\n0.034471\n0.062375\n\n\n15\nfalse\n0.108035\n0.054017\n0.175557\n\n\n15\ntrue\n0.046361\n0.020605\n0.072117\n\n\n\n\n\n\nIf expected values are passed to expected, the output will also contain confidence intervals around any actual-to-expected ratios.\n\n(exposed_data.\n    group_by('pol_yr', 'inc_guar').\n    exp_stats(conf_int = True, expected='expected_1').\n    data.select('pol_yr', 'inc_guar', pl.col('^ae.*$')))\n\n\nshape: (30, 5)\n\n\n\npol_yr\ninc_guar\nae_expected_1\nae_expected_1_lower\nae_expected_1_upper\n\n\nu32\nbool\nf64\nf64\nf64\n\n\n\n\n1\nfalse\n1.450813\n1.08811\n1.839424\n\n\n1\ntrue\n0.797752\n0.5723\n1.040546\n\n\n2\nfalse\n1.665336\n1.33951\n2.009264\n\n\n2\ntrue\n0.823868\n0.630016\n1.029835\n\n\n3\nfalse\n0.984559\n0.764135\n1.219677\n\n\n…\n…\n…\n…\n…\n\n\n13\ntrue\n0.877242\n0.644504\n1.127883\n\n\n14\nfalse\n2.513115\n1.751565\n3.35082\n\n\n14\ntrue\n0.952043\n0.623752\n1.313162\n\n\n15\nfalse\n2.160699\n0.810262\n3.781223\n\n\n15\ntrue\n0.92722\n0.412098\n1.545367\n\n\n\n\n\n\nLastly, if credibility is True and expected values are passed to expected, confidence intervals will also be calculated for any credibility-weighted termination rates."
  },
  {
    "objectID": "articles/exp_summary.html#miscellaneous",
    "href": "articles/exp_summary.html#miscellaneous",
    "title": "Experience summaries",
    "section": "Miscellaneous",
    "text": "Miscellaneous\n\nSummary method\nAs noted above, the result of exp_stats() is an ExpStats object. If the summary() function is applied to an ExpStats object, the data will be summarized again and return a higher level ExpStats object.\nIf no additional arguments are passed, summary() returns a single row of aggregate results.\n\nexp_res.summary()\n\nExperience study results\n\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (1, 8)\n┌──────────┬────────┬─────────────┬──────────┬────────────┬────────────┬─────────────┬─────────────┐\n│ n_claims ┆ claims ┆ exposure    ┆ q_obs    ┆ expected_1 ┆ expected_2 ┆ ae_expected ┆ ae_expected │\n│ ---      ┆ ---    ┆ ---         ┆ ---      ┆ ---        ┆ ---        ┆ _1          ┆ _2          │\n│ u32      ┆ u32    ┆ f64         ┆ f64      ┆ f64        ┆ f64        ┆ ---         ┆ ---         │\n│          ┆        ┆             ┆          ┆            ┆            ┆ f64         ┆ f64         │\n╞══════════╪════════╪═════════════╪══════════╪════════════╪════════════╪═════════════╪═════════════╡\n│ 2869     ┆ 2869   ┆ 132633.9681 ┆ 0.021631 ┆ 0.024242   ┆ 0.020895   ┆ 0.892304    ┆ 1.035233    │\n│          ┆        ┆ 71          ┆          ┆            ┆            ┆             ┆             │\n└──────────┴────────┴─────────────┴──────────┴────────────┴────────────┴─────────────┴─────────────┘\n\n\nIf additional variable names are passed to the summary() method, then the output will group the data by those variables. In our example, if pol_yr is passed to summary(), the output will contain one row per policy year.\n\nexp_res.summary('pol_yr')\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (15, 9)\n┌────────┬──────────┬────────┬─────────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ pol_yr ┆ n_claims ┆ claims ┆ exposure    ┆ … ┆ expected_1 ┆ expected_2 ┆ ae_expecte ┆ ae_expecte │\n│ ---    ┆ ---      ┆ ---    ┆ ---         ┆   ┆ ---        ┆ ---        ┆ d_1        ┆ d_2        │\n│ u32    ┆ u32      ┆ u32    ┆ f64         ┆   ┆ f64        ┆ f64        ┆ ---        ┆ ---        │\n│        ┆          ┆        ┆             ┆   ┆            ┆            ┆ f64        ┆ f64        │\n╞════════╪══════════╪════════╪═════════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ 1      ┆ 102      ┆ 102    ┆ 19252.21236 ┆ … ┆ 0.005      ┆ 0.021015   ┆ 1.059618   ┆ 0.252113   │\n│        ┆          ┆        ┆ 6           ┆   ┆            ┆            ┆            ┆            │\n│ 2      ┆ 160      ┆ 160    ┆ 17714.78041 ┆ … ┆ 0.007778   ┆ 0.021014   ┆ 1.161258   ┆ 0.429803   │\n│        ┆          ┆        ┆ 8           ┆   ┆            ┆            ┆            ┆            │\n│ 3      ┆ 124      ┆ 124    ┆ 16097.13737 ┆ … ┆ 0.010556   ┆ 0.021008   ┆ 0.72978    ┆ 0.366689   │\n│        ┆          ┆        ┆ 6           ┆   ┆            ┆            ┆            ┆            │\n│ 4      ┆ 168      ┆ 168    ┆ 14535.85295 ┆ … ┆ 0.013333   ┆ 0.020984   ┆ 0.866822   ┆ 0.550781   │\n│        ┆          ┆        ┆ 3           ┆   ┆            ┆            ┆            ┆            │\n│ 5      ┆ 164      ┆ 164    ┆ 12915.52624 ┆ … ┆ 0.016111   ┆ 0.02093    ┆ 0.788145   ┆ 0.606686   │\n│        ┆          ┆        ┆ 4           ┆   ┆            ┆            ┆            ┆            │\n│ …      ┆ …        ┆ …      ┆ …           ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │\n│ 11     ┆ 804      ┆ 804    ┆ 4390.402949 ┆ … ┆ 0.2        ┆ 0.020786   ┆ 0.915633   ┆ 8.809961   │\n│ 12     ┆ 330      ┆ 330    ┆ 2663.379931 ┆ … ┆ 0.15       ┆ 0.020041   ┆ 0.826018   ┆ 6.182451   │\n│ 13     ┆ 99       ┆ 99     ┆ 1619.90935  ┆ … ┆ 0.05       ┆ 0.019656   ┆ 1.222291   ┆ 3.109275   │\n│ 14     ┆ 62       ┆ 62     ┆ 871.838738  ┆ … ┆ 0.05       ┆ 0.019518   ┆ 1.422281   ┆ 3.643434   │\n│ 15     ┆ 17       ┆ 17     ┆ 268.178711  ┆ … ┆ 0.05       ┆ 0.019142   ┆ 1.267811   ┆ 3.311624   │\n└────────┴──────────┴────────┴─────────────┴───┴────────────┴────────────┴────────────┴────────────┘\n\n\nSimilarly, if inc_guar is passed to summary(), the output will contain a row for each unique value in inc_guar.\n\nexp_res.summary('inc_guar')\n\nExperience study results\n\nGroups: inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nExpected values: expected_1, expected_2\n\nshape: (2, 9)\n┌──────────┬──────────┬────────┬────────────┬───┬────────────┬────────────┬────────────┬───────────┐\n│ inc_guar ┆ n_claims ┆ claims ┆ exposure   ┆ … ┆ expected_1 ┆ expected_2 ┆ ae_expecte ┆ ae_expect │\n│ ---      ┆ ---      ┆ ---    ┆ ---        ┆   ┆ ---        ┆ ---        ┆ d_1        ┆ ed_2      │\n│ bool     ┆ u32      ┆ u32    ┆ f64        ┆   ┆ f64        ┆ f64        ┆ ---        ┆ ---       │\n│          ┆          ┆        ┆            ┆   ┆            ┆            ┆ f64        ┆ f64       │\n╞══════════╪══════════╪════════╪════════════╪═══╪════════════╪════════════╪════════════╪═══════════╡\n│ false    ┆ 1601     ┆ 1601   ┆ 52123.2360 ┆ … ┆ 0.023481   ┆ 0.03       ┆ 1.308099   ┆ 1.023856  │\n│          ┆          ┆        ┆ 81         ┆   ┆            ┆            ┆            ┆           │\n│ true     ┆ 1268     ┆ 1268   ┆ 80510.7320 ┆ … ┆ 0.024734   ┆ 0.015      ┆ 0.636751   ┆ 1.049964  │\n│          ┆          ┆        ┆ 91         ┆   ┆            ┆            ┆            ┆           │\n└──────────┴──────────┴────────┴────────────┴───┴────────────┴────────────┴────────────┴───────────┘\n\n\n\n\nColumn names\nAs a default, exp_stats() assumes the input data frame uses the following naming conventions:\n\nThe exposure column is called exposure\nThe status column is called status\n\nThese default names can be overridden using the col_exposure and col_status arguments.\nFor example, if the status column was called curr_stat in our data, we could write:\n\nexposed_data.exp_stats(col_status=\"curr_stat\")\n\n\n\nLimitations\nThe exp_stats() method only supports termination studies. It does not contain support for transaction studies or studies with multiple changes from an active to an inactive status. For information on transaction studies, see Transactions."
  },
  {
    "objectID": "articles/exp_summary.html#footnotes",
    "href": "articles/exp_summary.html#footnotes",
    "title": "Experience summaries",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nSee Exposures for more information on creating exposure records.↩︎\nThis adjustment is not necessary on surrenders because the expose() function previously did this for us.↩︎\nWhen weights are supplied, additional columns are created containing the sum of weights, the sum of squared weights, and the number of records. These columns are used for re-summarizing the data (see the “Summary method” section on this page).↩︎\nSee Herzog, Thomas (1999). Introduction to Credibility Theory for more information on Limited Fluctuation Credibility.↩︎"
  },
  {
    "objectID": "articles/transactions.html",
    "href": "articles/transactions.html",
    "title": "Transaction studies",
    "section": "",
    "text": "This article walks through an example of creating a transaction study using the actxps package. Unlike a termination study, transaction studies track events that can occur multiple times over the life of a policy. Often, transactions are expected to reoccur; for example, the utilization of a guaranteed income stream.\nKey questions to answer in a transaction study are:\nThe example below walks through preparing data by adding transaction information to an ExposedDF object using the add_transactions() method. Next, study results are summarized using the trx_stats() method."
  },
  {
    "objectID": "articles/transactions.html#simulated-transaction-and-account-value-data",
    "href": "articles/transactions.html#simulated-transaction-and-account-value-data",
    "title": "Transaction studies",
    "section": "Simulated transaction and account value data",
    "text": "Simulated transaction and account value data\nIn this example, we’ll be using the census_dat, withdrawals, and account_vals data sets. Each data set is based on a theoretical block of deferred annuity business with a guaranteed lifetime income benefit.\n\ncensus_dat contains census-level information with one row per policy\nwithdrawals contains withdrawal transactions. There are 2 types of transactions in the data: “Base” (ordinary withdrawals) and “Rider” (guaranteed income payments).\naccount_vals contains historical account values on policy anniversaries. This data will be used to calculate withdrawal rates as a percentage of account values."
  },
  {
    "objectID": "articles/transactions.html#the-add_transactions-method",
    "href": "articles/transactions.html#the-add_transactions-method",
    "title": "Transaction studies",
    "section": "The add_transactions() method",
    "text": "The add_transactions() method\nThe add_transactions() method attaches transactions to an ExposedDF object, which contains a data frame with exposure-level records. For our example, we first need to convert census_dat into exposure records using ExposedDF().1 This example will use policy year exposures.\n\nimport actxps as xp\nimport polars as pl\n\ncensus_dat = xp.load_census_dat()\nexposed_data = xp.ExposedDF(census_dat, \"2019-12-31\",\n                            target_status=\"Surrender\")\nexposed_data\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (141_252, 15)\n┌─────────┬────────┬────────────┬──────────┬───┬────────┬─────────────┬─────────────────┬──────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ pol_yr ┆ pol_date_yr ┆ pol_date_yr_end ┆ exposure │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---    ┆ ---         ┆ ---             ┆ ---      │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ u32    ┆ date        ┆ date            ┆ f64      │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════╪═════════════╪═════════════════╪══════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 1      ┆ 2014-12-17  ┆ 2015-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 2      ┆ 2015-12-17  ┆ 2016-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 3      ┆ 2016-12-17  ┆ 2017-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 4      ┆ 2017-12-17  ┆ 2018-12-16      ┆ 1.0      │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 5      ┆ 2018-12-17  ┆ 2019-12-16      ┆ 1.0      │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …      ┆ …           ┆ …               ┆ …        │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 7      ┆ 2015-04-29  ┆ 2016-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 8      ┆ 2016-04-29  ┆ 2017-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 9      ┆ 2017-04-29  ┆ 2018-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 10     ┆ 2018-04-29  ┆ 2019-04-28      ┆ 1.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 11     ┆ 2019-04-29  ┆ 2020-04-28      ┆ 0.674863 │\n└─────────┴────────┴────────────┴──────────┴───┴────────┴─────────────┴─────────────────┴──────────┘\n\n\nThe withdrawals data has 4 columns that are required for attaching transactions:\n\npol_num: policy number\ntrx_date: transaction date\ntrx_type: transaction type\ntrx_amt: transaction amount\n\n\nwithdrawals = xp.load_withdrawals()\nwithdrawals\n\n\nshape: (160_130, 4)\n\n\n\npol_num\ntrx_date\ntrx_type\ntrx_amt\n\n\ni64\ndate\ncat\nf64\n\n\n\n\n2\n2007-10-05\n\"Base\"\n25.0\n\n\n2\n2009-07-30\n\"Base\"\n12.0\n\n\n2\n2010-02-22\n\"Base\"\n7.0\n\n\n2\n2010-12-30\n\"Base\"\n52.0\n\n\n2\n2012-05-07\n\"Base\"\n41.0\n\n\n…\n…\n…\n…\n\n\n20000\n2015-08-08\n\"Rider\"\n547.0\n\n\n20000\n2016-07-26\n\"Rider\"\n106.0\n\n\n20000\n2017-12-29\n\"Rider\"\n31.0\n\n\n20000\n2018-06-14\n\"Rider\"\n75.0\n\n\n20000\n2019-12-09\n\"Rider\"\n466.0\n\n\n\n\n\n\nThe grain of this data is one row per policy per transaction. The expectation is that the number of records in the transaction data will not match the number of rows in the exposure data. That is because policies could have zero or several transactions in a given exposure period.\nThe add_transactions() method uses a non-equivalent join to associate each transaction with a policy number and a date interval found in the exposure data. Then, transaction counts and amounts are summarized such that there is one row per exposure period. In the event there are multiple transaction types found in the data, separate columns are created for each transaction type.\nUsing our example, we pass both the exposure and withdrawals data to add_transactions(). The resulting data has the same number of rows as original exposure data and 4 new columns:\n\ntrx_amt_Base: the sum of “Base” withdrawal transactions\ntrx_amt_Rider: the sum of “Rider” withdrawal transactions\ntrx_n_Base: the number of “Base” withdrawal transactions\ntrx_n_Rider: the number of “Rider” withdrawal transactions\n\n\nexposed_data.add_transactions(withdrawals)\nexposed_data.data.glimpse()\n\nRows: 141252\nColumns: 19\n$ pol_num          &lt;i64&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 2\n$ status          &lt;enum&gt; Active, Active, Active, Active, Active, Active, Active, Active, Active, Active\n$ issue_date      &lt;date&gt; 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2014-12-17, 2007-09-24, 2007-09-24, 2007-09-24, 2007-09-24\n$ inc_guar        &lt;bool&gt; True, True, True, True, True, True, False, False, False, False\n$ qual            &lt;bool&gt; False, False, False, False, False, False, False, False, False, False\n$ age              &lt;i64&gt; 56, 56, 56, 56, 56, 56, 71, 71, 71, 71\n$ product          &lt;cat&gt; b, b, b, b, b, b, a, a, a, a\n$ gender           &lt;cat&gt; F, F, F, F, F, F, F, F, F, F\n$ wd_age           &lt;i64&gt; 77, 77, 77, 77, 77, 77, 71, 71, 71, 71\n$ premium          &lt;f64&gt; 370.0, 370.0, 370.0, 370.0, 370.0, 370.0, 708.0, 708.0, 708.0, 708.0\n$ term_date       &lt;date&gt; None, None, None, None, None, None, None, None, None, None\n$ pol_yr           &lt;u32&gt; 1, 2, 3, 4, 5, 6, 1, 2, 3, 4\n$ pol_date_yr     &lt;date&gt; 2014-12-17, 2015-12-17, 2016-12-17, 2017-12-17, 2018-12-17, 2019-12-17, 2007-09-24, 2008-09-24, 2009-09-24, 2010-09-24\n$ pol_date_yr_end &lt;date&gt; 2015-12-16, 2016-12-16, 2017-12-16, 2018-12-16, 2019-12-16, 2020-12-16, 2008-09-23, 2009-09-23, 2010-09-23, 2011-09-23\n$ exposure         &lt;f64&gt; 1.0, 1.0, 1.0, 1.0, 1.0, 0.04098360655737743, 1.0, 1.0, 1.0, 1.0\n$ trx_n_Base       &lt;i32&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1\n$ trx_n_Rider      &lt;i32&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\n$ trx_amt_Base     &lt;f64&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 25.0, 12.0, 7.0, 52.0\n$ trx_amt_Rider    &lt;f64&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0\n\n\n\nIf we print exposed_data, we can see that it has an additional attribute for transaction types that have been attached.\n\nexposed_data\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (141_252, 19)\n┌─────────┬────────┬────────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ trx_n_Base ┆ trx_n_Ride ┆ trx_amt_Ba ┆ trx_amt_Ri │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---        ┆ r          ┆ se         ┆ der        │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ i32        ┆ ---        ┆ ---        ┆ ---        │\n│         ┆        ┆            ┆          ┆   ┆            ┆ i32        ┆ f64        ┆ f64        │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 547.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 106.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 31.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 75.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 466.0      │\n└─────────┴────────┴────────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘"
  },
  {
    "objectID": "articles/transactions.html#the-trx_stats-method",
    "href": "articles/transactions.html#the-trx_stats-method",
    "title": "Transaction studies",
    "section": "The trx_stats() method",
    "text": "The trx_stats() method\nThe actxps package’s workhorse function for summarizing transaction experience is the trx_stats() method of the ExposedDF class. This function returns a TrxStats object, which is a type of data frame containing additional attributes about the transaction study.\nAt a minimum, a TrxStats includes the following for each transaction type (trx_type):\n\nThe number of transactions (trx_n)\nThe number of exposure periods with a transaction (trx_flag)\nThe sum of transactions (trx_amt)\nThe total exposure (exposure)\nThe average transaction amount when a transaction occurs (avg_trx)\nThe average transaction amount across all records (avg_all)\nThe transaction frequency when a transaction occurs (trx_freq = trx_n / trx_flag)\nThe transaction utilization (trx_util = trx_flag / exposure)\n\nOptionally, a TrxStats can also include:\n\nAny grouping variables attached to the input data\nTransaction amounts as a percentage of another value when a transaction occurs (pct_of_*_w_trx)\nTransaction amounts as a percentage of another value across all records (pct_of_*_all)\n\nTo use trx_stats(), we simply need to call the method from an ExposedDF object with transactions attached.\n\nexposed_data.trx_stats()\n\nTransaction study results\n\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (2, 9)\n┌──────────┬─────────┬──────────┬────────────┬───┬───────────┬───────────┬──────────┬──────────┐\n│ trx_type ┆ trx_n   ┆ trx_flag ┆ trx_amt    ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │\n│ ---      ┆ ---     ┆ ---      ┆ ---        ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │\n│ str      ┆ f64     ┆ u32      ┆ f64        ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │\n╞══════════╪═════════╪══════════╪════════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡\n│ Base     ┆ 60500.0 ┆ 28224    ┆ 1.093899e6 ┆ … ┆ 38.757759 ┆ 8.809475  ┆ 2.143566 ┆ 0.227296 │\n│ Rider    ┆ 77321.0 ┆ 35941    ┆ 2.842729e6 ┆ … ┆ 79.094321 ┆ 22.893294 ┆ 2.151331 ┆ 0.289443 │\n└──────────┴─────────┴──────────┴────────────┴───┴───────────┴───────────┴──────────┴──────────┘\n\n\nThe results show us that we specified no groups, which is why the output data contains a single row for each transaction type.\n\nGrouped data\nIf the data is grouped using the group_by() method, future calls to exp_stats() will contain one record for each unique group.\nIf the data is grouped using the group_by() method, future calls to trx_stats() will contain one record for each unique group.\nIn the following, exposed_data is grouped by the presence of an income guarantee (inc_guar) before being passed to trx_stats(). This results in four rows because we have two types of transactions and two distinct values of inc_guar.\n\n(exposed_data.\n    group_by('inc_guar').\n    trx_stats())\n\nTransaction study results\n\nGroups: inc_guar\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (4, 10)\n┌──────────┬──────────┬─────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐\n│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │\n│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │\n│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │\n╞══════════╪══════════╪═════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡\n│ false    ┆ Base     ┆ 52939.0 ┆ 24703    ┆ … ┆ 38.563292 ┆ 19.466039 ┆ 2.143019 ┆ 0.504782 │\n│ false    ┆ Rider    ┆ 0.0     ┆ 0        ┆ … ┆ NaN       ┆ 0.0       ┆ NaN      ┆ 0.0      │\n│ true     ┆ Base     ┆ 7561.0  ┆ 3521     ┆ … ┆ 40.122124 ┆ 1.877716  ┆ 2.147401 ┆ 0.0468   │\n│ true     ┆ Rider    ┆ 77321.0 ┆ 35941    ┆ … ┆ 79.094321 ┆ 37.784661 ┆ 2.151331 ┆ 0.477716 │\n└──────────┴──────────┴─────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘\n\n\nMultiple grouping variables are allowed. Below, policy year (pol_yr) is added as a second grouping variable.\n\n(exposed_data.\n    group_by('inc_guar', 'pol_yr').\n    trx_stats())\n\nTransaction study results\n\nGroups: inc_guar, pol_yr\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (60, 11)\n┌──────────┬────────┬──────────┬────────┬───┬────────────┬───────────┬──────────┬──────────┐\n│ inc_guar ┆ pol_yr ┆ trx_type ┆ trx_n  ┆ … ┆ avg_trx    ┆ avg_all   ┆ trx_freq ┆ trx_util │\n│ ---      ┆ ---    ┆ ---      ┆ ---    ┆   ┆ ---        ┆ ---       ┆ ---      ┆ ---      │\n│ bool     ┆ u32    ┆ str      ┆ f64    ┆   ┆ f64        ┆ f64       ┆ f64      ┆ f64      │\n╞══════════╪════════╪══════════╪════════╪═══╪════════════╪═══════════╪══════════╪══════════╡\n│ false    ┆ 1      ┆ Base     ┆ 6077.0 ┆ … ┆ 34.115585  ┆ 13.219502 ┆ 2.109337 ┆ 0.387492 │\n│ false    ┆ 1      ┆ Rider    ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │\n│ false    ┆ 2      ┆ Base     ┆ 6091.0 ┆ … ┆ 34.374083  ┆ 14.444885 ┆ 2.127489 ┆ 0.420226 │\n│ false    ┆ 2      ┆ Rider    ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │\n│ false    ┆ 3      ┆ Base     ┆ 6016.0 ┆ … ┆ 34.584074  ┆ 15.752105 ┆ 2.138642 ┆ 0.455473 │\n│ …        ┆ …      ┆ …        ┆ …      ┆ … ┆ …          ┆ …         ┆ …        ┆ …        │\n│ true     ┆ 13     ┆ Rider    ┆ 1486.0 ┆ … ┆ 94.984894  ┆ 71.698974 ┆ 2.244713 ┆ 0.754846 │\n│ true     ┆ 14     ┆ Base     ┆ 26.0   ┆ … ┆ 83.8       ┆ 2.100251  ┆ 2.6      ┆ 0.025063 │\n│ true     ┆ 14     ┆ Rider    ┆ 736.0  ┆ … ┆ 96.987342  ┆ 76.81203  ┆ 2.329114 ┆ 0.79198  │\n│ true     ┆ 15     ┆ Base     ┆ 0.0    ┆ … ┆ NaN        ┆ 0.0       ┆ NaN      ┆ 0.0      │\n│ true     ┆ 15     ┆ Rider    ┆ 19.0   ┆ … ┆ 104.888889 ┆ 85.818182 ┆ 2.111111 ┆ 0.818182 │\n└──────────┴────────┴──────────┴────────┴───┴────────────┴───────────┴──────────┴──────────┘"
  },
  {
    "objectID": "articles/transactions.html#expressing-transactions-as-a-percentage-of-another-value",
    "href": "articles/transactions.html#expressing-transactions-as-a-percentage-of-another-value",
    "title": "Transaction studies",
    "section": "Expressing transactions as a percentage of another value",
    "text": "Expressing transactions as a percentage of another value\nIn a transaction study, we often want to express transaction amounts as a percentage of another value. For example, in a withdrawal study, withdrawal amounts divided by account values provides a withdrawal rate. In a study of benefit utilization, transactions can be divided by a maximum benefit amount to derive a benefit utilization rate. In addition, actual-to-expected rates can be calculated by dividing transactions by expected values.\nIf column names are passed to the percent_of argument of trx_stats(), the output will contain 4 additional columns for each “percent of” variable:\n\nThe sum of each “percent of” variable\nThe sum of each “percent of” variable when a transaction occurs. These columns include the suffix _w_trx.\nTransaction amounts divided by each “percent of” variable (pct_of_{*}_all)\nTransaction amounts divided by each “percent of” variable when a transaction occurs (pct_of_{*}_w_trx)\n\nFor our example, let’s assume we’re interested in examining withdrawal transactions as a percentage of account values, which are available in the account_vals data frame in the column av_anniv.\n\n# attach account values data\naccount_vals = xp.load_account_vals()\nexposed_data.data = \\\n    exposed_data.data.join(account_vals,\n                           on=['pol_num', 'pol_date_yr'],\n                           how='left')\n\ntrx_res = (exposed_data.\n           group_by('pol_yr', 'inc_guar').\n           trx_stats(percent_of=\"av_anniv\"))\n\ntrx_res.data.glimpse()\n\nRows: 60\nColumns: 15\n$ pol_yr                 &lt;u32&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3\n$ inc_guar              &lt;bool&gt; False, False, True, True, False, False, True, True, False, False\n$ trx_type               &lt;str&gt; 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider', 'Base', 'Rider'\n$ trx_n                  &lt;f64&gt; 6077.0, 0.0, 1370.0, 8077.0, 6091.0, 0.0, 1183.0, 8232.0, 6016.0, 0.0\n$ trx_flag               &lt;u32&gt; 2881, 0, 633, 3778, 2863, 0, 559, 3834, 2813, 0\n$ trx_amt                &lt;f64&gt; 98287.0, 0.0, 21590.0, 265312.0, 98413.0, 0.0, 18554.0, 288114.0, 97285.0, 0.0\n$ exposure               &lt;f64&gt; 7435.0, 7435.0, 11106.0, 11106.0, 6813.0, 6813.0, 10158.0, 10158.0, 6176.0, 6176.0\n$ av_anniv               &lt;f64&gt; 9686914.0, 9686914.0, 14679001.0, 14679001.0, 9218561.0, 9218561.0, 13795383.0, 13795383.0, 8682868.0, 8682868.0\n$ av_anniv_w_trx         &lt;f64&gt; 3875306.0, 0.0, 865046.0, 4982082.0, 3909786.0, 0.0, 797932.0, 5022297.0, 3954457.0, 0.0\n$ avg_trx                &lt;f64&gt; 34.11558486636584, nan, 34.107424960505526, 70.22551614610906, 34.37408312958435, nan, 33.19141323792486, 75.1471048513302, 34.584073942410235, nan\n$ avg_all                &lt;f64&gt; 13.219502353732347, 0.0, 1.9439942373491805, 23.889068971726996, 14.444884779098782, 0.0, 1.8265406576097658, 28.36326048434731, 15.752104922279793, 0.0\n$ trx_freq               &lt;f64&gt; 2.109337035751475, nan, 2.1642969984202214, 2.13790365272631, 2.1274886482710444, nan, 2.116279069767442, 2.1471048513302033, 2.1386420191965874, nan\n$ trx_util               &lt;f64&gt; 0.3874915938130464, 0.0, 0.056996218260399786, 0.3401764811813434, 0.4202260384558931, 0.0, 0.055030517818468204, 0.377436503248671, 0.45547279792746115, 0.0\n$ pct_of_av_anniv_all    &lt;f64&gt; 0.01014636859581906, 0.0, 0.0014708085379924697, 0.018074254508191667, 0.010675527340980876, 0.0, 0.0013449427246782493, 0.020884813419098258, 0.011204247260237055, 0.0\n$ pct_of_av_anniv_w_trx  &lt;f64&gt; 0.025362384286556985, nan, 0.024958210314827187, 0.05325323830478904, 0.025170942859788235, nan, 0.023252607991658437, 0.057366977699646195, 0.024601354876282636, nan"
  },
  {
    "objectID": "articles/transactions.html#confidence-intervals",
    "href": "articles/transactions.html#confidence-intervals",
    "title": "Transaction studies",
    "section": "Confidence intervals",
    "text": "Confidence intervals\nIf conf_int is set to True, trx_stats() will produce lower and upper confidence interval limits for the observed utilization rate. Confidence intervals are constructed assuming a binomial distribution.\n\n(exposed_data.\n    group_by('pol_yr').\n    trx_stats(conf_int=True).\n    data.select('pol_yr', pl.col('^trx_util.*$')))\n\n\nshape: (30, 4)\n\n\n\npol_yr\ntrx_util\ntrx_util_lower\ntrx_util_upper\n\n\nu32\nf64\nf64\nf64\n\n\n\n\n1\n0.189526\n0.183917\n0.195189\n\n\n1\n0.203765\n0.197994\n0.20959\n\n\n2\n0.201638\n0.195628\n0.207707\n\n\n2\n0.225915\n0.21961\n0.23222\n\n\n3\n0.214912\n0.208417\n0.221407\n\n\n…\n…\n…\n…\n\n\n13\n0.516784\n0.489461\n0.544106\n\n\n14\n0.245645\n0.210801\n0.280488\n\n\n14\n0.550523\n0.510453\n0.590592\n\n\n15\n0.380952\n0.190476\n0.571429\n\n\n15\n0.428571\n0.238095\n0.619048\n\n\n\n\n\n\nThe default confidence level is 95%. This can be changed using the conf_level argument. Below, tighter confidence intervals are constructed by decreasing the confidence level to 90%.\n\n(exposed_data.\n    group_by('pol_yr').\n    trx_stats(conf_int=True, conf_level=0.9).\n    data.select('pol_yr', pl.col('^trx_util.*$')))\n\n\nshape: (30, 4)\n\n\n\npol_yr\ntrx_util\ntrx_util_lower\ntrx_util_upper\n\n\nu32\nf64\nf64\nf64\n\n\n\n\n1\n0.189526\n0.18478\n0.194272\n\n\n1\n0.203765\n0.198911\n0.208619\n\n\n2\n0.201638\n0.196571\n0.206706\n\n\n2\n0.225915\n0.220671\n0.231218\n\n\n3\n0.214912\n0.209456\n0.220368\n\n\n…\n…\n…\n…\n\n\n13\n0.516784\n0.494145\n0.539422\n\n\n14\n0.245645\n0.216028\n0.275261\n\n\n14\n0.550523\n0.515679\n0.585366\n\n\n15\n0.380952\n0.190476\n0.571429\n\n\n15\n0.428571\n0.238095\n0.619048\n\n\n\n\n\n\nIf any column names are passed to percent_of, trx_stats() will produce additional confidence intervals:\n\nIntervals for transactions as a percentage of another column when transactions occur (pct_of_{*}_w_trx) are constructed using a normal distribution.\nIntervals for transactions as a percentage of another column regardless of transaction utilization (pct_of_{*}_all) are calculated assuming that the aggregate distribution is normal with a mean equal to observed transactions and a variance equal to:\n\n\\[\n     Var(S) = E(N) \\times Var(X) + E(X)^2 \\times Var(N),\n\\] Where S is the aggregate transactions random variable, X is an individual transaction amount assumed to follow a normal distribution, and N is a binomial random variable for transaction utilization.\n\n(exposed_data.\n    group_by('pol_yr').\n    trx_stats(conf_int=True, percent_of=\"av_anniv\").\n    data.select('pol_yr', pl.col('^pct_of.*$')).\n    glimpse())\n\nRows: 30\nColumns: 7\n$ pol_yr                      &lt;u32&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5\n$ pct_of_av_anniv_all         &lt;f64&gt; 0.004919864491031837, 0.010888653268305336, 0.005082440454361061, 0.012519105808200455, 0.0054184028999354535, 0.01372773518470287, 0.0057982676649823905, 0.014308868197434476, 0.006049953867711983, 0.01458240440835664\n$ pct_of_av_anniv_w_trx       &lt;f64&gt; 0.02528862835502511, 0.05325323830478904, 0.024845795776212595, 0.057366977699646195, 0.025090409528046198, 0.058707111268391836, 0.02573072327170688, 0.058632474394021104, 0.025600201973245067, 0.05745971742829165\n$ pct_of_av_anniv_w_trx_lower &lt;f64&gt; 0.024019602566381235, 0.05078956041146959, 0.02362582577122162, 0.05443418723085425, 0.02388004600357687, 0.055946842712423055, 0.024241205873009836, 0.05572760267518904, 0.024227755075207042, 0.05431596122849967\n$ pct_of_av_anniv_w_trx_upper &lt;f64&gt; 0.02655765414366899, 0.055716916198108486, 0.02606576578120357, 0.06029976816843815, 0.02630077305251553, 0.061467379824360624, 0.02722024067040392, 0.06153734611285317, 0.02697264887128309, 0.06060347362808364\n$ pct_of_av_anniv_all_lower   &lt;f64&gt; 0.004632812409391607, 0.010297256498243708, 0.004790158298104324, 0.011790284670673416, 0.00511005224674474, 0.012979911178210493, 0.005417177353585797, 0.013498165909945252, 0.005671678443875981, 0.01368698584634903\n$ pct_of_av_anniv_all_upper   &lt;f64&gt; 0.0052069165726720676, 0.011480050038366964, 0.005374722610617797, 0.013247926945727493, 0.0057267535531261675, 0.014475559191195248, 0.006179357976378984, 0.0151195704849237, 0.006428229291547985, 0.01547782297036425"
  },
  {
    "objectID": "articles/transactions.html#plot-and-table",
    "href": "articles/transactions.html#plot-and-table",
    "title": "Transaction studies",
    "section": "plot() and table()",
    "text": "plot() and table()\nThe plot() and table() methods create visualizations and summary tables from TrxStats objects. See See Visualizations for full details on these functions.\n\ntrx_res.plot(y='pct_of_av_anniv_w_trx')\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n# first 10 rows showed for brevity\ntrx_res.table()"
  },
  {
    "objectID": "articles/transactions.html#miscellaneous",
    "href": "articles/transactions.html#miscellaneous",
    "title": "Transaction studies",
    "section": "Miscellaneous",
    "text": "Miscellaneous\n\nSelecting and combining transaction types\nThe trx_types argument of trx_stats() selects a subset of transaction types that will appear in the output.\n\nexposed_data.trx_stats(trx_types=\"Base\")\n\nTransaction study results\n\nGroups: pol_yr\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base\n\nshape: (15, 10)\n┌────────┬──────────┬────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐\n│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │\n│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │\n│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │\n╞════════╪══════════╪════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡\n│ 1      ┆ Base     ┆ 7447.0 ┆ 3514     ┆ … ┆ 34.114115 ┆ 6.465509  ┆ 2.119237 ┆ 0.189526 │\n│ 2      ┆ Base     ┆ 7274.0 ┆ 3422     ┆ … ┆ 34.180888 ┆ 6.892169  ┆ 2.125658 ┆ 0.201638 │\n│ 3      ┆ Base     ┆ 7061.0 ┆ 3309     ┆ … ┆ 35.163796 ┆ 7.557122  ┆ 2.133877 ┆ 0.214912 │\n│ 4      ┆ Base     ┆ 6596.0 ┆ 3080     ┆ … ┆ 37.333442 ┆ 8.338434  ┆ 2.141558 ┆ 0.22335  │\n│ 5      ┆ Base     ┆ 6093.0 ┆ 2847     ┆ … ┆ 38.60836  ┆ 8.984633  ┆ 2.140148 ┆ 0.232712 │\n│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …         ┆ …         ┆ …        ┆ …        │\n│ 11     ┆ Base     ┆ 2428.0 ┆ 1115     ┆ … ┆ 48.259193 ┆ 13.804259 ┆ 2.177578 ┆ 0.286044 │\n│ 12     ┆ Base     ┆ 1320.0 ┆ 605      ┆ … ┆ 50.289256 ┆ 13.414903 ┆ 2.181818 ┆ 0.266755 │\n│ 13     ┆ Base     ┆ 700.0  ┆ 319      ┆ … ┆ 55.827586 ┆ 13.90242  ┆ 2.194357 ┆ 0.249024 │\n│ 14     ┆ Base     ┆ 315.0  ┆ 141      ┆ … ┆ 63.0      ┆ 15.47561  ┆ 2.234043 ┆ 0.245645 │\n│ 15     ┆ Base     ┆ 19.0   ┆ 8        ┆ … ┆ 28.125    ┆ 10.714286 ┆ 2.375    ┆ 0.380952 │\n└────────┴──────────┴────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘\n\n\nIf the combine_trx argument is set to True, all transaction types will be combined in a group called “All” in the output.\n\nexposed_data.trx_stats(combine_trx=True)\n\nTransaction study results\n\nGroups: pol_yr\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (15, 10)\n┌────────┬──────────┬─────────┬──────────┬───┬───────────┬───────────┬──────────┬──────────┐\n│ pol_yr ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ avg_trx   ┆ avg_all   ┆ trx_freq ┆ trx_util │\n│ ---    ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---       ┆ ---       ┆ ---      ┆ ---      │\n│ u32    ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64       ┆ f64       ┆ f64      ┆ f64      │\n╞════════╪══════════╪═════════╪══════════╪═══╪═══════════╪═══════════╪══════════╪══════════╡\n│ 1      ┆ All      ┆ 15524.0 ┆ 7292     ┆ … ┆ 52.823505 ┆ 20.774985 ┆ 2.128908 ┆ 0.393291 │\n│ 2      ┆ All      ┆ 15506.0 ┆ 7256     ┆ … ┆ 55.82704  ┆ 23.869012 ┆ 2.13699  ┆ 0.427553 │\n│ 3      ┆ All      ┆ 15265.0 ┆ 7126     ┆ … ┆ 57.697446 ┆ 26.703384 ┆ 2.142155 ┆ 0.462817 │\n│ 4      ┆ All      ┆ 14556.0 ┆ 6795     ┆ … ┆ 58.682855 ┆ 28.915881 ┆ 2.142163 ┆ 0.492748 │\n│ 5      ┆ All      ┆ 13629.0 ┆ 6368     ┆ … ┆ 58.865735 ┆ 30.640592 ┆ 2.140232 ┆ 0.520517 │\n│ …      ┆ …        ┆ …       ┆ …        ┆ … ┆ …         ┆ …         ┆ …        ┆ …        │\n│ 11     ┆ All      ┆ 5896.0  ┆ 2712     ┆ … ┆ 71.323378 ┆ 49.622627 ┆ 2.174041 ┆ 0.695741 │\n│ 12     ┆ All      ┆ 3718.0  ┆ 1681     ┆ … ┆ 71.917906 ┆ 53.304233 ┆ 2.211779 ┆ 0.741182 │\n│ 13     ┆ All      ┆ 2186.0  ┆ 981      ┆ … ┆ 82.251784 ┆ 62.989071 ┆ 2.228338 ┆ 0.765808 │\n│ 14     ┆ All      ┆ 1051.0  ┆ 457      ┆ … ┆ 86.501094 ┆ 68.869338 ┆ 2.299781 ┆ 0.796167 │\n│ 15     ┆ All      ┆ 38.0    ┆ 17       ┆ … ┆ 68.764706 ┆ 55.666667 ┆ 2.235294 ┆ 0.809524 │\n└────────┴──────────┴─────────┴──────────┴───┴───────────┴───────────┴──────────┴──────────┘\n\n\n\n\nPartial exposures are removed as a default\nAs a default, trx_stats() removes partial exposures before summarizing results. This is done to avoid complexity associated with a lopsided skew in the timing of transactions. For example, if transactions can occur on a monthly basis or annually at the beginning of each policy year, partial exposures may not be appropriate. If a policy had an exposure of 0.5 years and was taking withdrawals annually at the beginning of the year, an argument could be made that the exposure should instead be 1 complete year. If the same policy was expected to take withdrawals 9 months into the year, it’s not clear if the exposure should be 0.5 years or 0.5 / 0.75 years. To override this treatment, set the full_exposures_only argument to False.\n\nexposed_data.trx_stats(full_exposures_only=False)\n\nTransaction study results\n\nGroups: pol_yr\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (30, 10)\n┌────────┬──────────┬────────┬──────────┬───┬────────────┬────────────┬──────────┬──────────┐\n│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ avg_trx    ┆ avg_all    ┆ trx_freq ┆ trx_util │\n│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---        ┆ ---        ┆ ---      ┆ ---      │\n│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64        ┆ f64        ┆ f64      ┆ f64      │\n╞════════╪══════════╪════════╪══════════╪═══╪════════════╪════════════╪══════════╪══════════╡\n│ 1      ┆ Base     ┆ 8123.0 ┆ 3818     ┆ … ┆ 33.82792   ┆ 6.70858    ┆ 2.127554 ┆ 0.198315 │\n│ 1      ┆ Rider    ┆ 8819.0 ┆ 4103     ┆ … ┆ 70.828175  ┆ 15.094785  ┆ 2.149403 ┆ 0.213118 │\n│ 2      ┆ Base     ┆ 7924.0 ┆ 3737     ┆ … ┆ 34.321113  ┆ 7.240169   ┆ 2.120417 ┆ 0.210954 │\n│ 2      ┆ Rider    ┆ 8976.0 ┆ 4186     ┆ … ┆ 74.692069  ┆ 17.649725  ┆ 2.14429  ┆ 0.2363   │\n│ 3      ┆ Base     ┆ 7668.0 ┆ 3603     ┆ … ┆ 35.304468  ┆ 7.90215    ┆ 2.128226 ┆ 0.223829 │\n│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …          ┆ …          ┆ …        ┆ …        │\n│ 13     ┆ Rider    ┆ 2285.0 ┆ 1026     ┆ … ┆ 91.708577  ┆ 58.085349  ┆ 2.227096 ┆ 0.633369 │\n│ 14     ┆ Base     ┆ 622.0  ┆ 283      ┆ … ┆ 60.55477   ┆ 19.656158  ┆ 2.19788  ┆ 0.324601 │\n│ 14     ┆ Rider    ┆ 1497.0 ┆ 663      ┆ … ┆ 102.467572 ┆ 77.922667  ┆ 2.257919 ┆ 0.760462 │\n│ 15     ┆ Base     ┆ 277.0  ┆ 121      ┆ … ┆ 75.280992  ┆ 33.966156  ┆ 2.289256 ┆ 0.451192 │\n│ 15     ┆ Rider    ┆ 705.0  ┆ 309      ┆ … ┆ 101.032362 ┆ 116.411179 ┆ 2.281553 ┆ 1.152217 │\n└────────┴──────────┴────────┴──────────┴───┴────────────┴────────────┴──────────┴──────────┘\n\n\n\n\nSummary method\nAs noted above, the result of trx_stats() is a TrxStats object. If the summary() function is applied to a TrxStats object, the data will be summarized again and return a higher level TrxStats object.\nIf no additional arguments are passed, summary() returns a single row of aggregate results for each transaction type.\n\ntrx_res.summary()\n\nTransaction study results\n\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\nTransactions as % of: av_anniv\n\nshape: (2, 13)\n┌──────────┬─────────┬──────────┬────────────┬───┬──────────┬──────────┬─────────────┬─────────────┐\n│ trx_type ┆ trx_n   ┆ trx_flag ┆ trx_amt    ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_a ┆ pct_of_av_a │\n│ ---      ┆ ---     ┆ ---      ┆ ---        ┆   ┆ ---      ┆ ---      ┆ nniv_all    ┆ nniv_w_trx  │\n│ str      ┆ f64     ┆ u32      ┆ f64        ┆   ┆ f64      ┆ f64      ┆ ---         ┆ ---         │\n│          ┆         ┆          ┆            ┆   ┆          ┆          ┆ f64         ┆ f64         │\n╞══════════╪═════════╪══════════╪════════════╪═══╪══════════╪══════════╪═════════════╪═════════════╡\n│ Base     ┆ 60500.0 ┆ 28224    ┆ 1.093899e6 ┆ … ┆ 2.143566 ┆ 0.227296 ┆ 0.005943    ┆ 0.025139    │\n│ Rider    ┆ 77321.0 ┆ 35941    ┆ 2.842729e6 ┆ … ┆ 2.151331 ┆ 0.289443 ┆ 0.015444    ┆ 0.059616    │\n└──────────┴─────────┴──────────┴────────────┴───┴──────────┴──────────┴─────────────┴─────────────┘\n\n\nIf additional variable names are passed to the summary() function, then the output will group the data by those variables. In our example, if pol_yr is passed to summary(), the output will contain one row per policy year for each transaction type.\n\ntrx_res.summary('pol_yr')\n\nTransaction study results\n\nGroups: pol_yr\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\nTransactions as % of: av_anniv\n\nshape: (30, 14)\n┌────────┬──────────┬────────┬──────────┬───┬──────────┬──────────┬────────────────┬───────────────┐\n│ pol_yr ┆ trx_type ┆ trx_n  ┆ trx_flag ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_anni ┆ pct_of_av_ann │\n│ ---    ┆ ---      ┆ ---    ┆ ---      ┆   ┆ ---      ┆ ---      ┆ v_all          ┆ iv_w_trx      │\n│ u32    ┆ str      ┆ f64    ┆ u32      ┆   ┆ f64      ┆ f64      ┆ ---            ┆ ---           │\n│        ┆          ┆        ┆          ┆   ┆          ┆          ┆ f64            ┆ f64           │\n╞════════╪══════════╪════════╪══════════╪═══╪══════════╪══════════╪════════════════╪═══════════════╡\n│ 1      ┆ Base     ┆ 7447.0 ┆ 3514     ┆ … ┆ 2.119237 ┆ 0.189526 ┆ 0.00492        ┆ 0.025289      │\n│ 1      ┆ Rider    ┆ 8077.0 ┆ 3778     ┆ … ┆ 2.137904 ┆ 0.203765 ┆ 0.010889       ┆ 0.053253      │\n│ 2      ┆ Base     ┆ 7274.0 ┆ 3422     ┆ … ┆ 2.125658 ┆ 0.201638 ┆ 0.005082       ┆ 0.024846      │\n│ 2      ┆ Rider    ┆ 8232.0 ┆ 3834     ┆ … ┆ 2.147105 ┆ 0.225915 ┆ 0.012519       ┆ 0.057367      │\n│ 3      ┆ Base     ┆ 7061.0 ┆ 3309     ┆ … ┆ 2.133877 ┆ 0.214912 ┆ 0.005418       ┆ 0.02509       │\n│ …      ┆ …        ┆ …      ┆ …        ┆ … ┆ …        ┆ …        ┆ …              ┆ …             │\n│ 13     ┆ Rider    ┆ 1486.0 ┆ 662      ┆ … ┆ 2.244713 ┆ 0.516784 ┆ 0.025157       ┆ 0.064411      │\n│ 14     ┆ Base     ┆ 315.0  ┆ 141      ┆ … ┆ 2.234043 ┆ 0.245645 ┆ 0.007851       ┆ 0.024588      │\n│ 14     ┆ Rider    ┆ 736.0  ┆ 316      ┆ … ┆ 2.329114 ┆ 0.550523 ┆ 0.027088       ┆ 0.068         │\n│ 15     ┆ Base     ┆ 19.0   ┆ 8        ┆ … ┆ 2.375    ┆ 0.380952 ┆ 0.00725        ┆ 0.02034       │\n│ 15     ┆ Rider    ┆ 19.0   ┆ 9        ┆ … ┆ 2.111111 ┆ 0.428571 ┆ 0.030418       ┆ 0.078347      │\n└────────┴──────────┴────────┴──────────┴───┴──────────┴──────────┴────────────────┴───────────────┘\n\n\nSimilarly, if inc_guar is passed to summary(), the output will contain a row for each transaction type and unique value in inc_guar.\n\ntrx_res.summary('inc_guar')\n\nTransaction study results\n\nGroups: inc_guar\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\nTransactions as % of: av_anniv\n\nshape: (4, 14)\n┌──────────┬──────────┬─────────┬──────────┬───┬──────────┬──────────┬──────────────┬──────────────┐\n│ inc_guar ┆ trx_type ┆ trx_n   ┆ trx_flag ┆ … ┆ trx_freq ┆ trx_util ┆ pct_of_av_an ┆ pct_of_av_an │\n│ ---      ┆ ---      ┆ ---     ┆ ---      ┆   ┆ ---      ┆ ---      ┆ niv_all      ┆ niv_w_trx    │\n│ bool     ┆ str      ┆ f64     ┆ u32      ┆   ┆ f64      ┆ f64      ┆ ---          ┆ ---          │\n│          ┆          ┆         ┆          ┆   ┆          ┆          ┆ f64          ┆ f64          │\n╞══════════╪══════════╪═════════╪══════════╪═══╪══════════╪══════════╪══════════════╪══════════════╡\n│ false    ┆ Base     ┆ 52939.0 ┆ 24703    ┆ … ┆ 2.143019 ┆ 0.504782 ┆ 0.012757     ┆ 0.02511      │\n│ false    ┆ Rider    ┆ 0.0     ┆ 0        ┆ … ┆ NaN      ┆ 0.0      ┆ 0.0          ┆ NaN          │\n│ true     ┆ Base     ┆ 7561.0  ┆ 3521     ┆ … ┆ 2.147401 ┆ 0.0468   ┆ 0.001291     ┆ 0.025336     │\n│ true     ┆ Rider    ┆ 77321.0 ┆ 35941    ┆ … ┆ 2.151331 ┆ 0.477716 ┆ 0.025987     ┆ 0.059616     │\n└──────────┴──────────┴─────────┴──────────┴───┴──────────┴──────────┴──────────────┴──────────────┘\n\n\n\n\nColumn names\nAs a default, add_transactions() assumes the transaction data frame (trx_data) uses the following naming conventions:\n\nThe policy number column is called pol_num\nThe transaction date column is called trx_date\nThe transaction type column is called trx_type\nThe transaction amount column is called trx_amt\n\nThese default names can be overridden using the col_pol_num, col_trx_date, col_trx_type, and col_trx_amt arguments.\nFor example, if the transaction type column was called transaction_code in our data, we could write:\n\nexposed_data.add_transactions(withdrawals, col_trx_type=\"transaction_code\")\n\nSimilarly, trx_stats() assumes the input data uses the name exposure for exposures. This default can be overridden using the argument col_exposure.\n\n\nLimitations\nThe trx_stats() function does not produce any calculations related to the persistence of transactions from exposure period to exposure period."
  },
  {
    "objectID": "articles/transactions.html#footnotes",
    "href": "articles/transactions.html#footnotes",
    "title": "Transaction studies",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nSee Exposures for more information on creating ExposedDF objects.↩︎"
  },
  {
    "objectID": "changelog.html",
    "href": "changelog.html",
    "title": "Changelog",
    "section": "",
    "text": "To improve speed and efficiency, the data frame backend was changed from Pandas to Polars.\n\nThe data property of ExposedDF, ExpStats, and TrxStats is now a Polars data frame.\nExposedDF, ExpStats.from_DataFrame, and TrxStats.from_DataFrame will accept both Polars and Pandas data frames. However, Pandas data frames are immediately converted to Polars.\n\nRemoved all add_* date functions which are no longer needed under Polars\nExposedDF’s groupby method was renamed to group_by."
  },
  {
    "objectID": "changelog.html#v1.0.0",
    "href": "changelog.html#v1.0.0",
    "title": "Changelog",
    "section": "",
    "text": "To improve speed and efficiency, the data frame backend was changed from Pandas to Polars.\n\nThe data property of ExposedDF, ExpStats, and TrxStats is now a Polars data frame.\nExposedDF, ExpStats.from_DataFrame, and TrxStats.from_DataFrame will accept both Polars and Pandas data frames. However, Pandas data frames are immediately converted to Polars.\n\nRemoved all add_* date functions which are no longer needed under Polars\nExposedDF’s groupby method was renamed to group_by."
  },
  {
    "objectID": "changelog.html#v0.0.1-2024-02-18",
    "href": "changelog.html#v0.0.1-2024-02-18",
    "title": "Changelog",
    "section": "v0.0.1 (2024-02-18)",
    "text": "v0.0.1 (2024-02-18)\n\nSeveral updates to align with the R version of actxps\n\nAdded optional confidence interval outputs to ExpStats and TrxStats objects\nAdded an expose_split() method to ExposedDF classes, which divides calendar period exposures into pre- and post-policy anniversary segments. This creates a SplitExposedDF object, which is a subclass of ExposedDF.\nAdded special plotting functions ExpStats.plot_termination_rates(), ExpStats.plot_actual_to_expected(), and TrxStats.plot_utilization_rates()\nAdded from_DataFrame class methods to ExpStats and TrxStats objects that enables the creation of experience summary objects pre-aggregated data sets.\nAdded the great_tables package as the backend for table() methods\nShiny UI updates\n\nAdded a ‘points’ geom, log 10 y-axis, and confidence interval options to plot methods\nAdded sample data for pre-aggregated exposures (load_agg_sim_dat())\nBug fix - the target status wasn’t being fully exposed when using calendar period exposures\nThe assumed default status on ExposedDF objects is now the most common status instead of the first observed status.\nAdded helper background functions for column selection\nAdded several articles to the package’s website\n\nCurrent differences from the R version are:\n\nNo support for plotting a second variable on the y-axis for .plot() methods\nNo predictive modeling support function (add_predictions(), step_expose())\nTable output cannot be saved to a png directly in the shiny app\nfunctions like pol_interval() don’t accept arbitrary durations. Only ‘year’, ‘quarter’, ‘month’, or ‘week’ are allowed."
  },
  {
    "objectID": "changelog.html#v0.0.0.9000-2023-12-14",
    "href": "changelog.html#v0.0.0.9000-2023-12-14",
    "title": "Changelog",
    "section": "v0.0.0.9000 (2023-12-14)",
    "text": "v0.0.0.9000 (2023-12-14)\n\nDevelopment version of actxps"
  },
  {
    "objectID": "reference/ExposedDF.add_transactions.html",
    "href": "reference/ExposedDF.add_transactions.html",
    "title": "ExposedDF.add_transactions",
    "section": "",
    "text": "expose.ExposedDF.add_transactions(trx_data, col_pol_num='pol_num', col_trx_date='trx_date', col_trx_type='trx_type', col_trx_amt='trx_amt')\nAdd transactions to an experience study"
  },
  {
    "objectID": "reference/ExposedDF.add_transactions.html#parameters",
    "href": "reference/ExposedDF.add_transactions.html#parameters",
    "title": "ExposedDF.add_transactions",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ntrx_data\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame containing transactions details. This data frame must have columns for policy numbers, transaction dates, transaction types, and transaction amounts.\nrequired\n\n\ncol_pol_num\nstr\nName of the column in trx_data containing the policy number\n'pol_num'\n\n\ncol_trx_date\nstr\nName of the column in trx_data containing the transaction date\n'trx_date'\n\n\ncol_trx_type\nstr\nName of the column in trx_data containing the transaction type\n'trx_type'\n\n\ncol_trx_amt\nstr\nName of the column in trx_data containing the transaction amount\n'trx_amt'"
  },
  {
    "objectID": "reference/ExposedDF.add_transactions.html#notes",
    "href": "reference/ExposedDF.add_transactions.html#notes",
    "title": "ExposedDF.add_transactions",
    "section": "Notes",
    "text": "Notes\nThis function attaches transactions to an ExposedDF object. Transactions are grouped and summarized such that the number of rows in the data does not change. Two columns are added to the output for each transaction type. These columns have names of the pattern trx_n_{*} (transaction counts) and trx_amt_{*} (transaction_amounts). The trx_types property is updated to include the new transaction types found in trx_data.\nTransactions are associated with the data object by matching transactions dates with exposure dates ranges found in the ExposedDF."
  },
  {
    "objectID": "reference/ExposedDF.add_transactions.html#examples",
    "href": "reference/ExposedDF.add_transactions.html#examples",
    "title": "ExposedDF.add_transactions",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\ncensus = xp.load_census_dat()\nwithdrawals = xp.load_withdrawals()\nexpo = xp.ExposedDF.expose_py(census, \"2019-12-31\",\n                              target_status=\"Surrender\")\nexpo.add_transactions(withdrawals)\n\nExposure data\n\nExposure type: policy_year\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\nTransaction types: Base, Rider\n\nshape: (141_252, 19)\n┌─────────┬────────┬────────────┬──────────┬───┬────────────┬────────────┬────────────┬────────────┐\n│ pol_num ┆ status ┆ issue_date ┆ inc_guar ┆ … ┆ trx_n_Base ┆ trx_n_Ride ┆ trx_amt_Ba ┆ trx_amt_Ri │\n│ ---     ┆ ---    ┆ ---        ┆ ---      ┆   ┆ ---        ┆ r          ┆ se         ┆ der        │\n│ i64     ┆ enum   ┆ date       ┆ bool     ┆   ┆ i32        ┆ ---        ┆ ---        ┆ ---        │\n│         ┆        ┆            ┆          ┆   ┆            ┆ i32        ┆ f64        ┆ f64        │\n╞═════════╪════════╪════════════╪══════════╪═══╪════════════╪════════════╪════════════╪════════════╡\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ 1       ┆ Active ┆ 2014-12-17 ┆ true     ┆ … ┆ 0          ┆ 0          ┆ 0.0        ┆ 0.0        │\n│ …       ┆ …      ┆ …          ┆ …        ┆ … ┆ …          ┆ …          ┆ …          ┆ …          │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 547.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 106.0      │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 31.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 75.0       │\n│ 20000   ┆ Active ┆ 2009-04-29 ┆ true     ┆ … ┆ 0          ┆ 1          ┆ 0.0        ┆ 466.0      │\n└─────────┴────────┴────────────┴──────────┴───┴────────────┴────────────┴────────────┴────────────┘"
  },
  {
    "objectID": "reference/ExposedDF.from_DataFrame.html",
    "href": "reference/ExposedDF.from_DataFrame.html",
    "title": "ExposedDF.from_DataFrame",
    "section": "",
    "text": "expose.ExposedDF.from_DataFrame(data, end_date, start_date=date(1900, 1, 1), target_status=None, cal_expo=False, expo_length='year', trx_types=None, col_pol_num='pol_num', col_status='status', col_exposure='exposure', col_pol_per=None, cols_dates=None, col_trx_n_='trx_n_', col_trx_amt_='trx_amt_', default_status=None)\nCoerce a data frame to an ExposedDF object\nThe input data frame must have columns for policy numbers, statuses, exposures, policy periods (for policy exposures only), and exposure start / end dates. Optionally, if data has transaction counts and amounts by type, these can be specified without calling add_transactions().\n\n\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndata\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame with exposure-level records\nrequired\n\n\nend_date\ndatetime.date | str\nExperience study end date\nrequired\n\n\nstart_date\ndatetime.date | str\nExperience study start date\ndate(1900, 1, 1)\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nTarget status values\nNone\n\n\ncal_expo\nbool\nSet to True for calendar year exposures. Otherwise policy year exposures are assumed.\nFalse\n\n\nexpo_length\nstr\nExposure period length. Must be ‘year’, ‘quarter’, ‘month’, or ‘week’\n'year'\n\n\ntrx_types\nlist | str\nList containing unique transaction types that have been attached to data. For each value in trx_types, from_DataFrame requires that columns exist in data named trx_n_{*} and trx_amt_{*} containing transaction counts and amounts, respectively. The prefixes “trx_n_” and “trx_amt_” can be overridden using the col_trx_n_ and col_trx_amt_ arguments.\nNone\n\n\ncol_pol_num\nstr\nName of the column in data containing the policy number\n'pol_num'\n\n\ncol_status\nstr\nname of the column in data containing the policy status\n'status'\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'\n\n\ncol_pol_per\nstr\nName of the column in data containing policy exposure periods. Only necessary if cal_expo is False. The assumed default is either “pol_yr”, “pol_qtr”, “pol_mth”, or “pol_wk” depending on the value of expo_length.\nNone\n\n\ncols_dates\nstr\nNames of the columns in data containing exposure start and end dates. Both date ranges are assumed to be exclusive. The assumed default is of the form A_B. A is “cal” if cal_expo is True or “pol” otherwise. B is either “yr”, “qtr”, “mth”, or “wk” depending on the value of expo_length.\nNone\n\n\ncol_trx_n_\nstr\nPrefix to use for columns containing transaction counts.\n\"trx_n_\"\n\n\ncol_trx_amt_\nstr\nPrefix to use for columns containing transaction amounts.\n\"trx_amt_\"\n\n\ndefault_status\nstr\nDefault active status code\nNone\n\n\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nactxps.expose.ExposedDF\nAn ExposedDF object."
  },
  {
    "objectID": "reference/ExposedDF.from_DataFrame.html#parameters",
    "href": "reference/ExposedDF.from_DataFrame.html#parameters",
    "title": "ExposedDF.from_DataFrame",
    "section": "",
    "text": "Name\nType\nDescription\nDefault\n\n\n\n\ndata\npolars.polars.DataFrame | pandas.pandas.DataFrame\nA data frame with exposure-level records\nrequired\n\n\nend_date\ndatetime.date | str\nExperience study end date\nrequired\n\n\nstart_date\ndatetime.date | str\nExperience study start date\ndate(1900, 1, 1)\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nTarget status values\nNone\n\n\ncal_expo\nbool\nSet to True for calendar year exposures. Otherwise policy year exposures are assumed.\nFalse\n\n\nexpo_length\nstr\nExposure period length. Must be ‘year’, ‘quarter’, ‘month’, or ‘week’\n'year'\n\n\ntrx_types\nlist | str\nList containing unique transaction types that have been attached to data. For each value in trx_types, from_DataFrame requires that columns exist in data named trx_n_{*} and trx_amt_{*} containing transaction counts and amounts, respectively. The prefixes “trx_n_” and “trx_amt_” can be overridden using the col_trx_n_ and col_trx_amt_ arguments.\nNone\n\n\ncol_pol_num\nstr\nName of the column in data containing the policy number\n'pol_num'\n\n\ncol_status\nstr\nname of the column in data containing the policy status\n'status'\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'\n\n\ncol_pol_per\nstr\nName of the column in data containing policy exposure periods. Only necessary if cal_expo is False. The assumed default is either “pol_yr”, “pol_qtr”, “pol_mth”, or “pol_wk” depending on the value of expo_length.\nNone\n\n\ncols_dates\nstr\nNames of the columns in data containing exposure start and end dates. Both date ranges are assumed to be exclusive. The assumed default is of the form A_B. A is “cal” if cal_expo is True or “pol” otherwise. B is either “yr”, “qtr”, “mth”, or “wk” depending on the value of expo_length.\nNone\n\n\ncol_trx_n_\nstr\nPrefix to use for columns containing transaction counts.\n\"trx_n_\"\n\n\ncol_trx_amt_\nstr\nPrefix to use for columns containing transaction amounts.\n\"trx_amt_\"\n\n\ndefault_status\nstr\nDefault active status code\nNone"
  },
  {
    "objectID": "reference/ExposedDF.from_DataFrame.html#returns",
    "href": "reference/ExposedDF.from_DataFrame.html#returns",
    "title": "ExposedDF.from_DataFrame",
    "section": "",
    "text": "Type\nDescription\n\n\n\n\nactxps.expose.ExposedDF\nAn ExposedDF object."
  },
  {
    "objectID": "reference/ExpStats.html",
    "href": "reference/ExpStats.html",
    "title": "ExpStats",
    "section": "",
    "text": "exp_stats.ExpStats(self, expo, target_status=None, expected=None, wt=None, conf_int=False, credibility=False, conf_level=0.95, cred_r=0.05, col_exposure='exposure')\nExperience study summary class\nCreate a summary of termination experience for a given target status (an ExpStats object).\nTypically, the ExpStats class constructor should not be called directly. The preferred method for creating an ExpStats object is to call the exp_stats() method on an ExposedDF object."
  },
  {
    "objectID": "reference/ExpStats.html#parameters",
    "href": "reference/ExpStats.html#parameters",
    "title": "ExpStats",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nexpo\nactxps.expose.ExposedDF\nAn exposed data frame class\nrequired\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nA single string, list, or array of target status values\nNone\n\n\nexpected\nstr | list | numpy.numpy.ndarray\nSingle string, list, or array of column names in the data property of expo with expected values\nNone\n\n\nwt\nstr\nName of the column in the data property of expo containing weights to use in the calculation of claims, exposures, and partial credibility.\nNone\n\n\nconf_int\nbool\nIf True, the output will include confidence intervals around the observed termination rates and any actual-to-expected ratios.\nFalse\n\n\ncredibility\nbool\nWhether the output should include partial credibility weights and credibility-weighted decrement rates.\nFalse\n\n\nconf_level\nfloat\nConfidence level under the Limited Fluctuation credibility method and confidence intervals\n0.95\n\n\ncred_r\nfloat\nError tolerance under the Limited Fluctuation credibility method\n0.05\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'"
  },
  {
    "objectID": "reference/ExpStats.html#attributes",
    "href": "reference/ExpStats.html#attributes",
    "title": "ExpStats",
    "section": "Attributes",
    "text": "Attributes\n\n\n\n\n\n\n\n\nName\nType\nDescription\n\n\n\n\ndata\npolars.polars.DataFrame\nA data frame containing experience study summary results that includes columns for any grouping variables, claims, exposures, and observed decrement rates (q_obs). If any values are passed to expected, additional columns will be added for expected decrements and actual-to-expected ratios. If credibility is set to True, additional columns are added for partial credibility and credibility-weighted decrement rates (assuming values are passed to expected).\n\n\ntarget_status, groups, start_date, end_date, expected, wt, xp_params\n\nMetadata about the experience study inferred from the ExposedDF object (expo) or passed directly to ExpStats."
  },
  {
    "objectID": "reference/ExpStats.html#notes",
    "href": "reference/ExpStats.html#notes",
    "title": "ExpStats",
    "section": "Notes",
    "text": "Notes\nIf expo is grouped (see the ExposedDF.group_by() method), the returned ExpStats object’s data will contain one row per group.\nIf nothing is passed to target_status, the target_status property of expo will be used. If that property is None, all status values except the first level will be assumed. This will produce a warning message.\nExpected values\nThe expected argument is optional. If provided, this argument must be a string, list, or array with values corresponding to columns in expo.data containing expected experience. More than one expected basis can be provided.\nConfidence intervals\nIf conf_int is set to True, the output will contain lower and upper confidence interval limits for the observed termination rate and any actual-to-expected ratios. The confidence level is dictated by conf_level. If no weighting variable is passed to wt, confidence intervals will be constructed assuming a binomial distribution of claims. Otherwise, confidence intervals will be calculated assuming that the aggregate claims distribution is normal with a mean equal to observed claims and a variance equal to:\nVar(S) = E(N) * Var(X) + E(X)**2 * Var(N),\nWhere S is the aggregate claim random variable, X is the weighting variable assumed to follow a normal distribution, and N is a binomial random variable for the number of claims.\nIf credibility is True and expected values are passed to expected, the output will also contain confidence intervals for any credibility-weighted termination rates.\nCredibility\nIf credibility is set to True, the output will contain a credibility column equal to the partial credibility estimate under the Limited Fluctuation credibility method (also known as Classical Credibility) assuming a binomial distribution of claims.\nAlternative class constructor\nExpStats.from_DataFrame() can be used to coerce a data frame containing pre-aggregated experience into an ExpStats object. This is most useful for working with industry study data where individual exposure records are not available."
  },
  {
    "objectID": "reference/ExpStats.html#see-also",
    "href": "reference/ExpStats.html#see-also",
    "title": "ExpStats",
    "section": "See Also",
    "text": "See Also\nHerzog, Thomas (1999). Introduction to Credibility Theory"
  },
  {
    "objectID": "reference/ExpStats.html#methods",
    "href": "reference/ExpStats.html#methods",
    "title": "ExpStats",
    "section": "Methods",
    "text": "Methods\n\n\n\nName\nDescription\n\n\n\n\nfrom_DataFrame\nConvert a data frame containing aggregate termination experience study\n\n\nplot\nPlot experience study results\n\n\nplot_actual_to_expected\nPlot actual-to-expected termination rates for any expected termination\n\n\nplot_termination_rates\nPlot observed termination rates and any expected termination rates\n\n\nsummary\nRe-summarize termination experience data\n\n\ntable\nTabular experience study summary\n\n\n\n\nfrom_DataFrame\nexp_stats.ExpStats.from_DataFrame(data, target_status=None, expected=None, wt=None, conf_int=False, credibility=False, conf_level=0.95, cred_r=0.05, col_claims='claims', col_exposure='exposure', col_n_claims='n_claims', col_weight_sq='weight_sq', col_weight_n='weight_n', start_date=date(1900, 1, 1), end_date=None)\nConvert a data frame containing aggregate termination experience study results to the ExpStats class.\nfrom_DataFrame() is most useful for working with aggregate summaries of experience that were not created by actxps where individual policy information is not available. After converting the data to the ExpStats class, summary() can be used to summarize data by any grouping variables, and plot() and table() are available for reporting.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ndata\n(polars.polars.DataFrame | pandas.pandas.DataFrame)\nA DataFrame containing aggregate experience study results. See the Notes section for required columns that must be present.\nrequired\n\n\ntarget_status\nstr | list | numpy.numpy.ndarray\nTarget status values\nNone\n\n\nexpected\nstr | list | numpy.numpy.ndarray\nColumn names in x with expected values.\nNone\n\n\nwt\nstr\nName of the column in data containing weights to use in the calculation of claims, exposures, partial credibility, and confidence intervals.\nNone\n\n\nconf_int\nbool\nIf True, future calls to summary() will include confidence intervals around the observed termination rates and any actual-to-expected ratios.\nFalse\n\n\ncredibility\nbool\nIf True, future calls to summary() will include partial credibility weights and credibility-weighted termination rates.\nFalse\n\n\nconf_level\nfloat\nConfidence level used for the Limited Fluctuation credibility method and confidence intervals.\n0.95\n\n\ncred_r\nfloat\nError tolerance under the Limited Fluctuation credibility method.\n0.05\n\n\ncol_claims\nstr\nName of the column in data containing claims.\n'claims'\n\n\ncol_exposure\nstr\nName of the column in data containing exposures.\n'exposure'\n\n\ncol_n_claims\nstr\nOnly used used when wt is passed. Name of the column in data containing the number of claims.\n'n_claims'\n\n\ncol_weight_sq\ndefault=’weight_sq\nOnly used used when wt is passed. Name of the column in data containing the sum of squared weights.\n'weight_sq'\n\n\ncol_weight_n\nstr\nOnly used used when wt is passed. Name of the column in data containing exposure record counts.\n'weight_n'\n\n\nstart_date\ndatetime.date | str\nExperience study start date\ndate(1900, 1, 1)\n\n\nend_date\ndate | str: default=None\nExperience study end date\nNone\n\n\n\n\n\nReturns\n\n\n\nType\nDescription\n\n\n\n\nactxps.exp_stats.ExpStats\nAn ExpStats object\n\n\n\n\n\nNotes\nIf nothing is passed to wt, the data frame data must include columns containing:\n\nExposures (exposure)\nClaim counts (claims)\n\nIf wt is passed, the data must include columns containing:\n\nWeighted exposures (exposure)\nWeighted claims (claims)\nClaim counts (n_claims)\nThe raw sum of weights NOT multiplied by exposures\nExposure record counts (.weight_n)\nThe raw sum of squared weights (.weight_sq)\n\nThe names in parentheses above are expected column names. If the data frame passed to from_DataFrame() uses different column names, these can be specified using the col_* arguments.\nWhen a column name is passed to wt, the columns .weight, .weight_n, and .weight_sq are used to calculate credibility and confidence intervals. If credibility and confidence intervals aren’t required, then it is not necessary to pass anything to wt. The resulting ExpStats class and any downstream summaries will still be weighted as long as the exposures and claims are pre-weighted.\ntarget_status, start_date, and end_date are optional arguments that are only used for printing the resulting ExpStats object.\n\n\nExamples\n\nimport actxps as xp\n\n# convert pre-aggregated experience into an ExpStats object\nagg_sim_dat = xp.load_agg_sim_dat()\ndat = xp.ExpStats.from_DataFrame(\n    agg_sim_dat,\n    col_exposure=\"exposure_n\",\n    col_claims=\"claims_n\",\n    target_status=\"Surrender\",\n    start_date=2005,\n    end_date=2019,\n    conf_int=True)\n\n# summary by policy year\ndat.summary('pol_yr')\n\n# repeat the prior exercise on a weighted basis\ndat_wt = xp.ExpStats.from_DataFrame(\n    agg_sim_dat, wt=\"av\",\n    col_exposure=\"exposure_amt\",\n    col_claims=\"claims_amt\",\n    col_n_claims=\"claims_n\",\n    col_weight_sq=\"av_sq\",\n    col_weight_n=\"n\",\n    target_status=\"Surrender\",\n    start_date=2005, end_date=2019,\n    conf_int=True)\n\n# summary by policy year\ndat_wt.summary('pol_yr')\n\nExperience study results\n\nGroups: pol_yr\nTarget status: Surrender\nStudy range: 2005 to 2019\nWeighted by: av\n\nshape: (15, 10)\n┌────────┬──────────┬────────────┬────────────┬───┬────────────┬────────────┬───────────┬──────────┐\n│ pol_yr ┆ n_claims ┆ claims     ┆ exposure   ┆ … ┆ q_obs_uppe ┆ weight     ┆ weight_sq ┆ weight_n │\n│ ---    ┆ ---      ┆ ---        ┆ ---        ┆   ┆ r          ┆ ---        ┆ ---       ┆ ---      │\n│ i64    ┆ i64      ┆ f64        ┆ f64        ┆   ┆ ---        ┆ f64        ┆ f64       ┆ i64      │\n│        ┆          ┆            ┆            ┆   ┆ f64        ┆            ┆           ┆          │\n╞════════╪══════════╪════════════╪════════════╪═══╪════════════╪════════════╪═══════════╪══════════╡\n│ 1      ┆ 102      ┆ 83223.0    ┆ 2.5313e7   ┆ … ┆ 0.00465    ┆ 2.6301746e ┆ 6.0743e10 ┆ 19995    │\n│        ┆          ┆            ┆            ┆   ┆            ┆ 7          ┆           ┆          │\n│ 2      ┆ 160      ┆ 175428.0   ┆ 2.4019e7   ┆ … ┆ 0.009156   ┆ 2.4966449e ┆ 5.9628e10 ┆ 18434    │\n│        ┆          ┆            ┆            ┆   ┆            ┆ 7          ┆           ┆          │\n│ 3      ┆ 124      ┆ 132261.0   ┆ 2.2435e7   ┆ … ┆ 0.007699   ┆ 2.3442831e ┆ 5.7966e10 ┆ 16806    │\n│        ┆          ┆            ┆            ┆   ┆            ┆ 7          ┆           ┆          │\n│ 4      ┆ 168      ┆ 192473.0   ┆ 2.0860e7   ┆ … ┆ 0.011547   ┆ 2.1861723e ┆ 5.5707e10 ┆ 15266    │\n│        ┆          ┆            ┆            ┆   ┆            ┆ 7          ┆           ┆          │\n│ 5      ┆ 164      ┆ 197240.0   ┆ 1.9115e7   ┆ … ┆ 0.012911   ┆ 2.010467e7 ┆ 5.3381e10 ┆ 13618    │\n│ …      ┆ …        ┆ …          ┆ …          ┆ … ┆ …          ┆ …          ┆ …         ┆ …        │\n│ 11     ┆ 804      ┆ 1.153832e6 ┆ 7.6546e6   ┆ … ┆ 0.167253   ┆ 8.501473e6 ┆ 2.7564e10 ┆ 4897     │\n│ 12     ┆ 330      ┆ 517875.0   ┆ 4.8959e6   ┆ … ┆ 0.123667   ┆ 5.713464e6 ┆ 1.9831e10 ┆ 3093     │\n│ 13     ┆ 99       ┆ 179358.0   ┆ 3.1348e6   ┆ … ┆ 0.073083   ┆ 3.678776e6 ┆ 1.3003e10 ┆ 1937     │\n│ 14     ┆ 62       ┆ 114390.0   ┆ 1.7270e6   ┆ … ┆ 0.090199   ┆ 2.343501e6 ┆ 8.8084e9  ┆ 1182     │\n│ 15     ┆ 17       ┆ 26265.0    ┆ 520945.847 ┆ … ┆ 0.092475   ┆ 1.01939e6  ┆ 3.8514e9  ┆ 510      │\n│        ┆          ┆            ┆ 496        ┆   ┆            ┆            ┆           ┆          │\n└────────┴──────────┴────────────┴────────────┴───┴────────────┴────────────┴───────────┴──────────┘\n\n\n\n\nSee Also\nExposedDF.exp_stats() for information on how ExpStats objects are typically created from individual exposure records.\n\n\n\nplot\nexp_stats.ExpStats.plot(x=None, y='q_obs', color=None, facets=None, mapping=None, scales='fixed', geoms='lines', y_labels=lambda : [f'{v * 100}%' for v in l], y_log10=False, conf_int_bars=False)\nPlot experience study results\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nx\nstr\nA column name in data to use as the x variable. If None, x will default to the first grouping variable. If there are no grouping variables, x will be set to “All”.\nNone\n\n\ny\nstr\nA column name in data to use as the y variable.\n'q_obs'\n\n\ncolor\nstr\nA column name in data to use as the color and fill variables. If None, y will default to the second grouping variable. If there are less than two grouping variables, the plot will not use a color aesthetic.\nNone\n\n\nfacets\nlist | str\nFaceting variables in data passed to plotnine.facet_wrap(). If None, grouping variables 3+ will be used (assuming there are more than two grouping variables).\nNone\n\n\nmapping\nplotnine.aes\nAesthetic mapping added to plotnine.ggplot(). NOTE: If mapping is supplied, the x, y, and color arguments will be ignored.\nNone\n\n\nscales\nstr\nThe scales argument passed to plotnine.facet_wrap().\n'fixed'\n\n\ngeoms\n(lines, bars, points)\nType of geometry. If “lines” is passed, the plot will display lines and points. If “bars”, the plot will display bars. If “points”, the plot will display points only.\n'lines'\n\n\ny_labels\ncallable\nLabel function passed to plotnine.scale_y_continuous().\nlambda l: [f\"{v * 100:.1f}%\" for v in l]\n\n\ny_log10\nbool\nIf True, the y-axes are plotted on a log-10 scale.\nFalse\n\n\nconf_int_bars\nbool\nIf True, confidence interval error bars are included in the plot. This option is only available for termination rates and actual-to-expected ratios.\nFalse\n\n\n\n\n\nNotes\nIf no aesthetic map is supplied, the plot will use the first grouping variable in the groups property on the x axis and q_obs on the y axis. In addition, the second grouping variable in groups will be used for color and fill.\nIf no faceting variables are supplied, the plot will use grouping variables 3 and up as facets. These variables are passed into plotnine.facet_wrap().\n\n\nExamples\n\nimport actxps as xp\n\nexp_res = (xp.ExposedDF(xp.load_census_dat(),\n                        \"2019-12-31\", \n                        target_status=\"Surrender\").\n           group_by('pol_yr').\n           exp_stats())\n\nexp_res.plot()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\n\nplot_actual_to_expected\nexp_stats.ExpStats.plot_actual_to_expected(add_hline=True, **kwargs)\nPlot actual-to-expected termination rates for any expected termination rates found in the expected property.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nadd_hline\nbool\nIf True, a blue dashed horizontal line will be drawn at 100%.\nTrue\n\n\n**kwargs\n\nAdditional arguments passed to plot()\n{}\n\n\n\n\n\nExamples\n\nimport actxps as xp\nimport numpy as np\nimport polars as pl        \n\nexpo = xp.ExposedDF(xp.load_census_dat(),\n                    \"2019-12-31\", \n                    target_status=\"Surrender\")\n\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10), \n                                 np.array([0.2, 0.15]), \n                                 np.repeat(0.05, 3)))\nexpo.data = expo.data.with_columns(\n    expected_1=expected_table[expo.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (expo.\n           group_by('pol_yr').\n           exp_stats(expected=['expected_1', 'expected_2']))\n\nexp_res.plot_actual_to_expected()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\n\nplot_termination_rates\nexp_stats.ExpStats.plot_termination_rates(include_cred_adj=False, **kwargs)\nPlot observed termination rates and any expected termination rates found in the expected property.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\ninclude_cred_adj\nbool\nIf True, credibility-weighted termination rates will be plotted as well.\nFalse\n\n\n**kwargs\n\nAdditional arguments passed to plot()\n{}\n\n\n\n\n\nExamples\n\nimport actxps as xp\nimport numpy as np\nimport polars as pl\n\nexpo = xp.ExposedDF(xp.load_census_dat(),\n                    \"2019-12-31\", \n                    target_status=\"Surrender\")\n\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10), \n                                 np.array([0.2, 0.15]), \n                                 np.repeat(0.05, 3)))\nexpo.data = expo.data.with_columns(\n    expected_1=expected_table[expo.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (expo.\n           group_by('pol_yr').\n           exp_stats(expected=['expected_1', 'expected_2']))\n\nexp_res.plot_termination_rates()\n\n\n\n\n&lt;Figure Size: (640 x 480)&gt;\n\n\n\n\n\nsummary\nexp_stats.ExpStats.summary(*by)\nRe-summarize termination experience data\nRe-summarize the data while retaining any grouping variables passed to the *by argument.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\n*by\ntuple\nQuoted column names in data that will be used as grouping variables in the re-summarized object. Passing nothing is acceptable and will produce a 1-row experience summary.\n()\n\n\n\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\nactxps.exp_stats.ExpStats\nA new ExpStats object with rows for all the unique groups in *by\n\n\n\n\n\nExamples\n\nimport actxps as xp\n\nexp_res = (xp.ExposedDF(xp.load_census_dat(),\n                        \"2019-12-31\", \n                        target_status=\"Surrender\").\n           group_by('pol_yr', 'inc_guar').\n           exp_stats())\n\nexp_res.summary('inc_guar')\n\nExperience study results\n\nGroups: inc_guar\nTarget status: Surrender\nStudy range: 1900-01-01 to 2019-12-31\n\nshape: (2, 5)\n┌──────────┬──────────┬────────┬──────────────┬──────────┐\n│ inc_guar ┆ n_claims ┆ claims ┆ exposure     ┆ q_obs    │\n│ ---      ┆ ---      ┆ ---    ┆ ---          ┆ ---      │\n│ bool     ┆ u32      ┆ u32    ┆ f64          ┆ f64      │\n╞══════════╪══════════╪════════╪══════════════╪══════════╡\n│ false    ┆ 1601     ┆ 1601   ┆ 52123.236081 ┆ 0.030716 │\n│ true     ┆ 1268     ┆ 1268   ┆ 80510.732091 ┆ 0.015749 │\n└──────────┴──────────┴────────┴──────────────┴──────────┘\n\n\n\n\n\ntable\nexp_stats.ExpStats.table(fontsize=100, decimals=1, colorful=True, color_q_obs='GnBu', color_ae_='RdBu', show_conf_int=False, show_cred_adj=False, decimals_amt=0, suffix_amt=False, **rename_cols)\nTabular experience study summary\nConvert experience study results to a presentation-friendly format.\n\nParameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nfontsize\nint\nFont size percentage multiplier\n100\n\n\ndecimals\nint\nNumber of decimals to display for percentages\n1\n\n\ncolorful\nbool\nIf True, color will be added to the the observed decrement rate and actual-to-expected columns.\nTrue\n\n\ncolor_q_obs\nstr or colormap\nColorBrewer palette used for the observed decrement rate.\n'GnBu'\n\n\ncolor_ae_\nstr or colormap\nColorBrewer palette used for actual-to-expected rates.\n'RdBu'\n\n\nshow_conf_int\nbool\nIf True any confidence intervals will be displayed.\nFalse\n\n\nshow_cred_adj\nbool\nIf True any credibility-weighted termination rates will be displayed.\nFalse\n\n\ndecimals_amt\nint\nNumber of decimals to display for amount columns (number of claims, claim amounts, and exposures.\n0\n\n\nsuffix_amt\nbool\nThis argument has the same meaning as the compact argument in great_tables.gt.GT.fmt_number() for amount columns. If False, no scaling or suffixing are applied to amount columns. If True, all amount columns are automatically scaled and suffixed by “K” (thousands), “M” (millions), “B” (billions), or “T” (trillions).\nFalse\n\n\nrename_cols\nstr\nKey-value pairs where keys are column names and values are labels that will appear on the output table. This parameter is useful for renaming grouping variables that will appear under their original variable names if left unchanged.\nNone\n\n\n\n\n\nNotes\nFurther customizations can be added using great_tables.gt.GT methods. See the great_tables package documentation for more information.\n\n\nReturns\n\n\n\n\n\n\n\nType\nDescription\n\n\n\n\ngreat_tables.great_tables.gt.great_tables.gt.GT\nA formatted HTML table\n\n\n\n\n\nExamples\n\nimport actxps as xp\nimport numpy as np\nimport polars as pl\n\nexpo = xp.ExposedDF(xp.load_census_dat(),\n                    \"2019-12-31\", \n                    target_status=\"Surrender\")\n\nexpected_table = np.concatenate((np.linspace(0.005, 0.03, 10), \n                                 np.array([0.2, 0.15]), \n                                 np.repeat(0.05, 3)))\nexpo.data = expo.data.with_columns(\n    expected_1=expected_table[expo.data['pol_yr'] - 1],\n    expected_2=pl.when(pl.col('inc_guar')).then(0.015).otherwise(0.03)\n)\n\nexp_res = (expo.\n           group_by('pol_yr').\n           exp_stats(expected=['expected_1', 'expected_2'],\n                     credibility=True))\n\nexp_res.table()\n\n\n\n\n\n  \n    Experience Study Results\n  \n  \n    Target status: Surrender\n  \n\n  pol_yr\n  Claims\n  Exposures\n  qobs\n  \n    expected_1\n  \n  \n    expected_2\n  \n  Zcred\n\n\n  qexp\n  A/E\n  qexp\n  A/E\n\n\n\n  1\n  102\n  19,252\n  0.5%\n  0.5%\n  106.0%\n  2.1%\n  25.2%\n  25.8%\n\n\n  2\n  160\n  17,715\n  0.9%\n  0.8%\n  116.1%\n  2.1%\n  43.0%\n  32.4%\n\n\n  3\n  124\n  16,097\n  0.8%\n  1.1%\n  73.0%\n  2.1%\n  36.7%\n  28.5%\n\n\n  4\n  168\n  14,536\n  1.2%\n  1.3%\n  86.7%\n  2.1%\n  55.1%\n  33.3%\n\n\n  5\n  164\n  12,916\n  1.3%\n  1.6%\n  78.8%\n  2.1%\n  60.7%\n  32.9%\n\n\n  6\n  152\n  11,376\n  1.3%\n  1.9%\n  70.7%\n  2.1%\n  63.9%\n  31.7%\n\n\n  7\n  164\n  9,917\n  1.7%\n  2.2%\n  76.3%\n  2.1%\n  79.1%\n  32.9%\n\n\n  8\n  190\n  8,448\n  2.2%\n  2.4%\n  92.0%\n  2.1%\n  107.9%\n  35.6%\n\n\n  9\n  181\n  6,960\n  2.6%\n  2.7%\n  95.5%\n  2.1%\n  125.1%\n  34.8%\n\n\n  10\n  152\n  5,604\n  2.7%\n  3.0%\n  90.4%\n  2.1%\n  130.6%\n  31.9%\n\n\n  11\n  804\n  4,390\n  18.3%\n  20.0%\n  91.6%\n  2.1%\n  881.0%\n  80.0%\n\n\n  12\n  330\n  2,663\n  12.4%\n  15.0%\n  82.6%\n  2.0%\n  618.2%\n  49.5%\n\n\n  13\n  99\n  1,620\n  6.1%\n  5.0%\n  122.2%\n  2.0%\n  310.9%\n  26.2%\n\n\n  14\n  62\n  872\n  7.1%\n  5.0%\n  142.2%\n  2.0%\n  364.3%\n  20.8%\n\n\n  15\n  17\n  268\n  6.3%\n  5.0%\n  126.8%\n  1.9%\n  331.2%\n  10.9%\n\n\n  \n  \n  \n    Study range: 1900-01-01 to 2019-12-31"
  },
  {
    "objectID": "reference/frac_durations.html",
    "href": "reference/frac_durations.html",
    "title": "frac_interval",
    "section": "",
    "text": "dates.frac_interval(start, end, dur_length)\nCalculate fractional years, quarters, months, or weeks between two dates"
  },
  {
    "objectID": "reference/frac_durations.html#parameters",
    "href": "reference/frac_durations.html#parameters",
    "title": "frac_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nstart\nstr | datetime.date | list | polars.polars.Series\nStart dates\nrequired\n\n\nend\nstr | datetime.date | list | polars.polars.Series\nEnd dates\nrequired\n\n\ndur_length\n(year, quarter, month, week)\nDuration length\n'year'"
  },
  {
    "objectID": "reference/frac_durations.html#returns",
    "href": "reference/frac_durations.html#returns",
    "title": "frac_interval",
    "section": "Returns",
    "text": "Returns\npl.Series A series of floats"
  },
  {
    "objectID": "reference/frac_durations.html#see-also",
    "href": "reference/frac_durations.html#see-also",
    "title": "frac_interval",
    "section": "See Also",
    "text": "See Also\nfrac_yr, frac_qtr, frac_mth, frac_wk"
  },
  {
    "objectID": "reference/frac_durations.html#examples",
    "href": "reference/frac_durations.html#examples",
    "title": "frac_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.frac_interval(['2008-03-14', '2008-03-14'],\n                 ['2024-05-01', '2024-02-01'], \n                 'year')\n\n\nshape: (2,)\n\n\n\n\n\n\nf64\n\n\n\n\n16.131507\n\n\n15.885246"
  },
  {
    "objectID": "reference/frac_durations.html#parameters-1",
    "href": "reference/frac_durations.html#parameters-1",
    "title": "frac_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nstart\nstr | date | list | pl.Series\nStart dates\nrequired\n\n\nend\nstr | date | list | pl.Series\nEnd dates\nrequired"
  },
  {
    "objectID": "reference/frac_durations.html#returns-1",
    "href": "reference/frac_durations.html#returns-1",
    "title": "frac_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/frac_durations.html#see-also-1",
    "href": "reference/frac_durations.html#see-also-1",
    "title": "frac_interval",
    "section": "See Also",
    "text": "See Also\nfrac_interval"
  },
  {
    "objectID": "reference/frac_durations.html#examples-1",
    "href": "reference/frac_durations.html#examples-1",
    "title": "frac_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.frac_yr(['2008-03-14', '2008-03-14'],\n           ['2024-05-01', '2024-02-01'])\n\n\nshape: (2,)\n\n\n\n\n\n\nf64\n\n\n\n\n16.131507\n\n\n15.885246"
  },
  {
    "objectID": "reference/frac_durations.html#parameters-2",
    "href": "reference/frac_durations.html#parameters-2",
    "title": "frac_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nstart\nstr | datetime.date | list | polars.polars.Series\nStart dates\nrequired\n\n\nend\nstr | datetime.date | list | polars.polars.Series\nEnd dates\nrequired"
  },
  {
    "objectID": "reference/frac_durations.html#returns-2",
    "href": "reference/frac_durations.html#returns-2",
    "title": "frac_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/frac_durations.html#see-also-2",
    "href": "reference/frac_durations.html#see-also-2",
    "title": "frac_interval",
    "section": "See Also",
    "text": "See Also\nfrac_interval"
  },
  {
    "objectID": "reference/frac_durations.html#examples-2",
    "href": "reference/frac_durations.html#examples-2",
    "title": "frac_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.frac_qtr(['2008-03-14', '2008-03-14'],\n            ['2024-05-01', '2024-02-01'])\n\n\nshape: (2,)\n\n\n\n\n\n\nf64\n\n\n\n\n64.521739\n\n\n63.538462"
  },
  {
    "objectID": "reference/frac_durations.html#parameters-3",
    "href": "reference/frac_durations.html#parameters-3",
    "title": "frac_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nstart\nstr | date | list | pl.Series\nStart dates\nrequired\n\n\nend\nstr | date | list | pl.Series\nEnd dates\nrequired"
  },
  {
    "objectID": "reference/frac_durations.html#returns-3",
    "href": "reference/frac_durations.html#returns-3",
    "title": "frac_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/frac_durations.html#see-also-3",
    "href": "reference/frac_durations.html#see-also-3",
    "title": "frac_interval",
    "section": "See Also",
    "text": "See Also\nfrac_interval"
  },
  {
    "objectID": "reference/frac_durations.html#examples-3",
    "href": "reference/frac_durations.html#examples-3",
    "title": "frac_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.frac_mth(['2008-03-14', '2008-03-14'],\n            ['2024-05-01', '2024-02-01'])\n\n\nshape: (2,)\n\n\n\n\n\n\nf64\n\n\n\n\n193.566667\n\n\n190.580645"
  },
  {
    "objectID": "reference/frac_durations.html#parameters-4",
    "href": "reference/frac_durations.html#parameters-4",
    "title": "frac_interval",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nstart\nstr | datetime.date | list | polars.polars.Series\nStart dates\nrequired\n\n\nend\nstr | datetime.date | list | polars.polars.Series\nEnd dates\nrequired"
  },
  {
    "objectID": "reference/frac_durations.html#returns-4",
    "href": "reference/frac_durations.html#returns-4",
    "title": "frac_interval",
    "section": "Returns",
    "text": "Returns\npl.Series"
  },
  {
    "objectID": "reference/frac_durations.html#see-also-4",
    "href": "reference/frac_durations.html#see-also-4",
    "title": "frac_interval",
    "section": "See Also",
    "text": "See Also\nfrac_interval"
  },
  {
    "objectID": "reference/frac_durations.html#examples-4",
    "href": "reference/frac_durations.html#examples-4",
    "title": "frac_interval",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\nxp.frac_wk(['2008-03-14', '2008-03-14'],\n           ['2024-05-01', '2024-02-01'])\n\n\nshape: (2,)\n\n\n\n\n\n\nf64\n\n\n\n\n841.714286\n\n\n828.857143"
  },
  {
    "objectID": "reference/load_toy_census.html",
    "href": "reference/load_toy_census.html",
    "title": "load_toy_census",
    "section": "",
    "text": "datasets.load_toy_census()\nToy policy census data\nA tiny dataset containing 3 policies: one active, one terminated due to death, and one terminated due to surrender.\nA data frame with 3 rows and 4 columns:\n\npol_num = policy number\nstatus = policy status\nissue_date = issue date\nterm_date = termination date\n\n\n\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/load_toy_census.html#returns",
    "href": "reference/load_toy_census.html#returns",
    "title": "load_toy_census",
    "section": "",
    "text": "Type\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/qx_iamb.html",
    "href": "reference/qx_iamb.html",
    "title": "load_qx_iamb",
    "section": "",
    "text": "datasets.load_qx_iamb()\n2012 Individual Annuity Mortality Table\nMortality rates from the 2012 Individual Annuity Mortality Basic (IAMB) Table and Projection Scale G2.\nA data frame with 242 rows and 3 columns:\n\nage - attained age\nqx - mortality rate\ngender - Female or Male\n\n\n\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame\n\n\n\n\n\n\n\n\nmort.soa.org\n2012 Individual Annuity Reserving Table"
  },
  {
    "objectID": "reference/qx_iamb.html#returns",
    "href": "reference/qx_iamb.html#returns",
    "title": "load_qx_iamb",
    "section": "",
    "text": "Type\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/qx_iamb.html#references",
    "href": "reference/qx_iamb.html#references",
    "title": "load_qx_iamb",
    "section": "",
    "text": "mort.soa.org\n2012 Individual Annuity Reserving Table"
  },
  {
    "objectID": "reference/qx_iamb.html#returns-1",
    "href": "reference/qx_iamb.html#returns-1",
    "title": "load_qx_iamb",
    "section": "Returns",
    "text": "Returns\n\n\n\nType\nDescription\n\n\n\n\npolars.polars.DataFrame"
  },
  {
    "objectID": "reference/qx_iamb.html#references-1",
    "href": "reference/qx_iamb.html#references-1",
    "title": "load_qx_iamb",
    "section": "References",
    "text": "References\n\nmort.soa.org\n2012 Individual Annuity Reserving Table"
  },
  {
    "objectID": "reference/SplitExposedDF.html",
    "href": "reference/SplitExposedDF.html",
    "title": "SplitExposedDF",
    "section": "",
    "text": "expose_split.SplitExposedDF(self, expo)\nSplit calendar exposures by policy year\nSplit calendar period exposures that cross a policy anniversary into a pre-anniversary record and a post-anniversary record."
  },
  {
    "objectID": "reference/SplitExposedDF.html#parameters",
    "href": "reference/SplitExposedDF.html#parameters",
    "title": "SplitExposedDF",
    "section": "Parameters",
    "text": "Parameters\n\n\n\n\n\n\n\n\n\nName\nType\nDescription\nDefault\n\n\n\n\nexpo\nactxps.ExposedDF\nAn exposure data frame class with calendar-based exposure periods\nrequired"
  },
  {
    "objectID": "reference/SplitExposedDF.html#notes",
    "href": "reference/SplitExposedDF.html#notes",
    "title": "SplitExposedDF",
    "section": "Notes",
    "text": "Notes\nThe ExposedDF must have calendar year, quarter, month, or week exposure records. Calendar year exposures are created by passing cal_expo=True to ExposedDF (or alternatively, with the class methods ExposedDF.expose_cy(), ExposedDF.expose_cq(), ExposedDF.expose_cm(), and ExposedDF.expose_cw()).\nAfter splitting, the resulting data will contain both calendar exposures and policy year exposures. These columns will be named ‘exposure_cal’ and ‘exposure_pol’, respectively. Calendar exposures will be in the original units passed to SplitExposedDF(). Policy exposures will always be expressed in years. Downstream functions like exp_stats() and exp_shiny() will require clarification as to which exposure basis should be used to summarize results.\nAfter splitting, the column ‘pol_yr’ will contain policy years."
  },
  {
    "objectID": "reference/SplitExposedDF.html#examples",
    "href": "reference/SplitExposedDF.html#examples",
    "title": "SplitExposedDF",
    "section": "Examples",
    "text": "Examples\n\nimport actxps as xp\ntoy_census = xp.load_toy_census()\nexpo = xp.ExposedDF.expose_cy(toy_census, \"2022-12-31\")\nxp.SplitExposedDF(expo)\n\nExposure data\n\nExposure type: split_year\nTarget status: None\nStudy range: 1900-01-01 to 2022-12-31\n\nshape: (58, 9)\n┌─────────┬───────────┬────────────┬────────────┬───┬────────────┬────────┬────────────┬───────────┐\n│ pol_num ┆ status    ┆ issue_date ┆ term_date  ┆ … ┆ cal_yr_end ┆ pol_yr ┆ exposure_p ┆ exposure_ │\n│ ---     ┆ ---       ┆ ---        ┆ ---        ┆   ┆ ---        ┆ ---    ┆ ol         ┆ cal       │\n│ i64     ┆ enum      ┆ date       ┆ date       ┆   ┆ date       ┆ i32    ┆ ---        ┆ ---       │\n│         ┆           ┆            ┆            ┆   ┆            ┆        ┆ f64        ┆ f64       │\n╞═════════╪═══════════╪════════════╪════════════╪═══╪════════════╪════════╪════════════╪═══════════╡\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2010-12-31 ┆ 1      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2011-12-31 ┆ 2      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2012-12-31 ┆ 3      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2013-12-31 ┆ 4      ┆ 1.0        ┆ 1.0       │\n│ 1       ┆ Active    ┆ 2010-01-01 ┆ null       ┆ … ┆ 2014-12-31 ┆ 5      ┆ 1.0        ┆ 1.0       │\n│ …       ┆ …         ┆ …          ┆ …          ┆ … ┆ …          ┆ …      ┆ …          ┆ …         │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2020-11-09 ┆ 11     ┆ 0.857923   ┆ 0.857923  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2020-12-31 ┆ 12     ┆ 0.142466   ┆ 0.142077  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2021-11-09 ┆ 12     ┆ 0.857534   ┆ 0.857534  │\n│ 3       ┆ Active    ┆ 2009-11-10 ┆ null       ┆ … ┆ 2021-12-31 ┆ 13     ┆ 0.142466   ┆ 0.142466  │\n│ 3       ┆ Surrender ┆ 2009-11-10 ┆ 2022-02-25 ┆ … ┆ 2022-11-09 ┆ 13     ┆ 0.153425   ┆ 0.153425  │\n└─────────┴───────────┴────────────┴────────────┴───┴────────────┴────────┴────────────┴───────────┘"
  },
  {
    "objectID": "reference/SplitExposedDF.html#see-also",
    "href": "reference/SplitExposedDF.html#see-also",
    "title": "SplitExposedDF",
    "section": "See Also",
    "text": "See Also\nExposedDF() for more information on exposure data."
  }
]