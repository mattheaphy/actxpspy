<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>actxps – expose.exposeddf</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">actxps</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../articles/actxps.html" rel="" target="">
 <span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-articles" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Articles</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-articles">    
        <li>
    <a class="dropdown-item" href="../articles/exposures.html" rel="" target="">
 <span class="dropdown-text">Exposure calculations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/exp_summary.html" rel="" target="">
 <span class="dropdown-text">Experience summaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/transactions.html" rel="" target="">
 <span class="dropdown-text">Transaction studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/visualizations.html" rel="" target="">
 <span class="dropdown-text">Data visualizations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../articles/misc.html" rel="" target="">
 <span class="dropdown-text">Other functions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../changelog.html" rel="" target="">
 <span class="menu-text">Changelog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mattheaphy/actxpspy" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-r-circle-fill" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-r-circle-fill" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-r-circle-fill">    
        <li class="dropdown-header">R version of actxps</li>
        <li>
    <a class="dropdown-item" href="https://github.com/mattheaphy/actxps" rel="" target="">
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://mattheaphy.github.io/actxps" rel="" target="">
 <span class="dropdown-text">Package documentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#actxps.expose.ExposedDF" id="toc-actxps.expose.ExposedDF" class="nav-link active" data-scroll-target="#actxps.expose.ExposedDF">expose.ExposedDF</a>
  <ul class="collapse">
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes">Notes</a></li>
  <li><a href="#attributes" id="toc-attributes" class="nav-link" data-scroll-target="#attributes">Attributes</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#actxps.expose.ExposedDF.add_transactions" id="toc-actxps.expose.ExposedDF.add_transactions" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.add_transactions">add_transactions</a></li>
  <li><a href="#actxps.expose.ExposedDF.exp_shiny" id="toc-actxps.expose.ExposedDF.exp_shiny" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.exp_shiny">exp_shiny</a></li>
  <li><a href="#actxps.expose.ExposedDF.exp_stats" id="toc-actxps.expose.ExposedDF.exp_stats" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.exp_stats">exp_stats</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_cm" id="toc-actxps.expose.ExposedDF.expose_cm" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_cm">expose_cm</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_cq" id="toc-actxps.expose.ExposedDF.expose_cq" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_cq">expose_cq</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_cw" id="toc-actxps.expose.ExposedDF.expose_cw" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_cw">expose_cw</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_cy" id="toc-actxps.expose.ExposedDF.expose_cy" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_cy">expose_cy</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_pm" id="toc-actxps.expose.ExposedDF.expose_pm" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_pm">expose_pm</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_pq" id="toc-actxps.expose.ExposedDF.expose_pq" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_pq">expose_pq</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_pw" id="toc-actxps.expose.ExposedDF.expose_pw" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_pw">expose_pw</a></li>
  <li><a href="#actxps.expose.ExposedDF.expose_py" id="toc-actxps.expose.ExposedDF.expose_py" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.expose_py">expose_py</a></li>
  <li><a href="#actxps.expose.ExposedDF.from_DataFrame" id="toc-actxps.expose.ExposedDF.from_DataFrame" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.from_DataFrame">from_DataFrame</a></li>
  <li><a href="#actxps.expose.ExposedDF.groupby" id="toc-actxps.expose.ExposedDF.groupby" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.groupby">groupby</a></li>
  <li><a href="#actxps.expose.ExposedDF.trx_stats" id="toc-actxps.expose.ExposedDF.trx_stats" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.trx_stats">trx_stats</a></li>
  <li><a href="#actxps.expose.ExposedDF.ungroup" id="toc-actxps.expose.ExposedDF.ungroup" class="nav-link" data-scroll-target="#actxps.expose.ExposedDF.ungroup">ungroup</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="actxps.expose.ExposedDF" class="level1">
<h1>expose.ExposedDF</h1>
<p><code>expose.ExposedDF(self, data, end_date, start_date=datetime(1900, 1, 1), target_status=None, cal_expo=False, expo_length='year', col_pol_num='pol_num', col_status='status', col_issue_date='issue_date', col_term_date='term_date', default_status=None)</code></p>
<p>Exposed data frame class</p>
<p>Convert a data frame of census-level records into an object with exposure-level records.</p>
<section id="parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters">Parameters</h2>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 22%">
<col style="width: 55%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>data</code></td>
<td>pandas.pandas.DataFrame</td>
<td>A data frame with census-level records</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>end_date</code></td>
<td>datetime.datetime</td>
<td>Experience study end date</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>start_date</code></td>
<td>datetime.datetime</td>
<td>Experience study start date</td>
<td><code>'1900-01-01'</code></td>
</tr>
<tr class="even">
<td><code>target_status</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>Target status values</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>cal_expo</code></td>
<td>bool</td>
<td>Set to <code>True</code> for calendar year exposures. Otherwise policy year exposures are assumed.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>expo_length</code></td>
<td>(year, quarter, month, week)</td>
<td>Exposure period length</td>
<td><code>'year'</code></td>
</tr>
<tr class="odd">
<td><code>col_pol_num</code></td>
<td>str</td>
<td>Name of the column in <code>data</code> containing the policy number</td>
<td><code>'pol_num'</code></td>
</tr>
<tr class="even">
<td><code>col_status</code></td>
<td>str</td>
<td>name of the column in <code>data</code> containing the policy status</td>
<td><code>'status'</code></td>
</tr>
<tr class="odd">
<td><code>col_issue_date</code></td>
<td>str</td>
<td>name of the column in <code>data</code> containing the issue date</td>
<td><code>'issue_date'</code></td>
</tr>
<tr class="even">
<td><code>col_term_date</code></td>
<td>str</td>
<td>name of the column in <code>data</code> containing the termination date</td>
<td><code>'term_date'</code></td>
</tr>
<tr class="odd">
<td><code>default_status</code></td>
<td>str</td>
<td>Default active status code</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<p>Census-level data refers to a data set wherein there is one row per unique policy. Exposure-level data expands census-level data such that there is one record per policy per observation period. Observation periods could be any meaningful period of time such as a policy year, policy month, calendar year, calendar quarter, calendar month, etc.</p>
<p><code>target_status</code> is used in the calculation of exposures. The annual exposure method is applied, which allocates a full period of exposure for any statuses in <code>target_status</code>. For all other statuses, new entrants and exits are partially exposed based on the time elapsed in the observation period. This method is consistent with the Balducci Hypothesis, which assumes that the probability of termination is proportionate to the time elapsed in the observation period. If the annual exposure method isn’t desired, <code>target_status</code> can be ignored. In this case, partial exposures are always applied regardless of status.</p>
<p><code>default_status</code> is used to indicate the default active status that should be used when exposure records are created. If <code>None</code>, then the first status level will be assumed to be the default active status.</p>
<p><strong>Alternative class constructors</strong></p>
<ul>
<li><p><code>expose_py()</code>, <code>expose_pq()</code>, <code>expose_pm()</code>, <code>expose_pw()</code>, <code>expose_cy()</code>, <code>expose_cq()</code>, <code>expose_cm()</code>, <code>expose_cw()</code></p>
<p>Convenience constructor functions for specific exposure calculations. The two characters after the underscore describe the exposure type and exposure period, respectively. For exposures types <code>p</code> refers to policy years <code>c</code> refers to calendar years For exposure periods <code>y</code> = years <code>q</code> = quarters <code>m</code> = months <code>w</code> = weeks Each constructor has the same inputs as the <code>__init__</code> method except that <code>expo_length</code> and <code>cal_expo</code> arguments are prepopulated.</p></li>
<li><p><code>from_DataFrame()</code> Convert a data frame that already has exposure-level records into an <code>ExposedDF</code> object.</p></li>
</ul>
</section>
<section id="attributes" class="level2">
<h2 class="anchored" data-anchor-id="attributes">Attributes</h2>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 86%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>data</td>
<td>pandas.pandas.DataFrame</td>
<td>A data frame with exposure level records. The results include all existing columns in the original input data plus new columns for exposures and observation periods. Observation periods include counters for policy exposures, start dates, and end dates. Both start dates and end dates are inclusive bounds. For policy year exposures, two observation period columns are returned. Columns beginning with (<code>pol_</code>) are integer policy periods. Columns beginning with (<code>pol_date_</code>) are calendar dates representing anniversary dates, monthiversary dates, etc.</td>
</tr>
<tr class="even">
<td>end_date, start_date, target_status, cal_expo, expo_length</td>
<td></td>
<td>Values passed on class instantiation. See Parameters for definitions.</td>
</tr>
<tr class="odd">
<td>exposure_type</td>
<td>str</td>
<td>A description of the exposure type that combines the <code>cal_expo</code> and <code>expo_length</code> properties</td>
</tr>
<tr class="even">
<td>date_cols</td>
<td>tuple</td>
<td>Names of the start and end date columns in <code>data</code> for each exposure period</td>
</tr>
<tr class="odd">
<td>trx_types</td>
<td>list</td>
<td>List of transaction types that have been attached to <code>data</code> using the <code>add_transactions()</code> method.</td>
</tr>
</tbody>
</table>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Atkinson and McGarry (2016). Experience Study Calculations</p>
<p>https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.add_transactions">add_transactions</a></td>
<td>Add transactions to an experience study</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.exp_shiny">exp_shiny</a></td>
<td>Interactively explore experience data</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.exp_stats">exp_stats</a></td>
<td>Summarize experience study records</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.expose_cm">expose_cm</a></td>
<td>Create an <code>ExposedDF</code> with calendar month exposures</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.expose_cq">expose_cq</a></td>
<td>Create an <code>ExposedDF</code> with calendar quarter exposures</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.expose_cw">expose_cw</a></td>
<td>Create an <code>ExposedDF</code> with calendar week exposures</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.expose_cy">expose_cy</a></td>
<td>Create an <code>ExposedDF</code> with calendar year exposures</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.expose_pm">expose_pm</a></td>
<td>Create an <code>ExposedDF</code> with policy month exposures</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.expose_pq">expose_pq</a></td>
<td>Create an <code>ExposedDF</code> with policy quarter exposures</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.expose_pw">expose_pw</a></td>
<td>Create an <code>ExposedDF</code> with policy week exposures</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.expose_py">expose_py</a></td>
<td>Create an <code>ExposedDF</code> with policy year exposures</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.from_DataFrame">from_DataFrame</a></td>
<td>Coerce a data frame to an <code>ExposedDF</code> object</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.groupby">groupby</a></td>
<td>Set grouping variables for summary methods like <code>exp_stats()</code> and</td>
</tr>
<tr class="even">
<td><a href="#actxps.expose.ExposedDF.trx_stats">trx_stats</a></td>
<td>Summarize transactions and utilization rates</td>
</tr>
<tr class="odd">
<td><a href="#actxps.expose.ExposedDF.ungroup">ungroup</a></td>
<td>Remove all grouping variables for summary methods like <code>exp_stats()</code></td>
</tr>
</tbody>
</table>
<section id="actxps.expose.ExposedDF.add_transactions" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.add_transactions">add_transactions</h3>
<p><code>expose.ExposedDF.add_transactions(trx_data, col_pol_num='pol_num', col_trx_date='trx_date', col_trx_type='trx_type', col_trx_amt='trx_amt')</code></p>
<p>Add transactions to an experience study</p>
<section id="parameters-1" class="level4">
<h4 class="anchored" data-anchor-id="parameters-1">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 74%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>trx_data</code></td>
<td>pandas.pandas.DataFrame</td>
<td>A data frame containing transactions details. This data frame must have columns for policy numbers, transaction dates, transaction types, and transaction amounts.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>col_pol_num</code></td>
<td>str</td>
<td>Name of the column in <code>trx_data</code> containing the policy number</td>
<td><code>'pol_num'</code></td>
</tr>
<tr class="odd">
<td><code>col_trx_date</code></td>
<td>str</td>
<td>Name of the column in <code>trx_data</code> containing the transaction date</td>
<td><code>'trx_date'</code></td>
</tr>
<tr class="even">
<td><code>col_trx_type</code></td>
<td>str</td>
<td>Name of the column in <code>trx_data</code> containing the transaction type</td>
<td><code>'trx_type'</code></td>
</tr>
<tr class="odd">
<td><code>col_trx_amt</code></td>
<td>str</td>
<td>Name of the column in <code>trx_data</code> containing the transaction amount</td>
<td><code>'trx_amt'</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes-1" class="level4">
<h4 class="anchored" data-anchor-id="notes-1">Notes</h4>
<p>This function attaches transactions to an <code>ExposedDF</code> object. Transactions are grouped and summarized such that the number of rows in the data does not change. Two columns are added to the output for each transaction type. These columns have names of the pattern <code>trx_n_{*}</code> (transaction counts) and <code>trx_amt_{*}</code> (transaction_amounts). The <code>trx_types</code> property is updated to include the new transaction types found in <code>trx_data.</code></p>
<p>Transactions are associated with the data object by matching transactions dates with exposure dates ranges found in the <code>ExposedDF</code>.</p>
</section>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<pre><code>import actxps as xp
census = xp.load_census_dat()
withdrawals = xp.load_withdrawals()
expo = xp.ExposedDF.expose_py(census, "2019-12-31",
                              target_status = "Surrender")
expo.add_transactions(withdrawals)</code></pre>
</section>
</section>
<section id="actxps.expose.ExposedDF.exp_shiny" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.exp_shiny">exp_shiny</h3>
<p><code>expose.ExposedDF.exp_shiny(predictors=None, expected=None, distinct_max=25)</code></p>
<p>Interactively explore experience data</p>
<p>Launch a shiny application to interactively explore drivers of experience.</p>
<section id="parameters-2" class="level4">
<h4 class="anchored" data-anchor-id="parameters-2">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 13%">
<col style="width: 75%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>predictors</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>A character vector of independent variables in the <code>data</code> property to include in the shiny app.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>expected</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>A character vector of expected values in the <code>data</code> property to include in the shiny app.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>distinct_max</code></td>
<td>int</td>
<td>Maximum number of distinct values allowed for <code>predictors</code> to be included as “Color” and “Facets” grouping variables. This input prevents the drawing of overly complex plots. Default value = 25.</td>
<td><code>25</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes-2" class="level4">
<h4 class="anchored" data-anchor-id="notes-2">Notes</h4>
<p>If transactions have been attached to the <code>ExposedDF</code> object, the app will contain features for both termination and transaction studies. Otherwise, the app will only support termination studies.</p>
<p>If nothing is passed to <code>predictors</code>, all columns names in <code>dat</code> will be used (excluding the policy number, status, termination date, exposure, transaction counts, and transaction amounts columns).</p>
<p>The <code>expected</code> argument is optional. As a default, any column names containing the word “expected” are used.</p>
<p><strong>Layout</strong></p>
<p><em>Filters</em></p>
<p>The sidebar contains filtering widgets for all variables passed to the <code>predictors</code> argument.</p>
<p><em>Study options</em></p>
<p>Grouping variables</p>
<p>This box includes widgets to select grouping variables for summarizing experience. The “x” widget is also used as the x variable in the plot output. Similarly, the “Color” and “Facets” widgets are used for color and facets in the plot. Multiple faceting variables are allowed. For the table output, “x”, “Color”, and “Facets” have no particular meaning beyond the order in which of grouping variables are displayed.</p>
<p>Study type</p>
<p>This box also includes a toggle to switch between termination studies and transaction studies (if available).</p>
<ul>
<li><p>Termination studies: The expected values checkboxes are used to activate and deactivate expected values passed to the <code>expected</code> argument. This impacts the table output directly and the available “y” variables for the plot. If there are no expected values available, this widget will not appear. The “Weight by” widget is used to specify which column, if any, contains weights for summarizing experience.</p></li>
<li><p>Transaction studies: The transaction types checkboxes are used to activate and deactivate transaction types that appear in the plot and table outputs. The available transaction types are taken from the <code>trx_types</code> property of the <code>ExposedDF</code> object. In the plot output, transaction type will always appear as a faceting variable. The “Transactions as % of” selector will expand the list of available “y” variables for the plot and impact the table output directly. Lastly, a checkbox exists that allows for all transaction types to be aggregated into a single group.</p></li>
</ul>
<p><strong>Output</strong></p>
<p><em>Plot Tab</em></p>
<p>This tab includes a plot and various options for customization:</p>
<ul>
<li>y: y variable</li>
<li>Geometry: plotting geometry</li>
<li>Add Smoothing?: activate to plot loess curves</li>
<li>Free y Scales: activate to enable separate y scales in each plot.</li>
</ul>
<p><em>Table</em></p>
<p>This tab includes a data table.</p>
<p><em>Export Data</em></p>
<p>This tab includes a download button that will save a copy of the summarized experience data.</p>
<p><strong>Filter Information</strong></p>
<p>This box contains information on the original number of exposure records, the number of records after filters are applied, and the percentage of records retained.</p>
</section>
<section id="examples-1" class="level4">
<h4 class="anchored" data-anchor-id="examples-1">Examples</h4>
<p>import actxps as xp import numpy as np</p>
<p>census_dat = xp.load_census_dat() withdrawals = xp.load_withdrawals() account_vals = xp.load_account_vals()</p>
<p>expo = xp.ExposedDF(census_dat, “2019-12-31”, target_status = “Surrender”) expected_table = np.concatenate((np.linspace(0.005, 0.03, 10), [.2, .15], np.repeat(0.05, 3))) expo.data[‘expected_1’] = expected_table[expo.data.pol_yr - 1] expo.data[‘expected_2’] = np.where(expo.data.inc_guar, 0.015, 0.03) expo.add_transactions(withdrawals) expo.data = expo.data.merge(account_vals, how=‘left’, on=[“pol_num”, “pol_date_yr”])</p>
<p>app = expo.exp_shiny(expected=[‘expected_1’, ‘expected_2’])</p>
</section>
</section>
<section id="actxps.expose.ExposedDF.exp_stats" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.exp_stats">exp_stats</h3>
<p><code>expose.ExposedDF.exp_stats(target_status=None, expected=None, wt=None, credibility=False, cred_p=0.95, cred_r=0.05)</code></p>
<p>Summarize experience study records</p>
<p>Create a summary of termination experience for a given target status (an <code>ExpStats</code> object).</p>
<section id="parameters-3" class="level4">
<h4 class="anchored" data-anchor-id="parameters-3">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 18%">
<col style="width: 67%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>target_status</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>A single string, list, or array of target status values</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>expected</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>A single string, list, or array of column names in the <code>data</code> property with expected values</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>wt</code></td>
<td>str</td>
<td>Name of the column in the <code>data</code> property containing weights to use in the calculation of claims, exposures, and partial credibility.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>credibility</code></td>
<td>bool</td>
<td>Whether the output should include partial credibility weights and credibility-weighted decrement rates.</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>cred_p</code></td>
<td>float</td>
<td>Confidence level under the Limited Fluctuation credibility method</td>
<td><code>0.95</code></td>
</tr>
<tr class="even">
<td><code>cred_r</code></td>
<td>float</td>
<td>Error tolerance under the Limited Fluctuation credibility method</td>
<td><code>0.05</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes-3" class="level4">
<h4 class="anchored" data-anchor-id="notes-3">Notes</h4>
<p>If the <code>ExposedDF</code> object is grouped (see the <code>groupby()</code> method), the returned <code>ExpStats</code> object’s data will contain one row per group.</p>
<p>If nothing is passed to <code>target_status</code>, the <code>target_status</code> property of the <code>ExposedDF</code> object will be used. If that property is <code>None</code>, all status values except the first level will be assumed. This will produce a warning message.</p>
<p><strong>Expected values</strong></p>
<p>The <code>expected</code> argument is optional. If provided, this argument must be a string, list, or array with values corresponding to columns in the <code>data</code> property containing expected experience. More than one expected basis can be provided.</p>
<p><strong>Credibility</strong></p>
<p>If <code>credibility</code> is set to <code>True</code>, the output will contain a <code>credibility</code> column equal to the partial credibility estimate under the Limited Fluctuation credibility method (also known as Classical Credibility) assuming a binomial distribution of claims.</p>
</section>
<section id="returns" class="level4">
<h4 class="anchored" data-anchor-id="returns">Returns</h4>
<table class="table">
<colgroup>
<col style="width: 2%">
<col style="width: 97%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ExpStats</code></td>
<td>An <code>ExpStats</code> object with a <code>data</code> property that includes columns for any grouping variables, claims, exposures, and observed decrement rates (<code>q_obs</code>). If any values are passed to <code>expected</code>, additional columns will be added for expected decrements and actual-to-expected ratios. If <code>credibility</code> is set to <code>True</code>, additional columns are added for partial credibility and credibility-weighted decrement rates (assuming values are passed to <code>expected</code>).</td>
</tr>
</tbody>
</table>
</section>
<section id="references-1" class="level4">
<h4 class="anchored" data-anchor-id="references-1">References</h4>
<p>Herzog, Thomas (1999). Introduction to Credibility Theory</p>
</section>
</section>
<section id="actxps.expose.ExposedDF.expose_cm" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_cm">expose_cm</h3>
<p><code>expose.ExposedDF.expose_cm(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with calendar month exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_cq" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_cq">expose_cq</h3>
<p><code>expose.ExposedDF.expose_cq(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with calendar quarter exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_cw" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_cw">expose_cw</h3>
<p><code>expose.ExposedDF.expose_cw(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with calendar week exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_cy" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_cy">expose_cy</h3>
<p><code>expose.ExposedDF.expose_cy(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with calendar year exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_pm" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_pm">expose_pm</h3>
<p><code>expose.ExposedDF.expose_pm(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with policy month exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_pq" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_pq">expose_pq</h3>
<p><code>expose.ExposedDF.expose_pq(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with policy quarter exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_pw" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_pw">expose_pw</h3>
<p><code>expose.ExposedDF.expose_pw(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with policy week exposures</p>
</section>
<section id="actxps.expose.ExposedDF.expose_py" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.expose_py">expose_py</h3>
<p><code>expose.ExposedDF.expose_py(data, end_date, **kwargs)</code></p>
<p>Create an <code>ExposedDF</code> with policy year exposures</p>
</section>
<section id="actxps.expose.ExposedDF.from_DataFrame" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.from_DataFrame">from_DataFrame</h3>
<p><code>expose.ExposedDF.from_DataFrame(data, end_date, start_date=datetime(1900, 1, 1), target_status=None, cal_expo=False, expo_length='year', trx_types=None, col_pol_num='pol_num', col_status='status', col_exposure='exposure', col_pol_per=None, cols_dates=None, col_trx_n_='trx_n_', col_trx_amt_='trx_amt_')</code></p>
<p>Coerce a data frame to an <code>ExposedDF</code> object</p>
<p>The input data frame must have columns for policy numbers, statuses, exposures, policy periods (for policy exposures only), and exposure start / end dates. Optionally, if <code>data</code> has transaction counts and amounts by type, these can be specified without calling <code>add_transactions()</code>.</p>
<section id="parameters-4" class="level4">
<h4 class="anchored" data-anchor-id="parameters-4">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 84%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>data</code></td>
<td>pandas.pandas.DataFrame</td>
<td>A data frame with exposure-level records</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>end_date</code></td>
<td>datetime.datetime</td>
<td>Experience study end date</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>start_date</code></td>
<td>datetime.datetime</td>
<td>Experience study start date</td>
<td><code>'1900-01-01'</code></td>
</tr>
<tr class="even">
<td><code>target_status</code></td>
<td>str | list | numpy.numpy.ndarray</td>
<td>Target status values</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>cal_expo</code></td>
<td>bool</td>
<td>Set to <code>True</code> for calendar year exposures. Otherwise policy year exposures are assumed.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>expo_length</code></td>
<td>str</td>
<td>Exposure period length. Must be ‘year’, ‘quarter’, ‘month’, or ‘week’</td>
<td><code>'year'</code></td>
</tr>
<tr class="odd">
<td><code>trx_types</code></td>
<td>list | str</td>
<td>List containing unique transaction types that have been attached to <code>data</code>. For each value in <code>trx_types</code>, <code>from_DataFrame</code> requires that columns exist in <code>data</code> named <code>trx_n_{*}</code> and <code>trx_amt_{*}</code> containing transaction counts and amounts, respectively. The prefixes “trx_n_” and “trx_amt_” can be overridden using the <code>col_trx_n_</code> and <code>col_trx_amt_</code> arguments.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>col_pol_num</code></td>
<td>str</td>
<td>Name of the column in <code>data</code> containing the policy number</td>
<td><code>'pol_num'</code></td>
</tr>
<tr class="odd">
<td><code>col_status</code></td>
<td>str</td>
<td>name of the column in <code>data</code> containing the policy status</td>
<td><code>'status'</code></td>
</tr>
<tr class="even">
<td><code>col_exposure</code></td>
<td>str</td>
<td>Name of the column in <code>data</code> containing exposures.</td>
<td><code>'exposure'</code></td>
</tr>
<tr class="odd">
<td><code>col_pol_per</code></td>
<td>str</td>
<td>Name of the column in <code>data</code> containing policy exposure periods. Only necessary if <code>cal_expo</code> is <code>False</code>. The assumed default is either “pol_yr”, “pol_qtr”, “pol_mth”, or “pol_wk” depending on the value of <code>expo_length</code>.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>cols_dates</code></td>
<td>str</td>
<td>Names of the columns in <code>data</code> containing exposure start and end dates. Both date ranges are assumed to be exclusive. The assumed default is of the form <em>A</em>_<em>B</em>. <em>A</em> is “cal” if <code>cal_expo</code> is <code>True</code> or “pol” otherwise. <em>B</em> is either “yr”, “qtr”, “mth”, or “wk” depending on the value of <code>expo_length</code>.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>col_trx_n_</code></td>
<td>str</td>
<td>Prefix to use for columns containing transaction counts.</td>
<td><code>"trx_n_"</code></td>
</tr>
<tr class="even">
<td><code>col_trx_amt_</code></td>
<td>str</td>
<td>Prefix to use for columns containing transaction amounts.</td>
<td><code>"trx_amt_"</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level4">
<h4 class="anchored" data-anchor-id="returns-1">Returns</h4>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ExposedDF</code></td>
<td>An <code>ExposedDF</code> object.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="actxps.expose.ExposedDF.groupby" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.groupby">groupby</h3>
<p><code>expose.ExposedDF.groupby(*by)</code></p>
<p>Set grouping variables for summary methods like <code>exp_stats()</code> and <code>trx_stats()</code>.</p>
<section id="parameters-5" class="level4">
<h4 class="anchored" data-anchor-id="parameters-5">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 70%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>*by</code></td>
<td></td>
<td>Column names in <code>data</code> that will be used as grouping variables</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes-4" class="level4">
<h4 class="anchored" data-anchor-id="notes-4">Notes</h4>
<p>This function will not directly apply the <code>DataFrame.groupby()</code> method to the <code>data</code> property. Instead, it will set the <code>groups</code> property of the <code>ExposedDF</code> object. The <code>groups</code> property is subsequently used to group data within summary methods like <code>exp_stats()</code> and <code>trx_stats()</code>.</p>
</section>
</section>
<section id="actxps.expose.ExposedDF.trx_stats" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.trx_stats">trx_stats</h3>
<p><code>expose.ExposedDF.trx_stats(trx_types=None, percent_of=None, combine_trx=False, col_exposure='exposure', full_exposures_only=True)</code></p>
<p>Summarize transactions and utilization rates</p>
<p>Create a summary of transaction counts, amounts, and utilization rates (a <code>TrxStats</code> object).</p>
<section id="parameters-6" class="level4">
<h4 class="anchored" data-anchor-id="parameters-6">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 77%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>trx_types</code></td>
<td>list or str</td>
<td>A list of transaction types to include in the output. If <code>None</code> is provided, all available transaction types in the <code>trx_types</code> property will be used.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>percent_of</code></td>
<td>list or str</td>
<td>A list containing column names in the <code>data</code> property to use as denominators in the calculation of utilization rates or actual-to-expected ratios.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>combine_trx</code></td>
<td>bool</td>
<td>If <code>False</code> (default), the results will contain output rows for each transaction type. If <code>True</code>, the results will contains aggregated results across all transaction types.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>col_exposure</code></td>
<td>str</td>
<td>Name of the column in the <code>data</code> property containing exposures</td>
<td><code>'exposure'</code></td>
</tr>
<tr class="odd">
<td><code>full_exposures_only</code></td>
<td>bool</td>
<td>If <code>True</code> (default), partially exposed records will be ignored in the results.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="notes-5" class="level4">
<h4 class="anchored" data-anchor-id="notes-5">Notes</h4>
<p>If the <code>ExposedDF</code> object is grouped (see the <code>groupby()</code> method), the returned <code>TrxStats</code> object’s data will contain one row per group.</p>
<p>Any number of transaction types can be passed to the <code>trx_types</code> argument, however each transaction type <strong>must</strong> appear in the <code>trx_types</code> property of the <code>ExposedDF</code> object. In addition, <code>trx_stats()</code> expects to see columns named <code>trx_n_{*}</code> (for transaction counts) and <code>trx_amt_{*}</code> for (transaction amounts) for each transaction type. To ensure <code>data</code> is in the appropriate format, use the class method <code>ExposedDF.from_DataFrame()</code> to convert an existing data frame with transactions or use <code>add_transactions()</code> to attach transactions to an existing <code>ExposedDF</code> object.</p>
<p><strong>“Percentage of” calculations</strong></p>
<p>The <code>percent_of</code> argument is optional. If provided, this argument must be list with values corresponding to columns in the <code>data</code> property containing values to use as denominators in the calculation of utilization rates or actual-to-expected ratios. Example usage:</p>
<ul>
<li>In a study of partial withdrawal transactions, if <code>percent_of</code> refers to account values, observed withdrawal rates can be determined.</li>
<li>In a study of recurring claims, if <code>percent_of</code> refers to a column containing a maximum benefit amount, utilization rates can be determined.</li>
</ul>
<p><strong>Default removal of partial exposures</strong></p>
<p>As a default, partial exposures are removed from <code>data</code> before summarizing results. This is done to avoid complexity associated with a lopsided skew in the timing of transactions. For example, if transactions can occur on a monthly basis or annually at the beginning of each policy year, partial exposures may not be appropriate. If a policy had an exposure of 0.5 years and was taking withdrawals annually at the beginning of the year, an argument could be made that the exposure should instead be 1 complete year. If the same policy was expected to take withdrawals 9 months into the year, it’s not clear if the exposure should be 0.5 years or 0.5 / 0.75 years. To override this treatment, set <code>full_exposures_only</code> to <code>False</code>.</p>
</section>
<section id="examples-2" class="level4">
<h4 class="anchored" data-anchor-id="examples-2">Examples</h4>
<p>import actxps as xp census = xp.load_census_dat() withdrawals = xp.load_withdrawals() expo = xp.ExposedDF.expose_py(census, “2019-12-31”, target_status = “Surrender”) expo.add_transactions(withdrawals)</p>
<p>expo.groupby(‘inc_guar’).trx_stats(percent_of = “premium”) expo.groupby(‘inc_guar’).trx_stats(percent_of = “premium”, combine_trx = True)</p>
</section>
<section id="returns-2" class="level4">
<h4 class="anchored" data-anchor-id="returns-2">Returns</h4>
<table class="table">
<colgroup>
<col style="width: 1%">
<col style="width: 98%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TrxStats</code></td>
<td>A <code>TrxStats</code> object with a <code>data</code> property that includes columns for any grouping variables and transaction types, plus the following: - <code>trx_n</code>: the number of unique transactions. - <code>trx_amt</code>: total transaction amount - <code>trx_flag</code>: the number of observation periods with non-zero transaction amounts. - <code>exposure</code>: total exposures - <code>avg_trx</code>: mean transaction amount (<code>trx_amt / trx_flag</code>) - <code>avg_all</code>: mean transaction amount over all records (<code>trx_amt / exposure</code>) - <code>trx_freq</code>: transaction frequency when a transaction occurs (<code>trx_n / trx_flag</code>) - <code>trx_utilization</code>: transaction utilization per observation period (<code>trx_flag / exposure</code>) If <code>percent_of</code> is provided, the results will also include: - The sum of any columns passed to <code>percent_of</code> with non-zero transactions. These columns include the suffix <code>_w_trx</code>. - The sum of any columns passed to <code>percent_of</code> - <code>pct_of_{*}_w_trx</code>: total transactions as a percentage of column <code>{*}_w_trx</code> - <code>pct_of_{*}_all</code>: total transactions as a percentage of column <code>{*}</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="actxps.expose.ExposedDF.ungroup" class="level3">
<h3 class="anchored" data-anchor-id="actxps.expose.ExposedDF.ungroup">ungroup</h3>
<p><code>expose.ExposedDF.ungroup()</code></p>
<p>Remove all grouping variables for summary methods like <code>exp_stats()</code> and <code>trx_stats()</code>.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>